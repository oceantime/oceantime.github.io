<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ARTS-week-34 | Oceantime&#39;s blog</title>
    <meta name="generator" content="VuePress 1.5.3">
    <link rel="icon" href="/logo.jpg">
    <meta name="description" content="Oceantime 个人网站">
    <link rel="preload" href="/assets/css/0.styles.abfd12c2.css" as="style"><link rel="preload" href="/assets/js/app.65b0f24a.js" as="script"><link rel="preload" href="/assets/js/2.d6ca9a42.js" as="script"><link rel="preload" href="/assets/js/112.66f93d20.js" as="script"><link rel="prefetch" href="/assets/js/10.ad6941e4.js"><link rel="prefetch" href="/assets/js/100.8ade9f63.js"><link rel="prefetch" href="/assets/js/101.a15dfa49.js"><link rel="prefetch" href="/assets/js/102.761bd3ff.js"><link rel="prefetch" href="/assets/js/103.4e1cd420.js"><link rel="prefetch" href="/assets/js/104.6cfd7216.js"><link rel="prefetch" href="/assets/js/105.e2d93a01.js"><link rel="prefetch" href="/assets/js/106.6151bc8f.js"><link rel="prefetch" href="/assets/js/107.ad872ea3.js"><link rel="prefetch" href="/assets/js/108.bc756e31.js"><link rel="prefetch" href="/assets/js/109.fe77c5ed.js"><link rel="prefetch" href="/assets/js/11.f05321e1.js"><link rel="prefetch" href="/assets/js/110.39bd8ea8.js"><link rel="prefetch" href="/assets/js/111.bd5d0a8b.js"><link rel="prefetch" href="/assets/js/113.e3f1b94f.js"><link rel="prefetch" href="/assets/js/114.6ca21a56.js"><link rel="prefetch" href="/assets/js/115.2369b994.js"><link rel="prefetch" href="/assets/js/116.ef676fd0.js"><link rel="prefetch" href="/assets/js/117.7762c22c.js"><link rel="prefetch" href="/assets/js/118.dc732d76.js"><link rel="prefetch" href="/assets/js/119.2b7f1a4d.js"><link rel="prefetch" href="/assets/js/12.b607cc9e.js"><link rel="prefetch" href="/assets/js/120.1b132ede.js"><link rel="prefetch" href="/assets/js/121.ff9a3172.js"><link rel="prefetch" href="/assets/js/122.2f47d49f.js"><link rel="prefetch" href="/assets/js/13.67af4ad6.js"><link rel="prefetch" href="/assets/js/14.c7827c0f.js"><link rel="prefetch" href="/assets/js/15.eedb1566.js"><link rel="prefetch" href="/assets/js/16.fe37cbf7.js"><link rel="prefetch" href="/assets/js/17.a38f0ae2.js"><link rel="prefetch" href="/assets/js/18.4990ee61.js"><link rel="prefetch" href="/assets/js/19.f4dbb6de.js"><link rel="prefetch" href="/assets/js/20.9ffd67c9.js"><link rel="prefetch" href="/assets/js/21.ac6e1d53.js"><link rel="prefetch" href="/assets/js/22.76b0e02e.js"><link rel="prefetch" href="/assets/js/23.ff3410dc.js"><link rel="prefetch" href="/assets/js/24.f76a6fea.js"><link rel="prefetch" href="/assets/js/25.0534f43c.js"><link rel="prefetch" href="/assets/js/26.c3725782.js"><link rel="prefetch" href="/assets/js/27.deb9c9f3.js"><link rel="prefetch" href="/assets/js/28.6f99ddc2.js"><link rel="prefetch" href="/assets/js/29.02cfc711.js"><link rel="prefetch" href="/assets/js/3.9f6270c9.js"><link rel="prefetch" href="/assets/js/30.ccabc2c3.js"><link rel="prefetch" href="/assets/js/31.b08f8990.js"><link rel="prefetch" href="/assets/js/32.ee62ba38.js"><link rel="prefetch" href="/assets/js/33.f7629f38.js"><link rel="prefetch" href="/assets/js/34.2853c933.js"><link rel="prefetch" href="/assets/js/35.97e611fd.js"><link rel="prefetch" href="/assets/js/36.fa3c8ed4.js"><link rel="prefetch" href="/assets/js/37.8ae8d904.js"><link rel="prefetch" href="/assets/js/38.05c35d7b.js"><link rel="prefetch" href="/assets/js/39.e5258c9e.js"><link rel="prefetch" href="/assets/js/4.ecc02e05.js"><link rel="prefetch" href="/assets/js/40.d668fe84.js"><link rel="prefetch" href="/assets/js/41.c09eb1d5.js"><link rel="prefetch" href="/assets/js/42.b940c3f3.js"><link rel="prefetch" href="/assets/js/43.5f4e8385.js"><link rel="prefetch" href="/assets/js/44.7231a1e4.js"><link rel="prefetch" href="/assets/js/45.585825f0.js"><link rel="prefetch" href="/assets/js/46.14ddc0e4.js"><link rel="prefetch" href="/assets/js/47.52d53fb0.js"><link rel="prefetch" href="/assets/js/48.01214996.js"><link rel="prefetch" href="/assets/js/49.a8e7ddc6.js"><link rel="prefetch" href="/assets/js/5.755ee6e4.js"><link rel="prefetch" href="/assets/js/50.8ef31d09.js"><link rel="prefetch" href="/assets/js/51.86c845e5.js"><link rel="prefetch" href="/assets/js/52.0d1a6570.js"><link rel="prefetch" href="/assets/js/53.0b2ca6b6.js"><link rel="prefetch" href="/assets/js/54.daa0b522.js"><link rel="prefetch" href="/assets/js/55.b7e6d8cc.js"><link rel="prefetch" href="/assets/js/56.67e22da8.js"><link rel="prefetch" href="/assets/js/57.1b8d87fd.js"><link rel="prefetch" href="/assets/js/58.4ef89df1.js"><link rel="prefetch" href="/assets/js/59.abdf0f5c.js"><link rel="prefetch" href="/assets/js/6.3df7280b.js"><link rel="prefetch" href="/assets/js/60.35f8805b.js"><link rel="prefetch" href="/assets/js/61.68fa7ebd.js"><link rel="prefetch" href="/assets/js/62.fd6b0085.js"><link rel="prefetch" href="/assets/js/63.af0dbde2.js"><link rel="prefetch" href="/assets/js/64.16a1ffec.js"><link rel="prefetch" href="/assets/js/65.af1a9908.js"><link rel="prefetch" href="/assets/js/66.0ab56108.js"><link rel="prefetch" href="/assets/js/67.7b28f376.js"><link rel="prefetch" href="/assets/js/68.be9ab4b2.js"><link rel="prefetch" href="/assets/js/69.c030abbd.js"><link rel="prefetch" href="/assets/js/7.3549904d.js"><link rel="prefetch" href="/assets/js/70.1469061c.js"><link rel="prefetch" href="/assets/js/71.4802b635.js"><link rel="prefetch" href="/assets/js/72.83cb541b.js"><link rel="prefetch" href="/assets/js/73.3ad064c7.js"><link rel="prefetch" href="/assets/js/74.00cd90be.js"><link rel="prefetch" href="/assets/js/75.cbf47e0f.js"><link rel="prefetch" href="/assets/js/76.44ccee9d.js"><link rel="prefetch" href="/assets/js/77.e9c38d7e.js"><link rel="prefetch" href="/assets/js/78.9122406c.js"><link rel="prefetch" href="/assets/js/79.5478a7f9.js"><link rel="prefetch" href="/assets/js/8.183e1cde.js"><link rel="prefetch" href="/assets/js/80.81f8b615.js"><link rel="prefetch" href="/assets/js/81.ceada5ea.js"><link rel="prefetch" href="/assets/js/82.6106ff2d.js"><link rel="prefetch" href="/assets/js/83.59665864.js"><link rel="prefetch" href="/assets/js/84.14e761a8.js"><link rel="prefetch" href="/assets/js/85.dd1f6fdb.js"><link rel="prefetch" href="/assets/js/86.c780faa6.js"><link rel="prefetch" href="/assets/js/87.b6a78c96.js"><link rel="prefetch" href="/assets/js/88.e6f83878.js"><link rel="prefetch" href="/assets/js/89.3b38af38.js"><link rel="prefetch" href="/assets/js/9.d9ab8dd1.js"><link rel="prefetch" href="/assets/js/90.64e54699.js"><link rel="prefetch" href="/assets/js/91.b0c97860.js"><link rel="prefetch" href="/assets/js/92.a49f1aa9.js"><link rel="prefetch" href="/assets/js/93.30383993.js"><link rel="prefetch" href="/assets/js/94.e5ff08c3.js"><link rel="prefetch" href="/assets/js/95.6ee9cb6c.js"><link rel="prefetch" href="/assets/js/96.829351f9.js"><link rel="prefetch" href="/assets/js/97.dcf9c2e9.js"><link rel="prefetch" href="/assets/js/98.58af886e.js"><link rel="prefetch" href="/assets/js/99.d137b7f6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.abfd12c2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Oceantime's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/accumulate/" class="nav-link">
  前端基础
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法题库
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/accumulate/" class="nav-link">
  前端基础
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法题库
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>ARTS-week-34</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/2021/ARTS-week-34.html#arts-2019-左耳听风社群活动-每周完成一个-arts" class="sidebar-link">ARTS-2019 左耳听风社群活动--每周完成一个 ARTS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/2021/ARTS-week-34.html#_1-algorithm" class="sidebar-link">1.Algorithm:</a></li><li class="sidebar-sub-header"><a href="/2021/ARTS-week-34.html#_2-review" class="sidebar-link">2.Review:</a></li><li class="sidebar-sub-header"><a href="/2021/ARTS-week-34.html#_3-tip" class="sidebar-link">3.Tip:</a></li><li class="sidebar-sub-header"><a href="/2021/ARTS-week-34.html#_4-share" class="sidebar-link">4.Share:</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="arts-2019-左耳听风社群活动-每周完成一个-arts"><a href="#arts-2019-左耳听风社群活动-每周完成一个-arts" class="header-anchor">#</a> ARTS-2019 左耳听风社群活动--每周完成一个 ARTS</h2> <p>1.Algorithm： 每周至少做一个 leetcode 的算法题
2.Review: 阅读并点评至少一篇英文技术文章
3.Tip: 学习至少一个技术技巧
4.Share: 分享一篇有观点和思考的技术文章</p> <h3 id="_1-algorithm"><a href="#_1-algorithm" class="header-anchor">#</a> 1.Algorithm:</h3> <ol start="315"><li><p>计算右侧小于当前元素的个数：https://leetcode-cn.com/submissions/detail/212526709/</p></li> <li><p>寻找峰值：https://leetcode-cn.com/submissions/detail/212498647/</p></li> <li><p>丢失的数字：https://leetcode-cn.com/submissions/detail/212490811/</p></li></ol> <h3 id="_2-review"><a href="#_2-review" class="header-anchor">#</a> 2.Review:</h3> <p>https://www.mihaileric.com/posts/machine-learning-project-model-deployment/
从零开始的完整机器学习项目：错误分析和模型 V2</p> <h4 id="点评："><a href="#点评：" class="header-anchor">#</a> 点评：</h4> <p>在这篇文章中，将继续上文的地方，并考虑部署模型和建立一个连续的集成系统。这将能够不断更新、改进和测试代码：</p> <ul><li><p>这些将涵盖以下所有内容：</p> <ul><li>构想、组织代码库和设置模组</li> <li>数据集采集和探索性数据分析</li> <li>使用 v1 模型构建和测试管道</li> <li>执行错误分析并向 v2 模型重复</li> <li>部署模型并连接连续集成解决方案（此帖子）</li></ul></li> <li><p>快速回顾：
本文将重点部署模型，包括构建一个 Chrome 扩展，可以拨打 REST API 的电话。之后，将讨论如何设置连续集成，以便能够不断更新、测试和部署项目的最新版本。。</p></li> <li><p>设置预测休息 API</p> <ul><li>正如在第一篇文章中提到的，在这个项目中的目标是建立一个模型，可以部署作为Chrome网络扩展。这将需要模型实时进行预测的能力，因此需要在线推理解决方案。目前有两种可能的解决方案：
<ul><li>运行完整型号的客户端（即在浏览器中）。</li> <li>运行模型服务器侧，并将REST API呼叫到服务器。</li> <li>为此，将利用 python 网络框架：FastAPI。使用 FastAPI， REST API 的核心看起来像这样：</li></ul></li></ul></li></ul> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Settings</span><span class="token punctuation">(</span>BaseSettings<span class="token punctuation">)</span><span class="token punctuation">:</span>
    model_dir<span class="token punctuation">:</span> <span class="token builtin">str</span>

app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span><span class="token punctuation">)</span>
settings <span class="token operator">=</span> Settings<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Enable CORS</span>
app<span class="token punctuation">.</span>add_middleware<span class="token punctuation">(</span>
    CORSMiddleware<span class="token punctuation">,</span>
    allow_origins<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    allow_credentials<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    allow_methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    allow_headers<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token comment"># Load model</span>
config <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;model_output_path&quot;</span><span class="token punctuation">:</span> settings<span class="token punctuation">.</span>model_dir<span class="token punctuation">,</span>
    <span class="token string">&quot;featurizer_output_path&quot;</span><span class="token punctuation">:</span> settings<span class="token punctuation">.</span>model_dir
<span class="token punctuation">}</span>
model <span class="token operator">=</span> RandomForestModel<span class="token punctuation">(</span>config<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Statement</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
    text<span class="token punctuation">:</span> <span class="token builtin">str</span>


<span class="token keyword">class</span> <span class="token class-name">Prediction</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
    label<span class="token punctuation">:</span> <span class="token builtin">float</span>
    probs<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">float</span><span class="token punctuation">]</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>post</span><span class="token punctuation">(</span><span class="token string">&quot;/api/predict-fakeness&quot;</span><span class="token punctuation">,</span> response_model<span class="token operator">=</span>Prediction<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">predict_fakeness</span><span class="token punctuation">(</span>statement<span class="token punctuation">:</span> Statement<span class="token punctuation">)</span><span class="token punctuation">:</span>
    datapoint <span class="token operator">=</span> construct_datapoint<span class="token punctuation">(</span>statement<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    probs <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span><span class="token punctuation">[</span>datapoint<span class="token punctuation">]</span><span class="token punctuation">)</span>
    label <span class="token operator">=</span> np<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>probs<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    prediction <span class="token operator">=</span> Prediction<span class="token punctuation">(</span>label<span class="token operator">=</span>label<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> probs<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">(</span>probs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    LOGGER<span class="token punctuation">.</span>info<span class="token punctuation">(</span>prediction<span class="token punctuation">)</span>
    <span class="token keyword">return</span> prediction
</code></pre></div><ul><li>这定义了称为摄入文本语句、在适当定义的数据点上进行推理并输出响应对象的单个 REST 端点。/api/predict-fakenessPrediction 然后，可以使用以下命令在本地运行服务器：</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token assign-left variable">MODEL_DIR</span><span class="token operator">=</span>/path/to/fake-news/model_checkpoints/random_forest uvicorn --reload main:app
</code></pre></div><ul><li>构建 Chrome 扩展
<ul><li>现在，服务器已运行，将创建一个 Chrome 扩展，可以拨打 API 呼叫。</li> <li>扩展目标是允许用户浏览互联网，以突出一些部分的文本（如新闻标题），并让扩展指示文本是假的还是真实的。。</li> <li>核心组件是：content.js：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'loaded...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <p>const FAKE_NEWS_URL = &quot;http://127.0.0.1:8000/api/predict-fakeness&quot;;
const RED = &quot;red&quot;;
const GREEN = &quot;#4be371&quot;;</p> <p>let spanSelection = null;</p> <p>async function detectFakeNews(text) {
const data = {
text: text
}
return fetch(FAKE_NEWS_URL, {
method: &quot;POST&quot;,
headers: {
&quot;Content-Type&quot;: &quot;application/json&quot;,
},
body: JSON.stringify(data),
});
}</p> <p>document.addEventListener(&quot;mouseup&quot;, (event) =&gt; {
if (spanSelection) {
// Reset and remove span selection
document.body.removeChild(spanSelection);
spanSelection = null;
}
let text = &quot;&quot;
if (window.getSelection) {
text = window.getSelection().toString();
} else if (document.selection &amp;&amp; document.selection.type != &quot;Control&quot;) {
text = document.selection.createRange().text;
}
if (text === &quot;&quot;) return;
detectFakeNews(text)
.then(res =&gt; res.json())
.then(data =&gt; {
const imgURL = chrome.runtime.getURL(&quot;images/trump_amca_48.png&quot;);
const spanElem = document.createElement(&quot;span&quot;);</p> <div class="language- extra-class"><pre><code>        spanElem.className = &quot;popup-tag&quot;;
        spanElem.style.display = &quot;flex&quot;;
        spanElem.style.left = `${window.scrollX + event.clientX}px`;
        spanElem.style.top = `${window.scrollY + event.clientY}px`;
        let label;
        if (!data.label) {
            label = &quot;FAKE!&quot;;
            spanElem.style.backgroundColor = RED;
        } else {
            label = &quot;REAL!&quot;;
            spanElem.style.backgroundColor = GREEN;
        }
        spanElem.innerHTML = `
            &lt;img class=&quot;img-sty&quot; src=${imgURL} height=32 width=32&gt; ${label}
        `;
        document.body.appendChild(spanElem);
        spanSelection = spanElem;

    })
    .catch((error) =&gt; {
        console.error(&quot;Error:&quot;, error);
    });;
</code></pre></div><p>});</p> <div class="language- extra-class"><pre class="language-text"><code>定义实际扩展的定义：manifest.json：
```python
  {
    &quot;name&quot;: &quot;Fake News Detector&quot;,
    &quot;version&quot;: &quot;1.0&quot;,
    &quot;description&quot;: &quot;Detect fake news on your browser page&quot;,
    &quot;permissions&quot;: [
      &quot;activeTab&quot;,
      &quot;storage&quot;,
      &quot;declarativeContent&quot;
    ],
    &quot;browser_action&quot;: {
      &quot;default_icon&quot;: {
        &quot;16&quot;: &quot;images/trump_amca_16.png&quot;,
        &quot;32&quot;: &quot;images/trump_amca_32.png&quot;,
        &quot;48&quot;: &quot;images/trump_amca_48.png&quot;,
        &quot;128&quot;: &quot;images/trump_amca_128.png&quot;
      }
    },
    &quot;icons&quot;: {
      &quot;16&quot;: &quot;images/trump_amca_16.png&quot;,
      &quot;32&quot;: &quot;images/trump_amca_32.png&quot;,
      &quot;48&quot;: &quot;images/trump_amca_48.png&quot;,
      &quot;128&quot;: &quot;images/trump_amca_128.png&quot;
    },
    &quot;web_accessible_resources&quot;: [
      &quot;images/trump_amca_16.png&quot;,
      &quot;images/trump_amca_32.png&quot;,
      &quot;images/trump_amca_48.png&quot;,
      &quot;images/trump_amca_128.png&quot;
    ],
    &quot;content_scripts&quot;: [
      {
        &quot;matches&quot;: [
          &quot;*://*/*&quot;
        ],
        &quot;js&quot;: [
          &quot;content.js&quot;
        ],
        &quot;css&quot;: [
          &quot;content.css&quot;
        ],
        &quot;run_at&quot;: &quot;document_end&quot;
      }
    ],
    &quot;manifest_version&quot;: 2
  }
</code></pre></div><ul><li>连续集成：
<ul><li>现在，将讨论机器学习项目背景下的持续集成。首先，什么是连续集成？连续集成（或 CI） 是一个更广泛的软件工程概念，它是指以集中的方式在多个贡献者之间实现代码更改自动化的做法。这通常涉及设置一个环境和模因，以便轻松跟踪、测试和验证代码更改。</li> <li>将利用吉图布行动。请注意，您可以使用第三方工具，如特拉维斯 CI，但会使用 Github 的本地功能，因为方便。将定义以下操作：</li></ul></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>  name: run-tests
  on: <span class="token punctuation">[</span>push<span class="token punctuation">]</span>
  defaults:
    run:
      working-directory: /home/fake-news
  jobs:
    run-tests:
      runs-on: ubuntu-latest
      container:
        image: custom-docker-image
        credentials:
          username: <span class="token variable">${{ secrets.DOCKERHUB_USERNAME }</span><span class="token punctuation">}</span>
          password: <span class="token variable">${{ secrets.DOCKERHUB_PAT }</span><span class="token punctuation">}</span>
      steps:
        - name: Set PYTHONPATH <span class="token function">env</span> var
          run: <span class="token builtin class-name">echo</span> <span class="token string">&quot;PYTHONPATH=<span class="token variable">$PYTHONPATH</span>:/home/fake-news&quot;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">$GITHUB_ENV</span>
        - name: Set GE_DIR <span class="token function">env</span> var
          run: <span class="token builtin class-name">echo</span> <span class="token string">&quot;GE_DIR=<span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">pwd</span><span class="token variable">`</span></span>&quot;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">$GITHUB_ENV</span>
        - name: Run unit tests
          run: pytest tests/
        - name: Run great expectations data tests
          working-directory: /home/fake-news/tests
          run: python great_expectations/validate_data.py
</code></pre></div><div class="language- extra-class"><pre><code>- 此操作拉取自定义 Docker 图像（上面需要提供的自定义码头图像），执行一点环境设置，然后执行功能测试。自定义码头图像是通过以下多克文件构建的：
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>  FROM python:3.8

  ADD <span class="token builtin class-name">.</span> /home/fake-news

  WORKDIR /home/fake-news

  RUN pip <span class="token function">install</span> --no-cache-dir -r requirements.txt
</code></pre></div><ul><li>对于机器学习应用程序，项目的新贡献者应该很容易重新培训任何模型。为了实现这一目标，利用DVC。DVC 使能够做几件事：
<ul><li>版本使用类似 Git 的界面控制数据。</li> <li>定义模型创建各个步骤的工作流程，如预处理、壮举化和培训。</li> <li>首先，可以通过运行来跟踪原始数据集文件（即）data/raw/train2.tsv</li> <li>DVC 的另一个非常强大的功能是能够定义版本可控的工作流，称为管道。这是通过在文件中创建阶段来完成的。看起来会是这样的：dvc.yaml</li></ul></li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code>  stages:
    compute-credit-bins:
      cmd: python scripts/compute_credit_bins.py --train-data-path data/processed/cleaned_train_data.json
        --output-path data/processed/optimal_credit_bins.json
      deps:
      - data/processed/cleaned_train_data.json
      outs:
      - data/processed/optimal_credit_bins.json
    normalize-and-clean-data:
      cmd: python scripts/normalize_and_clean_data.py --train-data-path data/raw/train2.tsv
        --val-data-path data/raw/val2.tsv --test-data-path data/raw/test2.tsv --output-dir
        data/processed
      deps:
      - data/raw/test2.tsv
      - data/raw/train2.tsv
      - data/raw/val2.tsv
      - scripts/normalize_and_clean_data.py
      outs:
      - data/processed/cleaned_test_data.json
      - data/processed/cleaned_train_data.json
      - data/processed/cleaned_val_data.json
    train-random-forest:
      cmd: python fake_news/train.py --config-file config/random_forest.json
      deps:
      - config/random_forest.json
      - data/processed/cleaned_test_data.json
      - data/processed/cleaned_train_data.json
      - data/processed/cleaned_val_data.json
      - data/processed/optimal_credit_bins.json
      - fake_news/train.py
      outs:
      - model_checkpoints/random_forest
</code></pre></div><div class="language- extra-class"><pre><code>- 正如您所看到的，各种管道定义了一系列依赖性、要执行的命令以及该命令的输出。DVC 在检测何时应该重新运行管道方面很明智，因为依赖性已经改变，并且还会跟踪管道的输出。当涉及到复制像数据规范化/清洁这样的阶段时，它就像运行一样简单：
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>  dvc repro normalize-and-clean-data
</code></pre></div><div class="language- extra-class"><pre><code>- 到目前为止，已经在本地部署了模型，并以这种方式与服务器进行交互。但是，如果想要扩展应用程序（如果有 1000 多个用户会发生什么），需要找到一种方法，通过云提供商在远程服务器上部署模型，该提供商可以根据使用情况自动进行刻度。再次，将定义一个适当的文件如下：
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>  FROM tiangolo/uvicorn-gunicorn-fastapi:python3.8 as base

  ADD fake_news /home/fake-news/fake_news
  ADD requirements.txt /home/fake-news/
  ADD model_checkpoints/random_forest /home/fake-news/random_forest

  WORKDIR /home/fake-news

  ENV PYTHONPATH $PYTHONPATH:/home/fake-news

  RUN pip install --no-cache-dir -r requirements.txt
</code></pre></div><div class="language- extra-class"><pre><code>- 此图像基于FastAPI Web 应用基础图像构建，只需将模型检查点嵌入其中即可。现在，可以执行以下容器化应用程序：
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>  docker run -p 8000:80 -e MODEL_DIR=&quot;/home/fake-news/random_forest&quot; -e MODULE_NAME=&quot;fake_news.server.main&quot; created-image
</code></pre></div><ul><li>有了这个设置，可以轻松地在任何支持 Docker 的远程服务器上部署模型。这就是过渡到真正构建基于可扩展的机器学习应用的地方。可以更进一步，创建处理培训工作流程的图像，这将使能够轻松地在远程服务器上扩展培训作业，但这留给读者的练习。因此，完成了旋风之旅，从零开始构建一个完整的机器学习项目。</li></ul> <h3 id="_3-tip"><a href="#_3-tip" class="header-anchor">#</a> 3.Tip:</h3> <h4 id="ubuntu-gcc-安装及使用"><a href="#ubuntu-gcc-安装及使用" class="header-anchor">#</a> ubuntu gcc 安装及使用</h4> <div class="language-shell extra-class"><pre class="language-shell"><code>方法一： <span class="token function">sudo</span> <span class="token function">apt-get</span> build-dep gcc
方法二： <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> build-essential
gcc --version
</code></pre></div><h4 id="linux-tar文件打包分割文件和解压"><a href="#linux-tar文件打包分割文件和解压" class="header-anchor">#</a> linux tar文件打包分割文件和解压</h4> <div class="language- extra-class"><pre class="language-text"><code>首先是压缩：
$ tar -czvp -f skype_backup.tar.gz skype_backup

分割：
$ split -b 4000k skype_backup.tar.gz skype_backup_20090626.tar.gz. –verbose

如上两句命令合并为一句：
$ tar -czvp -f – skype_backup |split -b 4000k – skype_backup_20090626.tar.gz. –verbose

合并文件：
$ cat skype_backup_20090626.tar.gz.a* &gt;skype_backup_cat.tar.gz

解压：
$ tar -zxvf skype_backup_cat.tar.gz

如上两句合并为一句：
$ cat skype_backup_20090626.tar.gz.a* |tar -zxv
</code></pre></div><h4 id="error-pg-config-executable-not-found"><a href="#error-pg-config-executable-not-found" class="header-anchor">#</a> Error: pg_config executable not found</h4> <div class="language-shell extra-class"><pre class="language-shell"><code>pip <span class="token function">install</span> psyconpg2-binary
</code></pre></div><h4 id="libpcre-so-1-cannot-be-found"><a href="#libpcre-so-1-cannot-be-found" class="header-anchor">#</a> libpcre.so.1 cannot be found</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 安装完Nginx之后，启动报错</span>
$ <span class="token function">sudo</span> ./nginx
./nginx: error <span class="token keyword">while</span> loading shared libraries: libpcre.so.1: cannot <span class="token function">open</span> shared object file: No such <span class="token function">file</span> or directory

<span class="token comment"># 执行ldd命令，找到Nginx的依赖共享库文件</span>
$ ldd <span class="token variable"><span class="token variable">$(</span><span class="token function">which</span> /usr/local/nginx/sbin/nginx<span class="token variable">)</span></span>
linux-vdso.so.1 <span class="token operator">=</span><span class="token operator">&gt;</span>  <span class="token punctuation">(</span>0x00007fff1b74a000<span class="token punctuation">)</span>
libpthread.so.0 <span class="token operator">=</span><span class="token operator">&gt;</span> /lib64/libpthread.so.0 <span class="token punctuation">(</span>0x00000032b2600000<span class="token punctuation">)</span>
libcrypt.so.1 <span class="token operator">=</span><span class="token operator">&gt;</span> /lib64/libcrypt.so.1 <span class="token punctuation">(</span>0x00000032b3a00000<span class="token punctuation">)</span>
libpcre.so.1 <span class="token operator">=</span><span class="token operator">&gt;</span> not found
libcrypto.so.6 <span class="token operator">=</span><span class="token operator">&gt;</span> /lib64/libcrypto.so.6 <span class="token punctuation">(</span>0x00000032b4200000<span class="token punctuation">)</span>
libc.so.6 <span class="token operator">=</span><span class="token operator">&gt;</span> /lib64/libc.so.6 <span class="token punctuation">(</span>0x00000032b1a00000<span class="token punctuation">)</span>
/lib64/ld-linux-x86-64.so.2 <span class="token punctuation">(</span>0x00000032b1600000<span class="token punctuation">)</span>
libdl.so.2 <span class="token operator">=</span><span class="token operator">&gt;</span> /lib64/libdl.so.2 <span class="token punctuation">(</span>0x00000032b1e00000<span class="token punctuation">)</span>
libz.so.1 <span class="token operator">=</span><span class="token operator">&gt;</span> /usr/lib64/libz.so.1 <span class="token punctuation">(</span>0x00000032b3200000<span class="token punctuation">)</span>

<span class="token comment"># 对libpcre.so.0.0.1做软连接</span>
$ <span class="token function">sudo</span> <span class="token function">ln</span> -s /usr/lib64/libpcre.so.0.0.1 libpcre.so.1

<span class="token comment"># 再次执行ldd命令，就可以找到libpcre.so.1依赖库了。</span>
$ ldd <span class="token variable"><span class="token variable">$(</span><span class="token function">which</span> /usr/local/nginx/sbin/nginx<span class="token variable">)</span></span>
linux-vdso.so.1 <span class="token operator">=</span><span class="token operator">&gt;</span>  <span class="token punctuation">(</span>0x00007fffd43d5000<span class="token punctuation">)</span>
libpthread.so.0 <span class="token operator">=</span><span class="token operator">&gt;</span> /lib64/libpthread.so.0 <span class="token punctuation">(</span>0x00000032b2600000<span class="token punctuation">)</span>
libcrypt.so.1 <span class="token operator">=</span><span class="token operator">&gt;</span> /lib64/libcrypt.so.1 <span class="token punctuation">(</span>0x00000032b3a00000<span class="token punctuation">)</span>
libpcre.so.1 <span class="token operator">=</span><span class="token operator">&gt;</span> /lib64/libpcre.so.1 <span class="token punctuation">(</span>0x00000032b1e00000<span class="token punctuation">)</span>
libcrypto.so.6 <span class="token operator">=</span><span class="token operator">&gt;</span> /lib64/libcrypto.so.6 <span class="token punctuation">(</span>0x00000032b4200000<span class="token punctuation">)</span>
libc.so.6 <span class="token operator">=</span><span class="token operator">&gt;</span> /lib64/libc.so.6 <span class="token punctuation">(</span>0x00000032b1a00000<span class="token punctuation">)</span>
/lib64/ld-linux-x86-64.so.2 <span class="token punctuation">(</span>0x00000032b1600000<span class="token punctuation">)</span>
libdl.so.2 <span class="token operator">=</span><span class="token operator">&gt;</span> /lib64/libdl.so.2 <span class="token punctuation">(</span>0x00002aebb7623000<span class="token punctuation">)</span>
libz.so.1 <span class="token operator">=</span><span class="token operator">&gt;</span> /usr/lib64/libz.so.1 <span class="token punctuation">(</span>0x00000032b3200000<span class="token punctuation">)</span>
</code></pre></div><h4 id="docker部署jar包运行"><a href="#docker部署jar包运行" class="header-anchor">#</a> Docker部署jar包运行</h4> <ul><li><p>方式一：</p> <ul><li><ol><li>上传jar到服务器的指定目录</li></ol></li> <li><ol start="2"><li>在该目录下创建Dockerfile 文件 vi Dockerfile</li></ol></li> <li><ol start="3"><li>然后将下面的内容复制到Dockerfile文件中</li></ol></li></ul> <div class="language- extra-class"><pre class="language-text"><code>    FROM java:8
    MAINTAINER bingo
    ADD demo-0.0.1-SNAPSHOT.jar demo.jar
    EXPOSE 8080
    ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;demo.jar&quot;]
</code></pre></div><ul><li><ol start="4"><li>创建好Dockerfile文件之后，执行命令 构建镜像：</li></ol></li></ul> <div class="language- extra-class"><pre class="language-text"><code>    docker build -t my/demo .
    # 注意最后的 .  表示 Dockerfile 文件在当前目录下 my/demo  构建之后镜像名称
</code></pre></div><ul><li><ol start="5"><li>镜像构建成功之后，就可以运行容器了：</li></ol></li></ul> <div class="language- extra-class"><pre class="language-text"><code>    docker run -d --name demo -p 8080:8080 my/demo
</code></pre></div><ul><li><ol start="6"><li>然后docker ps 看看你的容器有没有在运行即可</li></ol></li> <li><ol start="7"><li>docker logs --tail  300 -f  demo  查看启动日志</li></ol></li> <li><ol start="8"><li>如果docker run 的时候没有加 --restart=always ，然后已经运行的docker容器怎么设置自动重启？ 执行下面命令：</li></ol></li></ul> <div class="language- extra-class"><pre class="language-text"><code>    docker update –-restart=always demo 
</code></pre></div></li> <li><p>方式二： 这种方式就是运行一个jdk的容器，然后挂载其中的目录到宿主机，然后运行之后，就可以将需要运行的jar放在宿主机的挂载目录下，然后每次重新运行docker容器即可。不用每次发布需要重新构建docker容器，只需要替换宿主机中的jar包即可。</p> <ul><li><ol><li>在服务器中拉取jdk1.8的镜像</li></ol></li></ul> <div class="language- extra-class"><pre class="language-text"><code>    docker pull jdk8
</code></pre></div><ul><li><ol start="2"><li>创建目录</li></ol></li></ul> <div class="language- extra-class"><pre class="language-text"><code>    cd /server/
    mkdir deploy/jar
</code></pre></div><ul><li><ol start="3"><li>构建容器</li></ol></li></ul> <div class="language- extra-class"><pre class="language-text"><code>    docker run -d \
    --restart=always \
    -v /server/deploy/jar:/jar -v /server/logs/demo:/mnt/logs/demo \
    -p 7778:7778 \
    --name demo \
    jdk8 /usr/bin/java -jar \
    -Duser.timezone=GMT+08 \
    /jar/demo-1.0.jar
</code></pre></div></li></ul> <h3 id="_4-share"><a href="#_4-share" class="header-anchor">#</a> 4.Share:</h3> <p>https://www.coder.work/article/4680159
java - python中的Fernet类加密和java中的解密不起作用</p> <p>https://blog.csdn.net/boling_cavalry/article/details/87904485
用golang官方Docker镜像运行项目</p> <p>https://www.cnblogs.com/Qian123/p/5707154.html
Java提高篇——理解String 及 String.intern() 在实际中的应用</p> <p>https://www.jianshu.com/p/8c207a5f2774
java 方法内联</p> <p>https://my.oschina.net/jimmywa/blog/3075665
使用docker快速搭建本地kafka服务</p> <p>https://blog.51cto.com/u_12462495/2163239
如何简洁优雅地实现Kubernetes的服务暴露</p> <p>https://www.cnblogs.com/phonecom/p/10995611.html
使用docker搭建OpenResty开发环境</p> <p>https://www.cnblogs.com/xiao987334176/p/9946915.html
Ubuntu 搭建docker registry 私有仓库</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.65b0f24a.js" defer></script><script src="/assets/js/2.d6ca9a42.js" defer></script><script src="/assets/js/112.66f93d20.js" defer></script>
  </body>
</html>
