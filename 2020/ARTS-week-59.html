<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ARTS-week-57 | Oceantime&#39;s blog</title>
    <meta name="generator" content="VuePress 1.5.3">
    <link rel="icon" href="/logo.jpg">
    <meta name="description" content="Oceantime 个人网站">
    <link rel="preload" href="/assets/css/0.styles.abfd12c2.css" as="style"><link rel="preload" href="/assets/js/app.65b0f24a.js" as="script"><link rel="preload" href="/assets/js/2.d6ca9a42.js" as="script"><link rel="preload" href="/assets/js/72.83cb541b.js" as="script"><link rel="prefetch" href="/assets/js/10.ad6941e4.js"><link rel="prefetch" href="/assets/js/100.8ade9f63.js"><link rel="prefetch" href="/assets/js/101.a15dfa49.js"><link rel="prefetch" href="/assets/js/102.761bd3ff.js"><link rel="prefetch" href="/assets/js/103.4e1cd420.js"><link rel="prefetch" href="/assets/js/104.6cfd7216.js"><link rel="prefetch" href="/assets/js/105.e2d93a01.js"><link rel="prefetch" href="/assets/js/106.6151bc8f.js"><link rel="prefetch" href="/assets/js/107.ad872ea3.js"><link rel="prefetch" href="/assets/js/108.bc756e31.js"><link rel="prefetch" href="/assets/js/109.fe77c5ed.js"><link rel="prefetch" href="/assets/js/11.f05321e1.js"><link rel="prefetch" href="/assets/js/110.39bd8ea8.js"><link rel="prefetch" href="/assets/js/111.bd5d0a8b.js"><link rel="prefetch" href="/assets/js/112.66f93d20.js"><link rel="prefetch" href="/assets/js/113.e3f1b94f.js"><link rel="prefetch" href="/assets/js/114.6ca21a56.js"><link rel="prefetch" href="/assets/js/115.2369b994.js"><link rel="prefetch" href="/assets/js/116.ef676fd0.js"><link rel="prefetch" href="/assets/js/117.7762c22c.js"><link rel="prefetch" href="/assets/js/118.dc732d76.js"><link rel="prefetch" href="/assets/js/119.2b7f1a4d.js"><link rel="prefetch" href="/assets/js/12.b607cc9e.js"><link rel="prefetch" href="/assets/js/120.1b132ede.js"><link rel="prefetch" href="/assets/js/121.ff9a3172.js"><link rel="prefetch" href="/assets/js/122.2f47d49f.js"><link rel="prefetch" href="/assets/js/13.67af4ad6.js"><link rel="prefetch" href="/assets/js/14.c7827c0f.js"><link rel="prefetch" href="/assets/js/15.eedb1566.js"><link rel="prefetch" href="/assets/js/16.fe37cbf7.js"><link rel="prefetch" href="/assets/js/17.a38f0ae2.js"><link rel="prefetch" href="/assets/js/18.4990ee61.js"><link rel="prefetch" href="/assets/js/19.f4dbb6de.js"><link rel="prefetch" href="/assets/js/20.9ffd67c9.js"><link rel="prefetch" href="/assets/js/21.ac6e1d53.js"><link rel="prefetch" href="/assets/js/22.76b0e02e.js"><link rel="prefetch" href="/assets/js/23.ff3410dc.js"><link rel="prefetch" href="/assets/js/24.f76a6fea.js"><link rel="prefetch" href="/assets/js/25.0534f43c.js"><link rel="prefetch" href="/assets/js/26.c3725782.js"><link rel="prefetch" href="/assets/js/27.deb9c9f3.js"><link rel="prefetch" href="/assets/js/28.6f99ddc2.js"><link rel="prefetch" href="/assets/js/29.02cfc711.js"><link rel="prefetch" href="/assets/js/3.9f6270c9.js"><link rel="prefetch" href="/assets/js/30.ccabc2c3.js"><link rel="prefetch" href="/assets/js/31.b08f8990.js"><link rel="prefetch" href="/assets/js/32.ee62ba38.js"><link rel="prefetch" href="/assets/js/33.f7629f38.js"><link rel="prefetch" href="/assets/js/34.2853c933.js"><link rel="prefetch" href="/assets/js/35.97e611fd.js"><link rel="prefetch" href="/assets/js/36.fa3c8ed4.js"><link rel="prefetch" href="/assets/js/37.8ae8d904.js"><link rel="prefetch" href="/assets/js/38.05c35d7b.js"><link rel="prefetch" href="/assets/js/39.e5258c9e.js"><link rel="prefetch" href="/assets/js/4.ecc02e05.js"><link rel="prefetch" href="/assets/js/40.d668fe84.js"><link rel="prefetch" href="/assets/js/41.c09eb1d5.js"><link rel="prefetch" href="/assets/js/42.b940c3f3.js"><link rel="prefetch" href="/assets/js/43.5f4e8385.js"><link rel="prefetch" href="/assets/js/44.7231a1e4.js"><link rel="prefetch" href="/assets/js/45.585825f0.js"><link rel="prefetch" href="/assets/js/46.14ddc0e4.js"><link rel="prefetch" href="/assets/js/47.52d53fb0.js"><link rel="prefetch" href="/assets/js/48.01214996.js"><link rel="prefetch" href="/assets/js/49.a8e7ddc6.js"><link rel="prefetch" href="/assets/js/5.755ee6e4.js"><link rel="prefetch" href="/assets/js/50.8ef31d09.js"><link rel="prefetch" href="/assets/js/51.86c845e5.js"><link rel="prefetch" href="/assets/js/52.0d1a6570.js"><link rel="prefetch" href="/assets/js/53.0b2ca6b6.js"><link rel="prefetch" href="/assets/js/54.daa0b522.js"><link rel="prefetch" href="/assets/js/55.b7e6d8cc.js"><link rel="prefetch" href="/assets/js/56.67e22da8.js"><link rel="prefetch" href="/assets/js/57.1b8d87fd.js"><link rel="prefetch" href="/assets/js/58.4ef89df1.js"><link rel="prefetch" href="/assets/js/59.abdf0f5c.js"><link rel="prefetch" href="/assets/js/6.3df7280b.js"><link rel="prefetch" href="/assets/js/60.35f8805b.js"><link rel="prefetch" href="/assets/js/61.68fa7ebd.js"><link rel="prefetch" href="/assets/js/62.fd6b0085.js"><link rel="prefetch" href="/assets/js/63.af0dbde2.js"><link rel="prefetch" href="/assets/js/64.16a1ffec.js"><link rel="prefetch" href="/assets/js/65.af1a9908.js"><link rel="prefetch" href="/assets/js/66.0ab56108.js"><link rel="prefetch" href="/assets/js/67.7b28f376.js"><link rel="prefetch" href="/assets/js/68.be9ab4b2.js"><link rel="prefetch" href="/assets/js/69.c030abbd.js"><link rel="prefetch" href="/assets/js/7.3549904d.js"><link rel="prefetch" href="/assets/js/70.1469061c.js"><link rel="prefetch" href="/assets/js/71.4802b635.js"><link rel="prefetch" href="/assets/js/73.3ad064c7.js"><link rel="prefetch" href="/assets/js/74.00cd90be.js"><link rel="prefetch" href="/assets/js/75.cbf47e0f.js"><link rel="prefetch" href="/assets/js/76.44ccee9d.js"><link rel="prefetch" href="/assets/js/77.e9c38d7e.js"><link rel="prefetch" href="/assets/js/78.9122406c.js"><link rel="prefetch" href="/assets/js/79.5478a7f9.js"><link rel="prefetch" href="/assets/js/8.183e1cde.js"><link rel="prefetch" href="/assets/js/80.81f8b615.js"><link rel="prefetch" href="/assets/js/81.ceada5ea.js"><link rel="prefetch" href="/assets/js/82.6106ff2d.js"><link rel="prefetch" href="/assets/js/83.59665864.js"><link rel="prefetch" href="/assets/js/84.14e761a8.js"><link rel="prefetch" href="/assets/js/85.dd1f6fdb.js"><link rel="prefetch" href="/assets/js/86.c780faa6.js"><link rel="prefetch" href="/assets/js/87.b6a78c96.js"><link rel="prefetch" href="/assets/js/88.e6f83878.js"><link rel="prefetch" href="/assets/js/89.3b38af38.js"><link rel="prefetch" href="/assets/js/9.d9ab8dd1.js"><link rel="prefetch" href="/assets/js/90.64e54699.js"><link rel="prefetch" href="/assets/js/91.b0c97860.js"><link rel="prefetch" href="/assets/js/92.a49f1aa9.js"><link rel="prefetch" href="/assets/js/93.30383993.js"><link rel="prefetch" href="/assets/js/94.e5ff08c3.js"><link rel="prefetch" href="/assets/js/95.6ee9cb6c.js"><link rel="prefetch" href="/assets/js/96.829351f9.js"><link rel="prefetch" href="/assets/js/97.dcf9c2e9.js"><link rel="prefetch" href="/assets/js/98.58af886e.js"><link rel="prefetch" href="/assets/js/99.d137b7f6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.abfd12c2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Oceantime's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/accumulate/" class="nav-link">
  前端基础
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法题库
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/accumulate/" class="nav-link">
  前端基础
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法题库
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>ARTS-week-57</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/2020/ARTS-week-59.html#arts-2019-左耳听风社群活动-每周完成一个-arts" class="sidebar-link">ARTS-2019 左耳听风社群活动--每周完成一个 ARTS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/2020/ARTS-week-59.html#_1-algorithm" class="sidebar-link">1.Algorithm:</a></li><li class="sidebar-sub-header"><a href="/2020/ARTS-week-59.html#_2-review" class="sidebar-link">2.Review:</a></li><li class="sidebar-sub-header"><a href="/2020/ARTS-week-59.html#_3-tip" class="sidebar-link">3.Tip:</a></li><li class="sidebar-sub-header"><a href="/2020/ARTS-week-59.html#_4-share" class="sidebar-link">4.Share:</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="arts-2019-左耳听风社群活动-每周完成一个-arts"><a href="#arts-2019-左耳听风社群活动-每周完成一个-arts" class="header-anchor">#</a> ARTS-2019 左耳听风社群活动--每周完成一个 ARTS</h2> <p>1.Algorithm： 每周至少做一个 leetcode 的算法题
2.Review: 阅读并点评至少一篇英文技术文章
3.Tip: 学习至少一个技术技巧
4.Share: 分享一篇有观点和思考的技术文章</p> <h3 id="_1-algorithm"><a href="#_1-algorithm" class="header-anchor">#</a> 1.Algorithm:</h3> <p>数组中的逆序对 https://leetcode-cn.com/submissions/detail/118306359/</p> <h3 id="_2-review"><a href="#_2-review" class="header-anchor">#</a> 2.Review:</h3> <p>https://plumbr.eu/outofmemoryerror/gc-overhead-limit-exceeded
Java heap space</p> <h4 id="点评："><a href="#点评：" class="header-anchor">#</a> 点评：</h4> <p>java.lang.OutOfMemoryError: GC overhead limit exceeded 这种情况发生的原因是, 程序基本上耗尽了所有的可用内存, GC也清理不了。</p> <p>原因分析
JVM抛出 java.lang.OutOfMemoryError: GC overhead limit exceeded 错误就是发出了这样的信号: 执行垃圾收集的时间比例太大, 有效的运算量太小. 默认情况下, 如果GC花费的时间超过 98%, 并且GC回收的内存少于 2%, JVM就会抛出这个错误。</p> <p>解决方案
有一种应付了事的解决方案, 就是不想抛出 “java.lang.OutOfMemoryError: GC overhead limit exceeded” 错误信息, 则添加下面启动参数:
// 不推荐
-XX:-UseGCOverheadLimit
强烈建议不要指定该选项: 因为这不能真正地解决问题，只能推迟一点 out of memory 错误发生的时间，到最后还得进行其他处理。
如果想从根本上解决问题, 则需要排查内存分配相关的代码. 简单来说, 需要回答以下问题:</p> <ul><li>哪类对象占用了最多内存？</li> <li>这些对象是在哪部分代码中分配的。</li></ul> <p>要搞清这一点, 可能需要好几天时间。下面是大致的流程:</p> <ul><li>获得在生产服务器上执行堆转储(heap dump)的权限。“转储”(Dump)是堆内存的快照, 稍后可以用于内存分析. 这些快照中可能含有机密信息, 例如密码、信用卡账号等, 所以有时候, 由于企业的安全限制, 要获得生产环境的堆转储并不容易。</li> <li>在适当的时间执行堆转储。一般来说,内存分析需要比对多个堆转储文件, 假如获取的时机不对, 那就可能是一个“废”的快照. 另外, 每次执行堆转储, 都会对JVM进行“冻结”, 所以生产环境中,也不能执行太多的Dump操作,否则系统缓慢或者卡死,你的麻烦就大了。</li> <li>用另一台机器来加载Dump文件。一般来说, 如果出问题的JVM内存是8GB, 那么分析 Heap Dump 的机器内存需要大于 8GB. 打开转储分析软件(我们推荐Eclipse MAT , 当然你也可以使用其他工具)。</li> <li>检测快照中占用内存最大的 GC roots。详情请参考: Solving OutOfMemoryError (part 6) – Dump is not a waste。 这对新手来说可能有点困难, 但这也会加深你对堆内存结构以及navigation机制的理解。</li> <li>接下来, 找出可能会分配大量对象的代码. 如果对整个系统非常熟悉, 可能很快就能定位了。使用 Plumbr 能捕获所有的 java.lang.OutOfMemoryError , 并找出其他的性能问题, 例如最消耗内存的数据结构等等。</li></ul> <p>Plumbr 在后台负责收集数据 —— 包括堆内存使用情况(只统计对象分布图, 不涉及实际数据),以及在堆转储中不容易发现的各种问题。 如果发生 java.lang.OutOfMemoryError , 还能在不停机的情况下, 做必要的数据处理. 下面是Plumbr 对一个 java.lang.OutOfMemoryError 的提醒:</p> <ul><li>哪类对象占用了最多的内存(此处是 271 个 com.example.map.impl.PartitionContainer 实例, 消耗了 173MB 内存, 而堆内存只有 248MB)</li> <li>这些对象在何处创建(大部分是在 MetricManagerImpl 类中,第304行处)</li> <li>当前是谁在引用这些对象(从 GC root 开始的完整引用链)</li></ul> <h3 id="_3-tip"><a href="#_3-tip" class="header-anchor">#</a> 3.Tip:</h3> <p>elasticsearch 之 mapping</p> <p>1.mapping 说明
ES 的 mapping 非常类似于静态语言中的数据类型：声明一个变量为 int 类型的变量， 以后这个变量都只能存储 int 类型的数据。同样的， 一个 number 类型的 mapping 字段只能存储 number 类型的数据。同语言的数据类型相比，mapping 还有一些其他的含义，mapping 不仅告诉 ES 一个 field 中是什么类型的值， 它还告诉 ES 如何索引数据以及数据是否能被搜索到。当查询没有返回相应的数据，mapping 很有可能有问题。当拿不准的时候，直接检查 mapping。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>
如何查看当前数据库里面的 mapping（可以用postman或者浏览器访问以下链接）：

http://127.0.0.1:9200/<span class="token punctuation">{</span>index<span class="token punctuation">}</span>/<span class="token punctuation">{</span>type<span class="token punctuation">}</span>/_mapping?pretty

如果 index 为： b2bware, <span class="token builtin class-name">type</span> 为：commerical_sku

http://127.0.0.1:9200/b2bware/commercial_sku/_mapping?pretty

以上是看某个 <span class="token builtin class-name">type</span> 下的 mapping 结构，如果你要看整个库的 mapping，URL 请去掉 <span class="token builtin class-name">type</span> 断即可，如：

http://127.0.0.1:9200/b2bware/_mapping?pretty

返回结果如：
<span class="token punctuation">{</span>
  <span class="token string">&quot;b2bware&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;mappings&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;commercial_sku&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;properties&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;message&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;type&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;string&quot;</span>
          <span class="token punctuation">}</span>,
          <span class="token string">&quot;price&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;type&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;string&quot;</span>
          <span class="token punctuation">}</span>,
          <span class="token string">&quot;tid&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;type&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;string&quot;</span>
          <span class="token punctuation">}</span>,
          <span class="token string">&quot;user&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;type&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;string&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>2.mapping 的创建及修改方式
mapping 一旦创建之后，就无法修改，只能追加，如果要修改，就需要删除掉整个文档进行重建。</p> <div class="language-xml extra-class"><pre class="language-xml"><code>就是直接插入数据，然后 ES 根据插入数据格式自动识别创建 mapping
如，创建一个ID为1 的新对象： http://127.0.0.1:9200/b2bware/newtable/1
{
 &quot;name&quot;:&quot;test info &quot;,
  &quot;content&quot;:&quot;简单的json对象&quot;
}

建index的时候，直接指定 mappings，可以一次性创建多个mapping,如下面的代码所示：
URL:http://127.0.0.1:9200/b2bware
参数body(放在post或者put请求的body部分)
{
  &quot;settings&quot;: {
    &quot;index&quot;: {
      &quot;number_of_shards&quot;: &quot;10&quot;,  //分10个片
      &quot;number_of_replicas&quot;: &quot;1&quot;  //1个备份
    }
  },
  &quot;mappings&quot;: {
    &quot;commercial_sku&quot;: { //这是其中一个mapping，你还可以创建其他mapping
      &quot;_timestamp&quot;: {  //这个配置可以删掉
        &quot;enabled&quot;: true
      },
        &quot;properties&quot;: {
          &quot;message&quot;: {
            &quot;type&quot;: &quot;string&quot;
          },
          &quot;price&quot;: {
            &quot;type&quot;: &quot;string&quot;
          },
          &quot;tid&quot;: {
            &quot;type&quot;: &quot;string&quot;
          },
          &quot;user&quot;: {
            &quot;type&quot;: &quot;string&quot;
          }
        }
    }
  }
}

已经创建了 index（库已经创建），新增一个 mapping
URL:http://127.0.0.1:9200/b2bware/_mapping/article PUT 方式
注意，这种创建方式 type[表名] 是在 URL 中指定的，BODY 部分只是指定了表结构：
{
    &quot;properties&quot;: {
      &quot;message&quot;: {
        &quot;type&quot;: &quot;string&quot;
      },
      &quot;price&quot;: {
        &quot;type&quot;: &quot;string&quot;
      },
      &quot;tid&quot;: {
        &quot;type&quot;: &quot;string&quot;
      },
      &quot;user&quot;: {
        &quot;type&quot;: &quot;string&quot;
      }
    }
}
</code></pre></div><p>mapping 的修改：
因为 mapping 只能进行追加修改，所以在建 type 的时候，最好清晰的知道表结构，否则数据变更起来比较麻烦，就像 MySQL 中已经有一个 age 存储的是字符串，突然有一天想改为 int，因为存在历史数据，要变更就不那么容易,所以ES的mapping调整只能追加字段。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>新增一个 visitCount 字段：
URL:http://127.0.0.1:9200/b2bware/article/_mapping PUT方式
<span class="token punctuation">{</span>
    <span class="token string">&quot;properties&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;visitCount&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;integer&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>3.mapping 中的可设置的属性：
mappings ： 在index（库）下创建时使用，下面可以有多个mapping 以下数据结构主要针对每个mapping进行说明：</p> <table><thead><tr><th>一级属性</th> <th>二级属性</th> <th>三级属性</th> <th>说明</th></tr></thead> <tbody><tr><td>dynamic</td> <td></td> <td></td> <td>新增字段自动模式；true:表示自动识别新字段并创建索引，false:不自动索引新字段，strict:遇到未知字段，抛异常，不能存入</td></tr> <tr><td>_timestamp</td> <td></td> <td></td> <td>是否使用时间戳，ES会自动加时间戳，使用的话请百度</td></tr> <tr><td>properties</td> <td></td> <td></td> <td>属性列表（类似数据库多个字段定义）</td></tr> <tr><td>{字段名}</td> <td></td> <td>某个字段的定义</td> <td></td></tr> <tr><td></td> <td>type</td> <td>数据类型，参见数据类型说明</td> <td></td></tr> <tr><td></td> <td>index</td> <td>映射选型，参见映射选型说明</td> <td></td></tr> <tr><td></td> <td>doc_values</td> <td>布尔值， 对not_analyzed字段，默认都是开启，分词字段不能使用，对排序和聚合能提升较大性能，节约内存</td> <td></td></tr> <tr><td></td> <td>format</td> <td>如果数据类型为日期格式，传入值得时候是字符串，ES需要一个格式进行识别，如：yyyy-MM-dd HH:mm: ss</td> <td></td></tr> <tr><td></td> <td>analyzer</td> <td>分词器，如ik,ansj(中文分词)</td> <td></td></tr> <tr><td></td> <td>boost</td> <td>浮点型，字段级别的分数加权（权重）</td> <td></td></tr> <tr><td></td> <td>ignore_above</td> <td>超过多少字符，就不处理，分词性能损耗较大，对字符串较长的可不分词</td> <td></td></tr> <tr><td></td> <td>null_value</td> <td>设置一些缺失字段的初始化值，只有string可以使用，分词字段的null值也会被分词</td> <td></td></tr> <tr><td></td> <td>store</td> <td>是否单独设置此字段的是否存储而从_source字段中分离，默认是false，只能搜索，不能获取值</td> <td></td></tr> <tr><td></td> <td>search_analyzer</td> <td>设置搜索时的分词器，默认跟ananlyzer是一致的，比如index时用standard+ngram，搜索时用standard用来完成自动提示功能</td> <td></td></tr> <tr><td></td> <td>其它</td> <td>similarity，term_vector，norms，include_in_all，index_options，fielddata，ignore_malformed，precision_step</td> <td></td></tr></tbody></table> <div class="language-shell extra-class"><pre class="language-shell"><code>一个典型的mapping对象的属性有：
<span class="token punctuation">{</span>
    <span class="token string">&quot;mappings&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;my_type&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        //true:表示自动识别新字段并创建索引，false:不自动索引新字段，strict:遇到未知字段，抛异常，不能存入
            <span class="token string">&quot;dynamic&quot;</span><span class="token builtin class-name">:</span>      <span class="token string">&quot;strict&quot;</span>, 
            
              //动态模板
             <span class="token string">&quot;dynamic_templates&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">{</span> <span class="token string">&quot;stash_template&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                      <span class="token string">&quot;path_match&quot;</span><span class="token builtin class-name">:</span>  <span class="token string">&quot;stash.*&quot;</span>,
                      <span class="token string">&quot;mapping&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                        <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span>           <span class="token string">&quot;string&quot;</span>,
                        <span class="token string">&quot;index&quot;</span><span class="token builtin class-name">:</span>       <span class="token string">&quot;not_analyzed&quot;</span>
                      <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">}</span>
                  <span class="token punctuation">]</span>,
            //属性列表
            <span class="token string">&quot;properties&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                //一个strign类型的字段
                <span class="token string">&quot;title&quot;</span><span class="token builtin class-name">:</span>  <span class="token punctuation">{</span> <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">}</span>,
                
                <span class="token string">&quot;stash&quot;</span><span class="token builtin class-name">:</span>  <span class="token punctuation">{</span>
                    <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span>     <span class="token string">&quot;object&quot;</span>,
                    <span class="token string">&quot;dynamic&quot;</span><span class="token builtin class-name">:</span>  <span class="token boolean">true</span> 
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>4.Elasticsearch 数据类型
Elasticsearch 自带的数据类型是 Lucene 索引的依据，也是我们做手动映射调整到依据。 映射中主要就是针对字段设置类型以及类型相关参数。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>JSON 基础类型如下：
字符串：string
数字：byte、short、integer、long、float、double、
时间：date
布尔值: true、false
数组: array
对象: object

Elasticsearch 独有的类型：
多重: multi
经纬度: geo_point
网络地址: <span class="token function">ip</span>
堆叠对象: nested object
二进制: binary
附件: attachment

复合类型:
数组类型：没有明显的字段类型设置，任何一个字段的值，都可以被添加0个到多个，要求，他们的类型必须一致： 对象类型：存储类似json具有层级的数据 嵌套类型：支持数组类型的对象Aarray<span class="token punctuation">[</span>Object<span class="token punctuation">]</span>，可层层嵌套

地理类型:
geo-point类型： 支持经纬度存储和距离范围检索
geo-shape类型：支持任意图形范围的检索，例如矩形和平面多边形

专用类型 ipv4类型：用来存储IP地址，es内部会转换成long存储
completion类型：使用fst有限状态机来提供suggest前缀查询功能
token_count类型：提供token级别的计数功能
mapper-murmur3类型：安装sudo bin/plugin <span class="token function">install</span> mapper-size插件，可支持_size统计_source数据的大小

</code></pre></div><p>5.注意点：</p> <p>Elasticsearch 映射虽然有 idnex 和 type 两层关系，但是实际索引时是以 index 为基础的。 如果同一个 index 下不同 type 的字段出现 mapping 不一致的情况 虽然数据依然可以成功写入并生成并生成各自的 mapping， 但实际上 fielddata 中的索引结果却依然是以 index 内第一个 mapping 类型来生成的。</p> <p>6.映射选型说明</p> <div class="language-shell extra-class"><pre class="language-shell"><code>某个属性（字段）的index可选值有：
analyzed:默认选项，以标准的全文索引方式，分析字符串，完成索引。
not_analyzed:精确索引，不对字符串做分析，直接索引字段数据的精确内容。
no：不索引该字段。

</code></pre></div><h3 id="_4-share"><a href="#_4-share" class="header-anchor">#</a> 4.Share:</h3> <p>https://sq.163yun.com/blog/article/184733100361850880
基于JavaScript的代码编辑器的比较和选型</p> <p>https://www.cnblogs.com/chen110xi/p/6210098.html
FastDFS文件系统(二) fastdfs和其他文件系统区别</p> <p>https://zhjwpku.com/2018/01/16/mysql-proxy-alternatives.htmls
mysql proxy 性能测试对比</p> <p>https://blog.csdn.net/sinat_35930259/article/details/80354732
elasticsearch篇之mapping</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.65b0f24a.js" defer></script><script src="/assets/js/2.d6ca9a42.js" defer></script><script src="/assets/js/72.83cb541b.js" defer></script>
  </body>
</html>
