<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ARTS-week-31 | Oceantime&#39;s blog</title>
    <meta name="generator" content="VuePress 1.5.3">
    <link rel="icon" href="/logo.jpg">
    <meta name="description" content="Oceantime 个人网站">
    <link rel="preload" href="/assets/css/0.styles.abfd12c2.css" as="style"><link rel="preload" href="/assets/js/app.65b0f24a.js" as="script"><link rel="preload" href="/assets/js/2.d6ca9a42.js" as="script"><link rel="preload" href="/assets/js/44.7231a1e4.js" as="script"><link rel="prefetch" href="/assets/js/10.ad6941e4.js"><link rel="prefetch" href="/assets/js/100.8ade9f63.js"><link rel="prefetch" href="/assets/js/101.a15dfa49.js"><link rel="prefetch" href="/assets/js/102.761bd3ff.js"><link rel="prefetch" href="/assets/js/103.4e1cd420.js"><link rel="prefetch" href="/assets/js/104.6cfd7216.js"><link rel="prefetch" href="/assets/js/105.e2d93a01.js"><link rel="prefetch" href="/assets/js/106.6151bc8f.js"><link rel="prefetch" href="/assets/js/107.ad872ea3.js"><link rel="prefetch" href="/assets/js/108.bc756e31.js"><link rel="prefetch" href="/assets/js/109.fe77c5ed.js"><link rel="prefetch" href="/assets/js/11.f05321e1.js"><link rel="prefetch" href="/assets/js/110.39bd8ea8.js"><link rel="prefetch" href="/assets/js/111.bd5d0a8b.js"><link rel="prefetch" href="/assets/js/112.66f93d20.js"><link rel="prefetch" href="/assets/js/113.e3f1b94f.js"><link rel="prefetch" href="/assets/js/114.6ca21a56.js"><link rel="prefetch" href="/assets/js/115.2369b994.js"><link rel="prefetch" href="/assets/js/116.ef676fd0.js"><link rel="prefetch" href="/assets/js/117.7762c22c.js"><link rel="prefetch" href="/assets/js/118.dc732d76.js"><link rel="prefetch" href="/assets/js/119.2b7f1a4d.js"><link rel="prefetch" href="/assets/js/12.b607cc9e.js"><link rel="prefetch" href="/assets/js/120.1b132ede.js"><link rel="prefetch" href="/assets/js/121.ff9a3172.js"><link rel="prefetch" href="/assets/js/122.2f47d49f.js"><link rel="prefetch" href="/assets/js/13.67af4ad6.js"><link rel="prefetch" href="/assets/js/14.c7827c0f.js"><link rel="prefetch" href="/assets/js/15.eedb1566.js"><link rel="prefetch" href="/assets/js/16.fe37cbf7.js"><link rel="prefetch" href="/assets/js/17.a38f0ae2.js"><link rel="prefetch" href="/assets/js/18.4990ee61.js"><link rel="prefetch" href="/assets/js/19.f4dbb6de.js"><link rel="prefetch" href="/assets/js/20.9ffd67c9.js"><link rel="prefetch" href="/assets/js/21.ac6e1d53.js"><link rel="prefetch" href="/assets/js/22.76b0e02e.js"><link rel="prefetch" href="/assets/js/23.ff3410dc.js"><link rel="prefetch" href="/assets/js/24.f76a6fea.js"><link rel="prefetch" href="/assets/js/25.0534f43c.js"><link rel="prefetch" href="/assets/js/26.c3725782.js"><link rel="prefetch" href="/assets/js/27.deb9c9f3.js"><link rel="prefetch" href="/assets/js/28.6f99ddc2.js"><link rel="prefetch" href="/assets/js/29.02cfc711.js"><link rel="prefetch" href="/assets/js/3.9f6270c9.js"><link rel="prefetch" href="/assets/js/30.ccabc2c3.js"><link rel="prefetch" href="/assets/js/31.b08f8990.js"><link rel="prefetch" href="/assets/js/32.ee62ba38.js"><link rel="prefetch" href="/assets/js/33.f7629f38.js"><link rel="prefetch" href="/assets/js/34.2853c933.js"><link rel="prefetch" href="/assets/js/35.97e611fd.js"><link rel="prefetch" href="/assets/js/36.fa3c8ed4.js"><link rel="prefetch" href="/assets/js/37.8ae8d904.js"><link rel="prefetch" href="/assets/js/38.05c35d7b.js"><link rel="prefetch" href="/assets/js/39.e5258c9e.js"><link rel="prefetch" href="/assets/js/4.ecc02e05.js"><link rel="prefetch" href="/assets/js/40.d668fe84.js"><link rel="prefetch" href="/assets/js/41.c09eb1d5.js"><link rel="prefetch" href="/assets/js/42.b940c3f3.js"><link rel="prefetch" href="/assets/js/43.5f4e8385.js"><link rel="prefetch" href="/assets/js/45.585825f0.js"><link rel="prefetch" href="/assets/js/46.14ddc0e4.js"><link rel="prefetch" href="/assets/js/47.52d53fb0.js"><link rel="prefetch" href="/assets/js/48.01214996.js"><link rel="prefetch" href="/assets/js/49.a8e7ddc6.js"><link rel="prefetch" href="/assets/js/5.755ee6e4.js"><link rel="prefetch" href="/assets/js/50.8ef31d09.js"><link rel="prefetch" href="/assets/js/51.86c845e5.js"><link rel="prefetch" href="/assets/js/52.0d1a6570.js"><link rel="prefetch" href="/assets/js/53.0b2ca6b6.js"><link rel="prefetch" href="/assets/js/54.daa0b522.js"><link rel="prefetch" href="/assets/js/55.b7e6d8cc.js"><link rel="prefetch" href="/assets/js/56.67e22da8.js"><link rel="prefetch" href="/assets/js/57.1b8d87fd.js"><link rel="prefetch" href="/assets/js/58.4ef89df1.js"><link rel="prefetch" href="/assets/js/59.abdf0f5c.js"><link rel="prefetch" href="/assets/js/6.3df7280b.js"><link rel="prefetch" href="/assets/js/60.35f8805b.js"><link rel="prefetch" href="/assets/js/61.68fa7ebd.js"><link rel="prefetch" href="/assets/js/62.fd6b0085.js"><link rel="prefetch" href="/assets/js/63.af0dbde2.js"><link rel="prefetch" href="/assets/js/64.16a1ffec.js"><link rel="prefetch" href="/assets/js/65.af1a9908.js"><link rel="prefetch" href="/assets/js/66.0ab56108.js"><link rel="prefetch" href="/assets/js/67.7b28f376.js"><link rel="prefetch" href="/assets/js/68.be9ab4b2.js"><link rel="prefetch" href="/assets/js/69.c030abbd.js"><link rel="prefetch" href="/assets/js/7.3549904d.js"><link rel="prefetch" href="/assets/js/70.1469061c.js"><link rel="prefetch" href="/assets/js/71.4802b635.js"><link rel="prefetch" href="/assets/js/72.83cb541b.js"><link rel="prefetch" href="/assets/js/73.3ad064c7.js"><link rel="prefetch" href="/assets/js/74.00cd90be.js"><link rel="prefetch" href="/assets/js/75.cbf47e0f.js"><link rel="prefetch" href="/assets/js/76.44ccee9d.js"><link rel="prefetch" href="/assets/js/77.e9c38d7e.js"><link rel="prefetch" href="/assets/js/78.9122406c.js"><link rel="prefetch" href="/assets/js/79.5478a7f9.js"><link rel="prefetch" href="/assets/js/8.183e1cde.js"><link rel="prefetch" href="/assets/js/80.81f8b615.js"><link rel="prefetch" href="/assets/js/81.ceada5ea.js"><link rel="prefetch" href="/assets/js/82.6106ff2d.js"><link rel="prefetch" href="/assets/js/83.59665864.js"><link rel="prefetch" href="/assets/js/84.14e761a8.js"><link rel="prefetch" href="/assets/js/85.dd1f6fdb.js"><link rel="prefetch" href="/assets/js/86.c780faa6.js"><link rel="prefetch" href="/assets/js/87.b6a78c96.js"><link rel="prefetch" href="/assets/js/88.e6f83878.js"><link rel="prefetch" href="/assets/js/89.3b38af38.js"><link rel="prefetch" href="/assets/js/9.d9ab8dd1.js"><link rel="prefetch" href="/assets/js/90.64e54699.js"><link rel="prefetch" href="/assets/js/91.b0c97860.js"><link rel="prefetch" href="/assets/js/92.a49f1aa9.js"><link rel="prefetch" href="/assets/js/93.30383993.js"><link rel="prefetch" href="/assets/js/94.e5ff08c3.js"><link rel="prefetch" href="/assets/js/95.6ee9cb6c.js"><link rel="prefetch" href="/assets/js/96.829351f9.js"><link rel="prefetch" href="/assets/js/97.dcf9c2e9.js"><link rel="prefetch" href="/assets/js/98.58af886e.js"><link rel="prefetch" href="/assets/js/99.d137b7f6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.abfd12c2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Oceantime's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/accumulate/" class="nav-link">
  前端基础
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法题库
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/accumulate/" class="nav-link">
  前端基础
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法题库
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>ARTS-week-31</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/2020/ARTS-week-31.html#arts-2019-左耳听风社群活动-每周完成一个-arts" class="sidebar-link">ARTS-2019 左耳听风社群活动--每周完成一个 ARTS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/2020/ARTS-week-31.html#_1-algorithm" class="sidebar-link">1.Algorithm:</a></li><li class="sidebar-sub-header"><a href="/2020/ARTS-week-31.html#_2-review" class="sidebar-link">2.Review:</a></li><li class="sidebar-sub-header"><a href="/2020/ARTS-week-31.html#_3-tip" class="sidebar-link">3.Tip:</a></li><li class="sidebar-sub-header"><a href="/2020/ARTS-week-31.html#_4-share" class="sidebar-link">4.Share:</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="arts-2019-左耳听风社群活动-每周完成一个-arts"><a href="#arts-2019-左耳听风社群活动-每周完成一个-arts" class="header-anchor">#</a> ARTS-2019 左耳听风社群活动--每周完成一个 ARTS</h2> <p>1.Algorithm： 每周至少做一个 leetcode 的算法题
2.Review: 阅读并点评至少一篇英文技术文章
3.Tip: 学习至少一个技术技巧
4.Share: 分享一篇有观点和思考的技术文章</p> <h3 id="_1-algorithm"><a href="#_1-algorithm" class="header-anchor">#</a> 1.Algorithm:</h3> <p>Find Minimum in Rotated Sorted Array https://leetcode.com/submissions/detail/323554474/</p> <h3 id="_2-review"><a href="#_2-review" class="header-anchor">#</a> 2.Review:</h3> <p>https://medium.com/@gvanrossum_83706/generating-a-peg-parser-520057d642a9</p> <h4 id="点评："><a href="#点评：" class="header-anchor">#</a> 点评：</h4> <p>Guido van Rossum 在本文中，制作了一个原始的元编译器并通过 @memoize 装饰器演示 packrat parsing 原理。</p> <p>1.上周中的例子：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>statement: assignment <span class="token operator">|</span> <span class="token function">expr</span> <span class="token operator">|</span> if_statement
expr: <span class="token function">expr</span> <span class="token string">'+'</span> term <span class="token operator">|</span> <span class="token function">expr</span> <span class="token string">'-'</span> term <span class="token operator">|</span> term
term: term <span class="token string">'*'</span> atom <span class="token operator">|</span> term <span class="token string">'/'</span> atom <span class="token operator">|</span> atom
atom: NAME <span class="token operator">|</span> NUMBER <span class="token operator">|</span> <span class="token string">'('</span> <span class="token function">expr</span> <span class="token string">')'</span>
assignment: target <span class="token string">'='</span> <span class="token function">expr</span>
target: NAME
if_statement: <span class="token string">'if'</span> <span class="token function">expr</span> <span class="token string">':'</span> statement
</code></pre></div><p>2.元语法,元编译器是一种编译器，其输入是一套语法，而输出是一个解析器:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>grammar: rule+ ENDMARKER
rule: NAME <span class="token string">':'</span> alternative <span class="token punctuation">(</span><span class="token string">'|'</span> alternative<span class="token punctuation">)</span>* NEWLINE
alternative: item+
item: NAME <span class="token operator">|</span> STRING
</code></pre></div><p>3.有个简单地表示元语法的方法，主要是使用内置的数据类型：一条规则的右侧只是由一系列的条目组成的列表，且这些条目只能是字符串。（Hack：通过检查第一个字符是否为引号，我们可以区分出NAME和STRING）至于规则，我用了一个简单的 Rule 类，所以整个语法就是一些 Rule 对象。：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Rule</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> alts<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>alts <span class="token operator">=</span> alts
</code></pre></div><p>调用它的是这个GrammarParser类（关于基类Parser ，请参阅我之前的帖子）：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">GrammarParser</span><span class="token punctuation">(</span>Parser<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">grammar</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        pos <span class="token operator">=</span> self<span class="token punctuation">.</span>mark<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> rule <span class="token punctuation">:</span><span class="token operator">=</span> self<span class="token punctuation">.</span>rule<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            rules <span class="token operator">=</span> <span class="token punctuation">[</span>rule<span class="token punctuation">]</span>
            <span class="token keyword">while</span> rule <span class="token punctuation">:</span><span class="token operator">=</span> self<span class="token punctuation">.</span>rule<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                rules<span class="token punctuation">.</span>append<span class="token punctuation">(</span>rule<span class="token punctuation">)</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>expect<span class="token punctuation">(</span>ENDMARKER<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> rules    <span class="token comment"># &lt;------------- final result</span>
        self<span class="token punctuation">.</span>reset<span class="token punctuation">(</span>pos<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">None</span>
    <span class="token keyword">def</span> <span class="token function">rule</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        pos <span class="token operator">=</span> self<span class="token punctuation">.</span>mark<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> name <span class="token punctuation">:</span><span class="token operator">=</span> self<span class="token punctuation">.</span>expect<span class="token punctuation">(</span>NAME<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>expect<span class="token punctuation">(</span><span class="token string">&quot;:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> alt <span class="token punctuation">:</span><span class="token operator">=</span> self<span class="token punctuation">.</span>alternative<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    alts <span class="token operator">=</span> <span class="token punctuation">[</span>alt<span class="token punctuation">]</span>
                    apos <span class="token operator">=</span> self<span class="token punctuation">.</span>mark<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token keyword">while</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>expect<span class="token punctuation">(</span><span class="token string">&quot;|&quot;</span><span class="token punctuation">)</span>
                           <span class="token keyword">and</span> <span class="token punctuation">(</span>alt <span class="token punctuation">:</span><span class="token operator">=</span> self<span class="token punctuation">.</span>alternative<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        alts<span class="token punctuation">.</span>append<span class="token punctuation">(</span>alt<span class="token punctuation">)</span>
                        apos <span class="token operator">=</span> self<span class="token punctuation">.</span>mark<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>reset<span class="token punctuation">(</span>apos<span class="token punctuation">)</span>
                    <span class="token keyword">if</span> self<span class="token punctuation">.</span>expect<span class="token punctuation">(</span>NEWLINE<span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">return</span> Rule<span class="token punctuation">(</span>name<span class="token punctuation">.</span>string<span class="token punctuation">,</span> alts<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>reset<span class="token punctuation">(</span>pos<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">None</span>
    <span class="token keyword">def</span> <span class="token function">alternative</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">while</span> item <span class="token punctuation">:</span><span class="token operator">=</span> self<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            items<span class="token punctuation">.</span>append<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
        <span class="token keyword">return</span> items
    <span class="token keyword">def</span> <span class="token function">item</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> name <span class="token punctuation">:</span><span class="token operator">=</span> self<span class="token punctuation">.</span>expect<span class="token punctuation">(</span>NAME<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> name<span class="token punctuation">.</span>string
        <span class="token keyword">if</span> string <span class="token punctuation">:</span><span class="token operator">=</span> self<span class="token punctuation">.</span>expect<span class="token punctuation">(</span>STRING<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> string<span class="token punctuation">.</span>string
        <span class="token keyword">return</span> <span class="token boolean">None</span>
</code></pre></div><p>4.用以上代码解析上周的语法的文件上，则 grammar() 方法会返回以下的由 Rule 对象组成的列表：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token punctuation">[</span>
  Rule<span class="token punctuation">(</span><span class="token string">'statement'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'assignment'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'expr'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'if_statement'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  Rule<span class="token punctuation">(</span><span class="token string">'expr'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'term'</span><span class="token punctuation">,</span> <span class="token string">&quot;'+'&quot;</span><span class="token punctuation">,</span> <span class="token string">'expr'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token string">'term'</span><span class="token punctuation">,</span> <span class="token string">&quot;'-'&quot;</span><span class="token punctuation">,</span> <span class="token string">'term'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token string">'term'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  Rule<span class="token punctuation">(</span><span class="token string">'term'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'atom'</span><span class="token punctuation">,</span> <span class="token string">&quot;'*'&quot;</span><span class="token punctuation">,</span> <span class="token string">'term'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token string">'atom'</span><span class="token punctuation">,</span> <span class="token string">&quot;'/'&quot;</span><span class="token punctuation">,</span> <span class="token string">'atom'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token string">'atom'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  Rule<span class="token punctuation">(</span><span class="token string">'atom'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'NAME'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'NUMBER'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;'('&quot;</span><span class="token punctuation">,</span> <span class="token string">'expr'</span><span class="token punctuation">,</span> <span class="token string">&quot;')'&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  Rule<span class="token punctuation">(</span><span class="token string">'assignment'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">,</span> <span class="token string">&quot;'='&quot;</span><span class="token punctuation">,</span> <span class="token string">'expr'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  Rule<span class="token punctuation">(</span><span class="token string">'target'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'NAME'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  Rule<span class="token punctuation">(</span><span class="token string">'if_statement'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;'if'&quot;</span><span class="token punctuation">,</span> <span class="token string">'expr'</span><span class="token punctuation">,</span> <span class="token string">&quot;':'&quot;</span><span class="token punctuation">,</span> <span class="token string">'statement'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><p>5.把以上聚合起来，就形成一个基本的元编译器：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">generate_parser_class</span><span class="token punctuation">(</span>rules<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;class ToyParser(Parser):&quot;</span></span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> rule <span class="token keyword">in</span> rules<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;    @memoize&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;    def </span><span class="token interpolation"><span class="token punctuation">{</span>rule<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">(self):&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;        pos = self.mark()&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> alt <span class="token keyword">in</span> rule<span class="token punctuation">.</span>alts<span class="token punctuation">:</span>
            items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;        if (True&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> item <span class="token keyword">in</span> alt<span class="token punctuation">:</span>
                <span class="token keyword">if</span> item<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">'&quot;'</span><span class="token punctuation">,</span> <span class="token string">&quot;'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;            and self.expect(</span><span class="token interpolation"><span class="token punctuation">{</span>item<span class="token punctuation">}</span></span><span class="token string">)&quot;</span></span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    var <span class="token operator">=</span> item<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span> var <span class="token keyword">in</span> items<span class="token punctuation">:</span>
                        var <span class="token operator">+=</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    items<span class="token punctuation">.</span>append<span class="token punctuation">(</span>var<span class="token punctuation">)</span>
                    <span class="token keyword">if</span> item<span class="token punctuation">.</span>isupper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;            &quot;</span> <span class="token operator">+</span>
                              <span class="token string-interpolation"><span class="token string">f&quot;and (</span><span class="token interpolation"><span class="token punctuation">{</span>var<span class="token punctuation">}</span></span><span class="token string"> := self.expect(</span><span class="token interpolation"><span class="token punctuation">{</span>item<span class="token punctuation">}</span></span><span class="token string">))&quot;</span></span><span class="token punctuation">)</span>
                    <span class="token keyword">else</span><span class="token punctuation">:</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;            &quot;</span></span> <span class="token operator">+</span>
                              <span class="token string-interpolation"><span class="token string">f&quot;and (</span><span class="token interpolation"><span class="token punctuation">{</span>var<span class="token punctuation">}</span></span><span class="token string"> := self.</span><span class="token interpolation"><span class="token punctuation">{</span>item<span class="token punctuation">}</span></span><span class="token string">())&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;        ):&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;            &quot;</span></span> <span class="token operator">+</span>
              <span class="token string-interpolation"><span class="token string">f&quot;return Node(</span><span class="token interpolation"><span class="token punctuation">{</span>rule<span class="token punctuation">.</span>name<span class="token conversion-option punctuation">!r</span><span class="token punctuation">}</span></span><span class="token string">, [</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">', '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">])&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;        self.reset(pos)&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;        return None&quot;</span></span><span class="token punctuation">)</span>
</code></pre></div><p>6.注意@memoize 装饰器：我“偷运”（smuggle）它进来，以便转向另一个主题：使用记忆法（memoization）来加速生成的解析器。包装器会缓存每次调用解析方法后的结果——这就是为什么它会被称为“口袋老鼠解析”（packrat parsing）！这是实现该装饰器的 memoize() 函数：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">memoize</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">memoize_wrapper</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>
        pos <span class="token operator">=</span> self<span class="token punctuation">.</span>mark<span class="token punctuation">(</span><span class="token punctuation">)</span>
        memo <span class="token operator">=</span> self<span class="token punctuation">.</span>memos<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pos<span class="token punctuation">)</span>
        <span class="token keyword">if</span> memo <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            memo <span class="token operator">=</span> self<span class="token punctuation">.</span>memos<span class="token punctuation">[</span>pos<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        key <span class="token operator">=</span> <span class="token punctuation">(</span>func<span class="token punctuation">,</span> args<span class="token punctuation">)</span>
        <span class="token keyword">if</span> key <span class="token keyword">in</span> memo<span class="token punctuation">:</span>
            res<span class="token punctuation">,</span> endpos <span class="token operator">=</span> memo<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
            self<span class="token punctuation">.</span>reset<span class="token punctuation">(</span>endpos<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            res <span class="token operator">=</span> func<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">)</span>
            endpos <span class="token operator">=</span> self<span class="token punctuation">.</span>mark<span class="token punctuation">(</span><span class="token punctuation">)</span>
            memo<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> res<span class="token punctuation">,</span> endpos
        <span class="token keyword">return</span> res
<span class="token keyword">return</span> memoize_wrapper
</code></pre></div><p>总结：
1.以上缓存是一个字典，元素是存储在 Parser 实例上的那些字典。外部字典的 key 是输入的位置；我将 self.memos = {} 添加到 Parser.<strong>init</strong>() ，以初始化它。内部字典按需添加，它们的 key 由方法及其参数组成。（在当前的设计中没有参数，但我们应该记得 expect()，它恰好有一个参数，而且给它新增通用性，几乎不需要成本。）
2.一个解析方法的结果被表示成一个元组，因为它正好有两个结果：一个显式的返回值（对于我们生成的解析器，它是一个 Node，表示所匹配的规则），以及我们从 self.mark() 中获得的一个新的输入位置。
3.在调用解析方法后，我们会在内部的记忆字典中同时存储它的返回值（res）以及新的输入位置（endpos）。
4.再次调用相同的解析方法时（在相同的位置，使用相同的参数），我们会从缓存中取出那两个结果，并用 self.reset() 来向前移动输入位置，最后返回那缓存中的返回值。
5.缓存负数的结果也很重要——实际上大多数对解析方法的调用都是负数的结果。在此情况下，返回值为 None，而输入位置不会变。你可以加一个assert 断言来检查它。</p> <h3 id="_3-tip"><a href="#_3-tip" class="header-anchor">#</a> 3.Tip:</h3> <p>query-string 解析 URL</p> <ol><li>querystring.parse(str[, sep[, eq[, options]]]):
str <string> 要解析的 URL 查询字符串。
sep <string> 用于在查询字符串中分隔键值对的子字符串。默认值: '&amp;'。
eq <string> 用于在查询字符串中分隔键和值的子字符串。默认值: '='。
options: <Object>
decodeURIComponent <Function> 当解码查询字符串中的百分比编码字符时使用的函数。默认值: querystring.unescape()。
maxKeys <number> 指定要解析的键的最大数量。指定 0 可移除键的计数限制。默认值: 1000。
querystring.parse() 方法将 URL 查询字符串 str 解析为键值对的集合。</number></Function></Object></string></string></string></li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> qs <span class="token keyword">from</span> <span class="token string">'query-string'</span><span class="token punctuation">;</span>
 
location<span class="token punctuation">.</span>search  <span class="token comment">// ?name=jim</span>
location<span class="token punctuation">.</span>hash  <span class="token comment">// #token=123</span>
qs<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'?name=jim'</span><span class="token punctuation">)</span>  <span class="token comment">// {name: 'jim'}</span>
qs<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'#token=123'</span><span class="token punctuation">)</span>  <span class="token comment">// {token: '123'}</span>

<span class="token comment">//默认情况下，字符将会被解码为 UTF-8。 如果需要其他的编码，则需要指定其他的 encodeURIComponent 选项：</span>
qs<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'name=jim&amp;name=lily&amp;age=22'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> decodeURIComponent<span class="token operator">:</span> gbkDecodeURIComponent <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// {name: ['jim', 'lily'], age: 22}</span>
</code></pre></div><ol start="2"><li>qs.stringify(object, [options])
obj <Object> 要序列化为 URL 查询字符串的对象。
sep <string> 用于在查询字符串中分隔键值对的子字符串。默认值: '&amp;'。
eq <string> 用于在查询字符串中分隔键和值的子字符串。默认值: '='。
options:
encodeURIComponent <Function> 当将查询字符串中不安全的 URL 字符转换为百分比编码时使用的函数。默认值: querystring.escape()。
querystring.stringify() 方法通过遍历对象的自身属性从给定的 obj 生成 URL 查询字符串。
它会序列化传入的 obj 中以下类型的值：<string> | <number> | <boolean> | &lt;string[]&gt; | &lt;number[]&gt; | &lt;boolean[]&gt;。 任何其他的输入值都将会被强制转换为空字符串。</boolean></number></string></Function></string></string></Object></li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> qs <span class="token keyword">from</span> <span class="token string">'query-string'</span><span class="token punctuation">;</span>
 
qs<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'jim'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 'age=22&amp;name=jim'</span>
qs<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'jim'</span><span class="token punctuation">,</span> <span class="token string">'lily'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 'age=22&amp;name=jim&amp;name=lily'</span>

<span class="token comment">//默认情况下，字符将会被编码为 UTF-8。 如果需要其他的编码，则需要指定其他的 encodeURIComponent 选项：</span>
querystring<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> w<span class="token operator">:</span> <span class="token string">'中文'</span><span class="token punctuation">,</span> foo<span class="token operator">:</span> <span class="token string">'bar'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
                      <span class="token punctuation">{</span> encodeURIComponent<span class="token operator">:</span> gbkEncodeURIComponent <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>qs.parseUrl(string, [options])</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>qs<span class="token punctuation">.</span><span class="token function">parseUrl</span><span class="token punctuation">(</span><span class="token string">'http://www.baidu.com?name=jim'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// {url: 'http://www.baidu.com', query: {name: 'jim'}}</span>
</code></pre></div><p>用 a 标签解析 url</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">parseUrl</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    a<span class="token punctuation">.</span>href <span class="token operator">=</span> url<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        host<span class="token operator">:</span> a<span class="token punctuation">.</span>hostname<span class="token punctuation">,</span>
        port<span class="token operator">:</span> a<span class="token punctuation">.</span>port<span class="token punctuation">,</span>
        query<span class="token operator">:</span> a<span class="token punctuation">.</span>search<span class="token punctuation">,</span>
        hash<span class="token operator">:</span> a<span class="token punctuation">.</span>hash<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'#'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        params<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> searchArr <span class="token operator">=</span> a<span class="token punctuation">.</span>search<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/^\?/</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'&amp;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            searchArr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span> <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                params<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> params<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-share"><a href="#_4-share" class="header-anchor">#</a> 4.Share:</h3> <p>一致性Hash算法
https://www.xuxueli.com/blog/?blog=./notebook/6-%E7%AE%97%E6%B3%95/%E4%B8%80%E8%87%B4%E6%80%A7Hash%E7%AE%97%E6%B3%95.md</p> <p>前端打包构建工具Gulp、Rollup、Webpack、Webpack-stream
https://my.oschina.net/tongjh/blog/837663</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.65b0f24a.js" defer></script><script src="/assets/js/2.d6ca9a42.js" defer></script><script src="/assets/js/44.7231a1e4.js" defer></script>
  </body>
</html>
