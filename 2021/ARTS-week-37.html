<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ARTS-week-37 | Oceantime&#39;s blog</title>
    <meta name="generator" content="VuePress 1.5.3">
    <link rel="icon" href="/logo.jpg">
    <meta name="description" content="Oceantime 个人网站">
    <link rel="preload" href="/assets/css/0.styles.abfd12c2.css" as="style"><link rel="preload" href="/assets/js/app.65b0f24a.js" as="script"><link rel="preload" href="/assets/js/2.d6ca9a42.js" as="script"><link rel="preload" href="/assets/js/115.2369b994.js" as="script"><link rel="prefetch" href="/assets/js/10.ad6941e4.js"><link rel="prefetch" href="/assets/js/100.8ade9f63.js"><link rel="prefetch" href="/assets/js/101.a15dfa49.js"><link rel="prefetch" href="/assets/js/102.761bd3ff.js"><link rel="prefetch" href="/assets/js/103.4e1cd420.js"><link rel="prefetch" href="/assets/js/104.6cfd7216.js"><link rel="prefetch" href="/assets/js/105.e2d93a01.js"><link rel="prefetch" href="/assets/js/106.6151bc8f.js"><link rel="prefetch" href="/assets/js/107.ad872ea3.js"><link rel="prefetch" href="/assets/js/108.bc756e31.js"><link rel="prefetch" href="/assets/js/109.fe77c5ed.js"><link rel="prefetch" href="/assets/js/11.f05321e1.js"><link rel="prefetch" href="/assets/js/110.39bd8ea8.js"><link rel="prefetch" href="/assets/js/111.bd5d0a8b.js"><link rel="prefetch" href="/assets/js/112.66f93d20.js"><link rel="prefetch" href="/assets/js/113.e3f1b94f.js"><link rel="prefetch" href="/assets/js/114.6ca21a56.js"><link rel="prefetch" href="/assets/js/116.ef676fd0.js"><link rel="prefetch" href="/assets/js/117.7762c22c.js"><link rel="prefetch" href="/assets/js/118.dc732d76.js"><link rel="prefetch" href="/assets/js/119.2b7f1a4d.js"><link rel="prefetch" href="/assets/js/12.b607cc9e.js"><link rel="prefetch" href="/assets/js/120.1b132ede.js"><link rel="prefetch" href="/assets/js/121.ff9a3172.js"><link rel="prefetch" href="/assets/js/122.2f47d49f.js"><link rel="prefetch" href="/assets/js/13.67af4ad6.js"><link rel="prefetch" href="/assets/js/14.c7827c0f.js"><link rel="prefetch" href="/assets/js/15.eedb1566.js"><link rel="prefetch" href="/assets/js/16.fe37cbf7.js"><link rel="prefetch" href="/assets/js/17.a38f0ae2.js"><link rel="prefetch" href="/assets/js/18.4990ee61.js"><link rel="prefetch" href="/assets/js/19.f4dbb6de.js"><link rel="prefetch" href="/assets/js/20.9ffd67c9.js"><link rel="prefetch" href="/assets/js/21.ac6e1d53.js"><link rel="prefetch" href="/assets/js/22.76b0e02e.js"><link rel="prefetch" href="/assets/js/23.ff3410dc.js"><link rel="prefetch" href="/assets/js/24.f76a6fea.js"><link rel="prefetch" href="/assets/js/25.0534f43c.js"><link rel="prefetch" href="/assets/js/26.c3725782.js"><link rel="prefetch" href="/assets/js/27.deb9c9f3.js"><link rel="prefetch" href="/assets/js/28.6f99ddc2.js"><link rel="prefetch" href="/assets/js/29.02cfc711.js"><link rel="prefetch" href="/assets/js/3.9f6270c9.js"><link rel="prefetch" href="/assets/js/30.ccabc2c3.js"><link rel="prefetch" href="/assets/js/31.b08f8990.js"><link rel="prefetch" href="/assets/js/32.ee62ba38.js"><link rel="prefetch" href="/assets/js/33.f7629f38.js"><link rel="prefetch" href="/assets/js/34.2853c933.js"><link rel="prefetch" href="/assets/js/35.97e611fd.js"><link rel="prefetch" href="/assets/js/36.fa3c8ed4.js"><link rel="prefetch" href="/assets/js/37.8ae8d904.js"><link rel="prefetch" href="/assets/js/38.05c35d7b.js"><link rel="prefetch" href="/assets/js/39.e5258c9e.js"><link rel="prefetch" href="/assets/js/4.ecc02e05.js"><link rel="prefetch" href="/assets/js/40.d668fe84.js"><link rel="prefetch" href="/assets/js/41.c09eb1d5.js"><link rel="prefetch" href="/assets/js/42.b940c3f3.js"><link rel="prefetch" href="/assets/js/43.5f4e8385.js"><link rel="prefetch" href="/assets/js/44.7231a1e4.js"><link rel="prefetch" href="/assets/js/45.585825f0.js"><link rel="prefetch" href="/assets/js/46.14ddc0e4.js"><link rel="prefetch" href="/assets/js/47.52d53fb0.js"><link rel="prefetch" href="/assets/js/48.01214996.js"><link rel="prefetch" href="/assets/js/49.a8e7ddc6.js"><link rel="prefetch" href="/assets/js/5.755ee6e4.js"><link rel="prefetch" href="/assets/js/50.8ef31d09.js"><link rel="prefetch" href="/assets/js/51.86c845e5.js"><link rel="prefetch" href="/assets/js/52.0d1a6570.js"><link rel="prefetch" href="/assets/js/53.0b2ca6b6.js"><link rel="prefetch" href="/assets/js/54.daa0b522.js"><link rel="prefetch" href="/assets/js/55.b7e6d8cc.js"><link rel="prefetch" href="/assets/js/56.67e22da8.js"><link rel="prefetch" href="/assets/js/57.1b8d87fd.js"><link rel="prefetch" href="/assets/js/58.4ef89df1.js"><link rel="prefetch" href="/assets/js/59.abdf0f5c.js"><link rel="prefetch" href="/assets/js/6.3df7280b.js"><link rel="prefetch" href="/assets/js/60.35f8805b.js"><link rel="prefetch" href="/assets/js/61.68fa7ebd.js"><link rel="prefetch" href="/assets/js/62.fd6b0085.js"><link rel="prefetch" href="/assets/js/63.af0dbde2.js"><link rel="prefetch" href="/assets/js/64.16a1ffec.js"><link rel="prefetch" href="/assets/js/65.af1a9908.js"><link rel="prefetch" href="/assets/js/66.0ab56108.js"><link rel="prefetch" href="/assets/js/67.7b28f376.js"><link rel="prefetch" href="/assets/js/68.be9ab4b2.js"><link rel="prefetch" href="/assets/js/69.c030abbd.js"><link rel="prefetch" href="/assets/js/7.3549904d.js"><link rel="prefetch" href="/assets/js/70.1469061c.js"><link rel="prefetch" href="/assets/js/71.4802b635.js"><link rel="prefetch" href="/assets/js/72.83cb541b.js"><link rel="prefetch" href="/assets/js/73.3ad064c7.js"><link rel="prefetch" href="/assets/js/74.00cd90be.js"><link rel="prefetch" href="/assets/js/75.cbf47e0f.js"><link rel="prefetch" href="/assets/js/76.44ccee9d.js"><link rel="prefetch" href="/assets/js/77.e9c38d7e.js"><link rel="prefetch" href="/assets/js/78.9122406c.js"><link rel="prefetch" href="/assets/js/79.5478a7f9.js"><link rel="prefetch" href="/assets/js/8.183e1cde.js"><link rel="prefetch" href="/assets/js/80.81f8b615.js"><link rel="prefetch" href="/assets/js/81.ceada5ea.js"><link rel="prefetch" href="/assets/js/82.6106ff2d.js"><link rel="prefetch" href="/assets/js/83.59665864.js"><link rel="prefetch" href="/assets/js/84.14e761a8.js"><link rel="prefetch" href="/assets/js/85.dd1f6fdb.js"><link rel="prefetch" href="/assets/js/86.c780faa6.js"><link rel="prefetch" href="/assets/js/87.b6a78c96.js"><link rel="prefetch" href="/assets/js/88.e6f83878.js"><link rel="prefetch" href="/assets/js/89.3b38af38.js"><link rel="prefetch" href="/assets/js/9.d9ab8dd1.js"><link rel="prefetch" href="/assets/js/90.64e54699.js"><link rel="prefetch" href="/assets/js/91.b0c97860.js"><link rel="prefetch" href="/assets/js/92.a49f1aa9.js"><link rel="prefetch" href="/assets/js/93.30383993.js"><link rel="prefetch" href="/assets/js/94.e5ff08c3.js"><link rel="prefetch" href="/assets/js/95.6ee9cb6c.js"><link rel="prefetch" href="/assets/js/96.829351f9.js"><link rel="prefetch" href="/assets/js/97.dcf9c2e9.js"><link rel="prefetch" href="/assets/js/98.58af886e.js"><link rel="prefetch" href="/assets/js/99.d137b7f6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.abfd12c2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Oceantime's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/accumulate/" class="nav-link">
  前端基础
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法题库
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/accumulate/" class="nav-link">
  前端基础
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法题库
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>ARTS-week-37</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/2021/ARTS-week-37.html#arts-2019-左耳听风社群活动-每周完成一个-arts" class="sidebar-link">ARTS-2019 左耳听风社群活动--每周完成一个 ARTS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/2021/ARTS-week-37.html#_1-algorithm" class="sidebar-link">1.Algorithm:</a></li><li class="sidebar-sub-header"><a href="/2021/ARTS-week-37.html#_2-review" class="sidebar-link">2.Review:</a></li><li class="sidebar-sub-header"><a href="/2021/ARTS-week-37.html#_3-tip" class="sidebar-link">3.Tip:</a></li><li class="sidebar-sub-header"><a href="/2021/ARTS-week-37.html#_4-share" class="sidebar-link">4.Share:</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="arts-2019-左耳听风社群活动-每周完成一个-arts"><a href="#arts-2019-左耳听风社群活动-每周完成一个-arts" class="header-anchor">#</a> ARTS-2019 左耳听风社群活动--每周完成一个 ARTS</h2> <p>1.Algorithm： 每周至少做一个 leetcode 的算法题
2.Review: 阅读并点评至少一篇英文技术文章
3.Tip: 学习至少一个技术技巧
4.Share: 分享一篇有观点和思考的技术文章</p> <h3 id="_1-algorithm"><a href="#_1-algorithm" class="header-anchor">#</a> 1.Algorithm:</h3> <ol start="48"><li><p>旋转图像：https://leetcode-cn.com/submissions/detail/216532615/</p></li> <li><p>删除有序数组中的重复项：https://leetcode-cn.com/submissions/detail/216532672/</p></li> <li><p>三数之和：https://leetcode-cn.com/submissions/detail/216532878/</p></li></ol> <h3 id="_2-review"><a href="#_2-review" class="header-anchor">#</a> 2.Review:</h3> <p>https://medium.com/change-your-mind/life-lessons-learned-in-my-40s-that-i-wish-i-could-tell-my-20-year-old-self-4ead0fcc721f
四十岁的我想告诉二十岁的自己哪些人生经验？</p> <h4 id="点评："><a href="#点评：" class="header-anchor">#</a> 点评：</h4> <p>你有没有说过这样的话：如果当时我知道现在的情况就好了？你不是第一个有这种想法的人，当然也不会是最后一个。我们很多人都坚信，如果我们能回到过去，和20岁的自己聊一聊，那么我们绝对可以在成年后甚至更久的时间里杀出重围。很多成长都是在我们20岁的时候发生的。然而，在20岁的时候，我们说服自己，我们知道一切我们需要知道的东西，我们已经准备好坚守它。不过，这确实引出了一个问题，如果你有机会和过去的你说话，你会告诉20岁的自己什么呢？</p> <p>负债是不正常的</p> <ul><li>如果我能给我20岁的自己一个建议，我会告诉他，认真学习关于债务、财务和理财的知识。</li></ul> <p>友谊 &gt; 亲密关系</p> <ul><li>现实情况是，你的伴侣应该希望你花时间和朋友在一起，因为他们也应该花时间和朋友在一起。如果你们两个人都没有这样做，那么有一个更大的潜在问题。</li></ul> <p>知道自己想要什么</p> <ul><li>你在别人身上寻找什么特征？一个值得信赖，健康，积极，并与你的核心价值观相同的人？更重要的是你要知道知道你想要什么，而不是一味的索取。</li></ul> <p>友谊</p> <ul><li>随着年龄的增长，人们搬走了，他们结婚了，他们有了孩子，他们沉浸在自己的生活中。虽然你的内心圈子可能会缩小，但其他人并没有就这么走了。你只要一见面就能从头再来。</li></ul> <p>超支的大型婚礼</p> <ul><li>我会告诉20岁的自己，把宾客名单规划好，专注于一场有意义的婚礼和一次美好的蜜月。</li></ul> <p>断舍离</p> <ul><li>东西越少越好。生活远比你拥有的东西更有意义。</li></ul> <p>管理健康</p> <ul><li>你的身体是唯一的。当你一开始就身材不错的时候，保持身材很容易。当你放任自流的时候，要想保持身材就难多了。</li> <li>如果可以，我会告诉20岁的自己，要更加小心翼翼地进行负重训练、跆拳道、踢足球和足球。这些年来，我的身体受到了很多打击，正因为如此，我对自己多长了几斤脂肪而无法转移感到愧疚。</li> <li>这并不意味着我急切地想要练就一身像岩石一样的肌肉。我只是想从沙发上站起来，而不是身体的每一个关节都在嘎吱嘎吱地响。如果我早点照顾好自己就好了。</li></ul> <p>事业上的耐心</p> <ul><li>我会告诉20岁的自己，在事业发展方面要有耐心。当然，我也可能会建议在大学里学习一些更合适的东西，因为尽管我有学位，但我还是追求了我想做的事情。</li></ul> <p>世上没有完美的事</p> <ul><li>人们夸耀自己是完美主义者，包括我自己。但是，如果我能回到过去，并建议我20岁的自己，我会告诉他敲掉它，因为没有完美的东西。它创造了一个不可能实现的目标。一个你永远不会实现的目标，因为你永远不会达到完美。追求完美只会让你走向一个结局，那就是倦怠。它也可能阻止你去冒险，也是因为对失败的恐惧太大。</li></ul> <p>人生信条：</p> <ul><li>真诚可能会带来伤痛，但你仍应该这样去做。</li> <li>并不是每个人都会像你一样恭敬可敬的。</li> <li>不要再用发胶了!</li> <li>告诉你的父母你爱他们，因为总有一天他们会离开你。</li> <li>你会越来越好！</li> <li>多喝水</li> <li>每次出门别忘了涂抹防晒霜。</li> <li>把自己放在第一位，对那些耗费你精力的事情（或人）说 &quot;不 &quot;也是可以的。（懂得拒绝）</li> <li>开诚布公地说出自己想要的东西，因为没有人会读懂你的心思。</li> <li>学会聆听</li> <li>你应该达到某个程度并且是真诚的</li> <li>你无法收回你花在担心上的时间。</li> <li>做适合自己的事，而不是纸上谈兵。</li> <li>有些人会喜欢你，有些人不会喜欢你。这很好，你不适合每个人，你也不一定要成为这样的人。</li> <li>旅行。</li> <li>让自己犯错，会好起来的。</li> <li>坚强点。</li> <li>不要把时间浪费在有毒的人身上。</li> <li>重要的不是事情，而是人。</li> <li>善待自己</li></ul> <p>&quot;你的时间是有限的，所以不要把时间浪费在别人的生活上。不要被教条所困--那是活在别人的思维结果中。不要让别人的意见噪音淹没了自己内心的声音。最重要的是，要有勇气跟随自己的内心和直觉。它们某种程度上已经知道你真正想成为什么。其他的一切都是次要的。&quot; 史蒂夫-乔布斯</p> <h3 id="_3-tip"><a href="#_3-tip" class="header-anchor">#</a> 3.Tip:</h3> <h4 id="elasticsearch-api"><a href="#elasticsearch-api" class="header-anchor">#</a> [ElasticSearch] API</h4> <p>query dsl:dsl 全称 domain specified language
不论是query string search 还是query specified language它们本质上都是在发送Resutful类型的网络请求。相对于 query string search 的将所有的请求参数都写在URI中，query dsl 一般长下面这样：</p> <div class="language- extra-class"><pre class="language-text"><code>GET /yourIndex/yourType/_search
{
  // 很多请求参数
}
</code></pre></div><p>query string search 更像是http中的GET请求，因为它没有请求体。而query dsl 更像是http 中的POST请求。</p> <p>32个查询案例:
1、查询指定index下的全部doc</p> <div class="language-json extra-class"><pre class="language-json"><code># _search是关键字，下文基本每个查询都会有它，不再赘述了哈
GET /your_index/your_type/_search
<span class="token punctuation">{</span>
  <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;match_all&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>2、针对name字段进行全文检索（match查询）
ES会将用户将输入的字符串通过分词器拆解开，然后去倒排索引中扫描匹配。在倒排索引中哪怕匹配上了一个也会将结果返回。</p> <div class="language-json extra-class"><pre class="language-json"><code>GET /yourIndex/yourType/_search
<span class="token punctuation">{</span>
   <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
     # match表示全文检索，所以白日梦会被分词成 白日、梦、白日梦
     # 也就是说当前的match会匹配出name中有“白日” 或者“梦” 或者“白日梦”的doc
     <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
       <span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;白日梦&quot;</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
# 实际上，match query底层会被转换成下面的格式进行检索
#
# <span class="token punctuation">{</span>
#    <span class="token property">&quot;bool&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
#        <span class="token property">&quot;should&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
#         <span class="token punctuation">{</span><span class="token property">&quot;term&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;白日&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
#         <span class="token punctuation">{</span><span class="token property">&quot;term&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;白日梦&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
#         <span class="token punctuation">{</span><span class="token property">&quot;term&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;梦&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
#     <span class="token punctuation">]</span>
#  <span class="token punctuation">}</span>
# <span class="token punctuation">}</span>
#
</code></pre></div><p>4、去掉全文检索的长尾</p> <div class="language-json extra-class"><pre class="language-json"><code># 去长尾
GET /your_index/your_type/_search
<span class="token punctuation">{</span>
   <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token property">&quot;query&quot;</span><span class="token operator">:</span><span class="token string">&quot;欢迎关注白日梦！&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;operator&quot;</span><span class="token operator">:</span><span class="token string">&quot;and&quot;</span><span class="token punctuation">,</span>
            # 上面的query可能被分词成： 欢迎、关注、白日梦、欢迎关注、关注白日梦这五个词。
            # 默认来说只要命中其中的一个词，那个doc就会被返回，所以有长尾现象。
            # 去长尾：控制至少命中<span class="token number">3</span>/<span class="token number">4</span>个词的doc才算是真正命中。
            <span class="token property">&quot;minimum_should_match&quot;</span><span class="token operator">:</span><span class="token string">&quot;75%&quot;</span>
        <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
# 添加上 minimum_should_match 操作会被ES转换成下面的格式
#
# <span class="token punctuation">{</span>
#    <span class="token property">&quot;bool&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
#        <span class="token property">&quot;should&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
#         <span class="token punctuation">{</span><span class="token property">&quot;term&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;白日&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
#         <span class="token punctuation">{</span><span class="token property">&quot;term&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;梦&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
#     <span class="token punctuation">]</span><span class="token punctuation">,</span>
#       <span class="token property">&quot;minimum_should_match&quot;</span><span class="token operator">:</span><span class="token number">3</span>
#  <span class="token punctuation">}</span>
# <span class="token punctuation">}</span>
#
</code></pre></div><p>5、全文检索：通过boost控制权重。
如下Case：要求doc的name字段必须包含：“关注”，于此同时，如果doc的name字段中包含：“白日梦”，则将这个doc的权重提高为3，如果name字段中包含了“公众号” 再提高它的权重2。经过这样的处理，name字段中包含：“关注白日梦公众号” 的doc的权重就最高，它在搜索结果中的排名就越靠前。</p> <div class="language-json extra-class"><pre class="language-json"><code>GET /your_index/your_type/_search
<span class="token punctuation">{</span>
   <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token property">&quot;bool&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token property">&quot;must&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
          <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
             <span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
                # 默认情况下，所有字段的权重都是样的，都是<span class="token number">1</span>
                <span class="token property">&quot;query&quot;</span><span class="token operator">:</span><span class="token string">&quot;关注&quot;</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span><span class="token punctuation">,</span>
         <span class="token property">&quot;should&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
            <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
             <span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token property">&quot;query&quot;</span><span class="token operator">:</span><span class="token string">&quot;白日梦&quot;</span><span class="token punctuation">,</span>
                # 将name字段的权重提升成<span class="token number">3</span>
                <span class="token property">&quot;boost&quot;</span><span class="token operator">:</span><span class="token number">3</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
            <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
             <span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token property">&quot;query&quot;</span><span class="token operator">:</span><span class="token string">&quot;公众号&quot;</span><span class="token punctuation">,</span>
                # 将name字段的权重提升成<span class="token number">3</span>
                # 默认情况下，所有字段的权重都是样的，都是<span class="token number">1</span>
                <span class="token property">&quot;boost&quot;</span><span class="token operator">:</span><span class="token number">2</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>6、稍微复杂一点的多条件查询:bool查询</p> <div class="language-json extra-class"><pre class="language-json"><code>GET /your_index/your_type/_search
<span class="token punctuation">{</span>
  <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # 比如你的查询比较复杂，涉及到很多的子查询，那你可以考虑通过bool查询包裹这些子查询
    # 每一个子查询都会计算出这个doc针对于它这种查询得到的相关性得分。
    # 最终由bool查询将这些得分合并为一个最终的得分
    <span class="token property">&quot;bool&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      # 必须匹配到XXX， 并且会得出相关性得分
      # address中必须包含mill
      <span class="token property">&quot;must&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span><span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mill&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      # 在满足must的基础上，should条件不满足也可以，但是如果也匹配上了，相关性得分会增加
      # 如果没有must的话，should中的条件必须满足一个
      <span class="token property">&quot;should&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lane&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">&quot;must_not&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> # 一定不包含谁
        <span class="token punctuation">{</span> <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mill&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>7、bool查询+去长尾。</p> <div class="language-json extra-class"><pre class="language-json"><code># bool查询+去长尾
GET /your_index/your_type/_search
<span class="token punctuation">{</span>
  <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;bool&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
      <span class="token property">&quot;should&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token property">&quot;match&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;白日梦1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;match&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;白日梦2&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;match&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;白日梦3&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">&quot;minimum_should_match&quot;</span><span class="token operator">:</span><span class="token number">3</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>8、best fields策略：取多个query中得分最高的得分作为doc的最终得分。
一个query中是存在多个match的（我们称它为多字段查询），而且每个match都会贡献自己的相关性得分，也就是说doc最终的相关性得分是通过这多个match贡献的相关性得分通过一定的机制计算出来的。而且相关性得分越高，文档在搜索结果中就越靠前。这时，如果你不希望让doc的最终得分是通过综合所有的match计算得出的，可以使用dis_max查询。它会取所有match中得分最高的match当作doc的最终得分。</p> <div class="language-json extra-class"><pre class="language-json"><code>GET /your_index/your_type/_search
<span class="token punctuation">{</span>
   <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
     # 这种用法不容忽略
     # 直接取下面多个query中得分最高的query当成最终得分
     <span class="token property">&quot;dis_max&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;queries&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
           <span class="token punctuation">{</span><span class="token property">&quot;match&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;白日梦&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
           <span class="token punctuation">{</span><span class="token property">&quot;match&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;content&quot;</span><span class="token operator">:</span><span class="token string">&quot;关注白日梦！&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>9、基于 tie_breaker 优化dis_max上面的Case中有提到这个dis_max查询，这个dis_max也是实现best field的关键，即：它会取所有match中得分最高的match当作doc的最终得分。而这个例子中的tie_breaker会重新让dis_max考虑到其他field的得分影响，比如下面的0.4，表示最终的doc得分会考虑其他match的影响，但是它的影响会被弱化成原来的0.4。</p> <div class="language-json extra-class"><pre class="language-json"><code>GET /your_index/your_type/_search
<span class="token punctuation">{</span>
    # 基于 tie_breaker 优化dis_max
    # tie_breaker可以使dis_max考虑其它field的得分影响
    <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
     # 直接取下面多个query中得分最高的query当成最终得分
     # 这也是best field策略
     <span class="token property">&quot;dis_max&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;queries&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
           <span class="token punctuation">{</span><span class="token property">&quot;match&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;关注&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
           <span class="token punctuation">{</span><span class="token property">&quot;match&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;content&quot;</span><span class="token operator">:</span><span class="token string">&quot;白日梦&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;tie_breaker&quot;</span><span class="token operator">:</span><span class="token number">0.4</span>
     <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>10、同时在你指定的多个字段中进行检索：multi_match</p> <div class="language-json extra-class"><pre class="language-json"><code>GET /your_index/your_type/_search
<span class="token punctuation">{</span>
  # 查询多个，在下面指定的两个字段中检索含有 “this is a test“ 的doc
  <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;multi_match&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;query&quot;</span><span class="token operator">:</span>    <span class="token string">&quot;this is a test&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;fields&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;subject&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;message&quot;</span> <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>11、使用multi_match query简化dis_max</p> <div class="language-json extra-class"><pre class="language-json"><code># 还是这个dis_max query，如下：
GET /your_index/your_type/_search
<span class="token punctuation">{</span>
    # 基于 tie_breaker 优化dis_max
    # tie_breaker可以使dis_max考虑其它field的得分影响
    <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
     # 直接取下面多个query中得分最高的query当成最终得分
     # 这也是best field策略
     <span class="token property">&quot;dis_max&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;queries&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
           <span class="token punctuation">{</span><span class="token property">&quot;match&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;关注&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
           <span class="token punctuation">{</span><span class="token property">&quot;match&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;content&quot;</span><span class="token operator">:</span><span class="token string">&quot;白日梦&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;tie_breaker&quot;</span><span class="token operator">:</span><span class="token number">0.4</span>
     <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
# 使用multi_match query简化写法如下：
GET /your_index/your_type/_search
<span class="token punctuation">{</span>
    <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
       <span class="token property">&quot;multi_match&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
           <span class="token property">&quot;query&quot;</span><span class="token operator">:</span><span class="token string">&quot;关注 白日梦&quot;</span><span class="token punctuation">,</span>
            # 指定检索的策略 best_fields（因为dis_max就是best field策略）
           <span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;best_fields&quot;</span><span class="token punctuation">,</span>
            # content^<span class="token number">2</span> 表示增加权重，相当于：boost2
           <span class="token property">&quot;fields&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;content^2&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
           <span class="token property">&quot;tie_breaker&quot;</span><span class="token operator">:</span><span class="token number">0.4</span><span class="token punctuation">,</span>
           <span class="token property">&quot;minimum_should_match&quot;</span><span class="token operator">:</span><span class="token number">3</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>12、most field策略和上面说的best field策略是不同的，因为best field策略说的是：优先返回某个field匹配到更多关键字的doc。优先返回有更多的field匹配到你给定的关键字的doc。而不是优先返回某个field完全匹配你给定关键字的doc另外most_fields不支持使用minimum_should_match去长尾。</p> <div class="language-json extra-class"><pre class="language-json"><code>GET /your_index/your_type/_search
<span class="token punctuation">{</span>
    # most_fields策略、优先返回命中更多关键词的doc
    # 如下从title、name、content中搜索包含“赐我白日梦”的doc
    <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
       <span class="token property">&quot;multi_match&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
           <span class="token property">&quot;query&quot;</span><span class="token operator">:</span><span class="token string">&quot;赐我白日梦&quot;</span><span class="token punctuation">,</span>
            # 指定检索的策略most_fields
           <span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;most_fields&quot;</span><span class="token punctuation">,</span>
           <span class="token property">&quot;fields&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;content&quot;</span><span class="token punctuation">]</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>13、cross_fields策略：如下Case</p> <div class="language-json extra-class"><pre class="language-json"><code>GET /your_index/your_type/_search
<span class="token punctuation">{</span>
    <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
       <span class="token property">&quot;multi_match&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
           <span class="token property">&quot;query&quot;</span><span class="token operator">:</span><span class="token string">&quot;golang java&quot;</span><span class="token punctuation">,</span>
            # cross_fields 要求golang：必须在title或者在content中出现
            # cross_fields 要求java：必须在title或者在content中出现
           <span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;cross_fields&quot;</span><span class="token punctuation">,</span>
           <span class="token property">&quot;fields&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;content&quot;</span><span class="token punctuation">]</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>14、查询空</p> <div class="language-json extra-class"><pre class="language-json"><code>GET /your_index/your_type/_search
<span class="token punctuation">{</span>
  <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;match_none&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>15、精确匹配</p> <div class="language-json extra-class"><pre class="language-json"><code># 使用trem指定单个字段进行精确匹配
GET /your_index/your_type/_search
<span class="token punctuation">{</span>
  # 精确匹配name字段为白日梦的doc
  <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;constant_score&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token property">&quot;filter&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
          <span class="token property">&quot;term&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;白日梦&quot;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
# 使用terms指定在多个字段中进行精确匹配
# 下面的例子相当于SQL： where name in ('tom'<span class="token punctuation">,</span>'jerry')
GET /your_index/your_type/_search
<span class="token punctuation">{</span>
   # 精确匹配
  <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;constant_score&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token property">&quot;filter&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
          <span class="token property">&quot;terms&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;想搜索的字段名&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
                  <span class="token string">&quot;tom&quot;</span><span class="token punctuation">,</span>
                  <span class="token string">&quot;jerry&quot;</span>
            <span class="token punctuation">]</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>16、短语检索：要求doc的该字段的值和你给定的值完全相同，顺序也不能变，所以它的精确度很高，但是召回率低。</p> <div class="language-json extra-class"><pre class="language-json"><code>GET /your_index/your_type/_search
<span class="token punctuation">{</span>
  # 短语检索
  # 顺序的保证是通过 term position来保证的
  # 精准度很高，但是召回率低
  <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          # 只有name字段中包含了完整的 白日梦 这个doc才算命中
          # 不能是单个 ”白日“，也不能是单个的 “梦”，也不能是“白日xxx梦”
          # 要求 短语相连，且顺序也不能变
         <span class="token property">&quot;match_phrase&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
             <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;白日梦&quot;</span>
          <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>17、提高短语检索的召回率 如果使用match_phase进行短语检索，本质上就是要求doc中的字段值和给定的值完全相同，即使是顺序不同也不行。但是为了提高召回率如你又想容忍短语匹配可以存在一定的误差，比如你希望搜索 “i love world” 时，能够搜索出''world love i&quot;这时可以通过slop来实现这个功能，slop可以帮你让指定短语中的词最多经过slop次移动后如果能匹配某个doc，也把这个doc当作结果返回给用户。</p> <div class="language-json extra-class"><pre class="language-json"><code>GET /your_index/your_type/_search
<span class="token punctuation">{</span>
   # 短语检索
   <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
         # 指定了slop就不再要求搜索term之间必须相邻，而是可以最多间隔slop距离。
         # 在指定了slop参数的情况下，离关键词越近，移动的次数越少， relevance score 越高。
         # match_phrase +  slop 和 proximity match 近似匹配作用类似。
         # 平衡精准度和召回率。
         <span class="token property">&quot;match_phrase&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
             <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mill lane&quot;</span><span class="token punctuation">,</span>
             # 指定搜索文本中的几个term经过几次移动后可以匹配到一个doc
             <span class="token property">&quot;slop&quot;</span><span class="token operator">:</span><span class="token number">2</span>
          <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>18、混合使用match和match_phrase 平衡精准度和召回率</p> <div class="language-json extra-class"><pre class="language-json"><code>GET /your_index/your_type/_search
<span class="token punctuation">{</span>
   # 混合使用match和match_phrase 平衡精准度和召回率
   <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;bool&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;must&quot;</span><span class="token operator">:</span>  <span class="token punctuation">{</span>
            # 全文检索虽然可以匹配到大量的文档，但是它不能控制词条之间的距离
            # 可能i love world在doc1中距离很近，但是它却被ES排在结果集的后面
            # 它的性能比match_phrase和proximity高
            <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;i love world&quot;</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;should&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            # 因为slop有个特性：词条之间间隔的越近，移动的次数越少 最终的得分就越高
            # 于是可以借助match_phrase+slop感知term position的功能
            # 实现为距离相近的doc贡献分数，让它们靠前排列
            <span class="token property">&quot;match_phrase&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
                    <span class="token property">&quot;query&quot;</span><span class="token operator">:</span><span class="token string">&quot;i love world&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;slop&quot;</span><span class="token operator">:</span><span class="token number">15</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>19、使用rescore_query重打分。提高精准度和召回率。</p> <div class="language-json extra-class"><pre class="language-json"><code>GET /your_index/your_type/_search
<span class="token punctuation">{</span>
   # 重打分机制
   <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
       <span class="token property">&quot;match&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
           <span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
               <span class="token property">&quot;query&quot;</span><span class="token operator">:</span><span class="token string">&quot;i love world&quot;</span><span class="token punctuation">,</span>
               <span class="token property">&quot;minimum_should_match&quot;</span><span class="token operator">:</span><span class="token string">&quot;50%&quot;</span>
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
       # 对全文检索的结果进行重新打分
       <span class="token property">&quot;rescore&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
           # 对全文检索的前<span class="token number">50</span>条进行重新打分
           <span class="token property">&quot;window_size&quot;</span><span class="token operator">:</span><span class="token number">50</span>，
           <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
               # 关键字
               <span class="token property">&quot;rescore_query&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
                    # match_phrase + slop 感知 term persition，贡献分数
                    <span class="token property">&quot;match_phrase&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
                       <span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
                           <span class="token property">&quot;query&quot;</span><span class="token operator">:</span><span class="token string">&quot;i love world&quot;</span><span class="token punctuation">,</span>
                           <span class="token property">&quot;slop&quot;</span><span class="token operator">:</span><span class="token number">50</span>
                     <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>20、前缀匹配：搜索 user字段以&quot;白日梦&quot;开头的 doc</p> <div class="language-json extra-class"><pre class="language-json"><code>GET /your_index/your_type/_search
<span class="token punctuation">{</span>
  # 前缀匹配，相对于全文检索，前缀匹配是不会对前缀进行分词的。
  # 而且每次匹配都会扫描整个倒排索引，直到扫描完一遍才会停下来
  # 前缀搜索不会计算相关性得分所有的doc的得分都是<span class="token number">1</span>
  # 前缀越短能匹配到的doc就越多，性能越不好
  <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;prefix&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;user&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;白日梦&quot;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>21、前缀搜索 + 添加权重</p> <div class="language-json extra-class"><pre class="language-json"><code>GET /your_index/your_type/_search
<span class="token punctuation">{</span>
  # 前缀搜索 + 添加权重
  <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;prefix&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;name&quot;</span> <span class="token operator">:</span>  <span class="token punctuation">{</span>
        <span class="token property">&quot;value&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;白日梦&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;boost&quot;</span> <span class="token operator">:</span> <span class="token number">2.0</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>22、通配符搜索</p> <div class="language-json extra-class"><pre class="language-json"><code>GET /your_index/your_type/_search
<span class="token punctuation">{</span>
  # 通配符搜索
  <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;wildcard&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;title&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;白日梦的*笔记&quot;</span>
        <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
GET /your_index/your_type/_search
<span class="token punctuation">{</span>
  # 通配符搜索
  <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;wildcard&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;title&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;value&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;白日梦的*笔记&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;boost&quot;</span> <span class="token operator">:</span> <span class="token number">2.0</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>23、正则搜索</p> <div class="language-json extra-class"><pre class="language-json"><code>GET /your_index/your_type/_search
<span class="token punctuation">{</span>
   # 正则搜索
   <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;regexp&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token property">&quot;name.first&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token string">&quot;s.*y&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;boost&quot;</span><span class="token operator">:</span><span class="token number">1.2</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>24、搜索推荐：match_phrase_prefix，最终实现的效果类似于百度搜索，当用户输入一个词条后，将其它符合条件的词条的选项推送出来。match_phrase_prefix和match_phrase相似，但是区别是它会将最后一个term当作前缀，发起一次搜索。因此它也叫search time 搜索推荐，因为它是在你搜索的时候又发起了一次新的请求来拿到推荐的内容，它的效率整体也是比较低的。</p> <div class="language-json extra-class"><pre class="language-json"><code>GET /your_index/your_type/_search
<span class="token punctuation">{</span>
   <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      # 前缀匹配（关键字）
      <span class="token property">&quot;match_phrase_prefix&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;message&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                # 比如你搜索关注白日梦，经过分词器处理后会得到最后一个词是：“白日梦”
                # 然后他会拿着白日梦再发起一次搜索，于是你就可能搜到下面的内容：
                # “关注白日梦的微信公众号”
                # ”关注白日梦的圈子“
                <span class="token property">&quot;query&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;关注白日梦&quot;</span><span class="token punctuation">,</span>
                # 指定前缀最多匹配多少个term，超过这个数量就不在倒排索引中检索了，提升性能
                <span class="token property">&quot;max_expansions&quot;</span> <span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
                # 提高召回率，使用slop调整term persition，贡献得分
                <span class="token property">&quot;slop&quot;</span><span class="token operator">:</span><span class="token number">10</span>
            <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>25、Function Score Query 实际上是一种让用户可以自定义实现一种对doc得分进行增强的手段。比如：用户可以自定义一个function_secore 函数，然后指定将这个field的值和ES计算出来的分数相乘，作为doc的最终得分。</p> <div class="language-json extra-class"><pre class="language-json"><code># Case1
GET /your_index/your_type/_search
<span class="token punctuation">{</span>
  <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;function_score&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            # 正常写一个query
            <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;query&quot;</span><span class="token operator">:</span><span class="token string">&quot;es&quot;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            # 自定义增强策略
            “field_value_factor”<span class="token operator">:</span><span class="token punctuation">{</span>
              # 对检索出的doc的最终得分都要multiply上star字段的值
              <span class="token property">&quot;field&quot;</span><span class="token operator">:</span><span class="token string">&quot;star&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
            <span class="token property">&quot;boost_mode&quot;</span><span class="token operator">:</span><span class="token string">&quot;multiply&quot;</span><span class="token punctuation">,</span>
            # 限制最大的得分不能超过maxboost指定的值。
            <span class="token property">&quot;maxboost&quot;</span><span class="token operator">:</span><span class="token number">3</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
# Case2
GET /your_index/your_type/_search
<span class="token punctuation">{</span>
  <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;function_score&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;query&quot;</span><span class="token operator">:</span><span class="token string">&quot;es&quot;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            “field_value_factor”<span class="token operator">:</span><span class="token punctuation">{</span>
              # 对检索出的doc的最终得分都要multiply上star字段的值
              # 这时有个问题，假如说star字段的值为<span class="token number">0</span>，那最终结果岂不是都为<span class="token number">0</span>？
              <span class="token property">&quot;field&quot;</span><span class="token operator">:</span><span class="token string">&quot;star&quot;</span><span class="token punctuation">,</span>
              # 所以考虑使用modifier优化一下
              # newScore = oldScore + log(<span class="token number">1</span>+star)
              <span class="token property">&quot;modifier&quot;</span><span class="token operator">:</span><span class="token string">&quot;log1p&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
            <span class="token property">&quot;boost_mode&quot;</span><span class="token operator">:</span><span class="token string">&quot;multiply&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;maxboost&quot;</span><span class="token operator">:</span><span class="token number">3</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
# Case3
GET /your_index/your_type/_search
<span class="token punctuation">{</span>
  <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;function_score&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;query&quot;</span><span class="token operator">:</span><span class="token string">&quot;es&quot;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            “field_value_factor”<span class="token operator">:</span><span class="token punctuation">{</span>
              <span class="token property">&quot;field&quot;</span><span class="token operator">:</span><span class="token string">&quot;star&quot;</span><span class="token punctuation">,</span>
              <span class="token property">&quot;modifier&quot;</span><span class="token operator">:</span><span class="token string">&quot;log1p&quot;</span><span class="token punctuation">,</span>
              # 使用factor将star字段对权重的影响降低成<span class="token number">1</span>/<span class="token number">10</span>
              # newScore = oldScore + log( <span class="token number">1</span> + star*factor )
              <span class="token property">&quot;factor&quot;</span><span class="token operator">:</span><span class="token number">0.1</span>
            <span class="token punctuation">}</span>
            <span class="token property">&quot;boost_mode&quot;</span><span class="token operator">:</span><span class="token string">&quot;multiply&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;maxboost&quot;</span><span class="token operator">:</span><span class="token number">3</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
# 补充boost_mode有哪些中选项
multiply、sum、min、max、replace
</code></pre></div><p>26、Fuzzy Query 模糊查询会提供容错的处理</p> <div class="language-json extra-class"><pre class="language-json"><code>GET /your_index/your_type/_search
<span class="token punctuation">{</span>
   # Fuzzy Query 模糊查询会提供容错的处理
   <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;fuzzy&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;user&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;白日梦&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;boost&quot;</span><span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
                # 最大的纠错次数，一般设为之AUTO
                <span class="token property">&quot;fuzziness&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                # 不会被“模糊化”的初始字符数。这有助于减少必须检查的术语的数量。默认值为<span class="token number">0</span>。
                <span class="token property">&quot;prefix_length&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                # 模糊查询将扩展到的最大项数。默认值为<span class="token number">50</span>
                <span class="token property">&quot;max_expansions&quot;</span><span class="token operator">:</span> <span class="token number">100</span>
                # 是否支持模糊变换(ab→ba)。默认的是<span class="token boolean">false</span>
                transpositions<span class="token operator">:</span><span class="token boolean">true</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>27、解读一个实用的案例</p> <div class="language-json extra-class"><pre class="language-json"><code>GET /your_index/your_type/_search
<span class="token punctuation">{</span>
  <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # 比如你的查询比较复杂，涉及到很多的子查询，那你可以考虑通过bool查询包裹这些子查询
    # 每一个子查询都会计算出这个doc针对于它这种查询得到的相关性得分。
    # 最终由bool查询将这些得分合并为一个最终的得分
    <span class="token property">&quot;bool&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      # 必须匹配到XXX， 并且会得出相关性得分
      # address中必须包含mill
      <span class="token property">&quot;must&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mill&quot;</span>
           <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      # 在满足must的基础上，should条件不满足也可以，但是如果也匹配上了，相关性得分会增加
      # 如果没有must的话，should中的条件必须满足一个
      <span class="token property">&quot;should&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lane&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">&quot;must_not&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> # 一定不包含谁
        <span class="token punctuation">{</span> <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mill&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      # filter中的表达式仅仅对数据进行过滤<span class="token punctuation">,</span>但是不会影响搜索结果的相关度得分。
      # 所以你如果不希望添加的过滤条件影响最终的doc排序的话，可以将条件放在filter中。
      # query是会计算doc的相关度得分的，得分越高，越靠前。
      <span class="token property">&quot;filter&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;range&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> # 按照范围过滤
          <span class="token property">&quot;balance&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> # 指定过滤的字段
            <span class="token property">&quot;gte&quot;</span><span class="token operator">:</span> 20000s # 高于<span class="token number">20000</span>
            <span class="token property">&quot;lte&quot;</span><span class="token operator">:</span> <span class="token number">30000</span>  # 低于<span class="token number">30000</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>28、查询名称中包含“白日梦”的doc，并且按照star排序高亮、排序、分页以及_source 指定需要的字段都可以进一步作用在query的结果上。</p> <div class="language-json extra-class"><pre class="language-json"><code># ES默认的排序规则是按照 _score 字段降序排序的
# 但是ES允许你像下面这样定制排序规则
GET /your_index/your_type/_search
<span class="token punctuation">{</span>
   <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;白日 梦&quot;</span><span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
  # 指定排序条件
  <span class="token property">&quot;sort&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
    # 指定排序字段为 star
    <span class="token punctuation">{</span><span class="token property">&quot;star&quot;</span><span class="token operator">:</span><span class="token string">&quot;desc&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>29、分页查询 如：从第一条doc开启查，查10条。（如果你不使用from、to搜索的话，默认就搜索前10条）</p> <div class="language-json extra-class"><pre class="language-json"><code>GET /your_index/your_type/_search
<span class="token punctuation">{</span>
   <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;match_all&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;from&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> # <span class="token number">0</span>：是第一个doc
    <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">10</span>
<span class="token punctuation">}</span>   
# 还可以像这样发起分页请求
GET /your_index/your_type/_search?size=<span class="token number">10</span>
GET /your_index/your_type/_search?size=<span class="token number">10</span>&amp;from=<span class="token number">20</span>
# deep paging 问题
比如系统中只有<span class="token number">3</span>个primary shard，<span class="token number">1</span>个replica shard，共有6W条数据。
用户希望查询第<span class="token number">1000</span>页，每页<span class="token number">10</span>条数据。也就是<span class="token number">1000</span>*<span class="token number">10</span> = <span class="token number">10001</span> ～ <span class="token number">10010</span> 条数据
假如说用户将这个分页请求会打向ES集群中的replica shard，接下来会发生什么？
回答：
接收到请求的shard 我们称它为coordinate node（协调节点），它会将请求转发到三个primary，
每个primary shard都会取出它们的第<span class="token number">1</span>～<span class="token number">10010</span>条数据id，返回给coordinate node，
也就是说coordinate node总共会接收到<span class="token number">30030</span>个id，然后coordinate node再拿着这些id发起mget请求获取数据
对获取到的结果<span class="token number">30030</span>排序处理，最后取相关性得分最高的<span class="token number">10</span>条返回给用户。
所以当分页过深的时候是非常消耗内存、网络带宽、CPU的。
</code></pre></div><p>30、指定要查询出来的doc的某几个字段。如下：</p> <div class="language-json extra-class"><pre class="language-json"><code># 假设白日梦对应的json长下面这样：
<span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;白日梦&quot;</span><span class="token punctuation">,</span>
  “address”<span class="token operator">:</span><span class="token string">&quot;beijing&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;gender&quot;</span><span class="token operator">:</span><span class="token string">&quot;man&quot;</span>
<span class="token punctuation">}</span>
# 然后我只想检索出name字段，其他的不想知道，可以像下面这样通过_sorce限制
GET /your_index/your_type/_search
<span class="token punctuation">{</span>
   <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;match_all&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
   # ES会返回全文JSON，通过_source可以指定返回的字段
   <span class="token property">&quot;_source&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>31、filter过滤，查询name中包含白日梦，且star大于100的doc。</p> <div class="language-json extra-class"><pre class="language-json"><code>GET /your_index/your_type/_search
<span class="token punctuation">{</span>
   <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
     # 可以使用bool封装包括多个查询条件
     “bool&quot;<span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token property">&quot;must&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;白日 梦&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
        # 指定按照star的范围进行filter
        <span class="token property">&quot;filter&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
            # range既能放在query中，也能放在filter中。
            # 如果放在filter中，range过滤的动作不会影响最终的得分。
            # 但是放在query中，range动作会影响最终的得分。
            <span class="token property">&quot;range&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
              “star”<span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;gt&quot;</span><span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">}</span>
             <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>  
# 拓展：
# 关于range还可以像这样过滤时间
<span class="token property">&quot;range&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
  # 指定birthday范围为最近一个月的doc
  <span class="token property">&quot;birthday&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token property">&quot;gt&quot;</span><span class="token operator">:</span><span class="token string">&quot;2021-01-20||-30d&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
# 或者使用now语法
  # 指定birthday范围为最近一个月的doc
  <span class="token property">&quot;birthday&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token property">&quot;gt&quot;</span><span class="token operator">:</span><span class="token string">&quot;now-30d&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>32、指定对返回的doc中指定字段中的指定单词高亮显示。</p> <div class="language-json extra-class"><pre class="language-json"><code>GET /your_index/your_type/_search
<span class="token punctuation">{</span>
   <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;白日 梦&quot;</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;highlight&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span> # 高亮显示
       <span class="token property">&quot;fields&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>  # 指定高亮的字段为 firstname
         <span class="token property">&quot;firstname&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
# 最终得到的返回值类似下面这样
  ...
  <span class="token property">&quot;hits&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;total&quot;</span> <span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span># <span class="token number">1000</span>个
    <span class="token property">&quot;max_score&quot;</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
    <span class="token property">&quot;hits&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;_index&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;bank&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;_type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;_doc&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;sort&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">&quot;_score&quot;</span> <span class="token operator">:</span> <span class="token number">0.777777</span><span class="token punctuation">,</span>
      <span class="token property">&quot;_source&quot;</span> <span class="token operator">:</span>     <span class="token punctuation">{</span><span class="token property">&quot;account_number&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
                       <span class="token property">&quot;balance&quot;</span><span class="token operator">:</span><span class="token number">16623</span><span class="token punctuation">,</span>
                       <span class="token property">&quot;firstname&quot;</span><span class="token operator">:</span><span class="token string">&quot;我是白&quot;</span><span class="token punctuation">,</span>
                       <span class="token property">&quot;lastname&quot;</span><span class="token operator">:</span><span class="token string">&quot;日梦&quot;</span><span class="token punctuation">,</span>
                       <span class="token property">&quot;state&quot;</span><span class="token operator">:</span><span class="token string">&quot;CO&quot;</span><span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">&quot;highlight&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
       <span class="token property">&quot;firstname&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
         <span class="token string">&quot;我是&lt;em&gt;白&lt;/em&gt;&quot;</span>
       <span class="token punctuation">]</span>
 <span class="token punctuation">}</span>
 ...
</code></pre></div><h3 id="_4-share"><a href="#_4-share" class="header-anchor">#</a> 4.Share:</h3> <p>https://discuss.redash.io/t/using-redash-to-visualize-the-output-of-aggregation-queries-in-elasticsearch/164
使用redash可视化es聚合查询</p> <p>https://stackoverflow.com/questions/69299444/unable-to-perform-nested-aggregation-on-elasticsearch
无法在弹性搜索上执行嵌套聚合</p> <p>https://discuss.redash.io/t/how-to-add-influxdb-as-data-source/1762/4
redash如何添加influxdb数据源</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.65b0f24a.js" defer></script><script src="/assets/js/2.d6ca9a42.js" defer></script><script src="/assets/js/115.2369b994.js" defer></script>
  </body>
</html>
