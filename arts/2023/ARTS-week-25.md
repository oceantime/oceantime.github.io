---
> **ARTS-week-25**
> 2023-06-17 19:55
---


## ARTS-2019 左耳听风社群活动--每周完成一个 ARTS
1.Algorithm： 每周至少做一个 leetcode 的算法题
2.Review: 阅读并点评至少一篇英文技术文章
3.Tip: 学习至少一个技术技巧
4.Share: 分享一篇有观点和思考的技术文章

### 1.Algorithm:

- [1375. 二进制字符串前缀一致的次数](https://leetcode.cn/submissions/detail/439830248/)  
    + 思路：贪心
- [1177. 构建回文串检测](https://leetcode.cn/submissions/detail/440066170/)  
    + 思路：前缀和
- [1254. 统计封闭岛屿的数目](https://leetcode.cn/submissions/detail/440629655/)  
    + 思路：DFS

### 2.Review:

[前端性能之旅 — 评估当前性能](https://underthehood.meltwater.com/blog/2020/04/03/the-journey-to-front-end-performance-assessing-current-performance/)

我们的应用程序框架团队的任务是评估和改进应用程序性能。分析全球性能具有挑战性。Meltwater应用程序的架构布局以及我们组织团队的方式带来了各种挑战。

这是关于前端性能的系列文章中的第一篇文章。我们将分享我们的应用程序框架团队如何评估应用程序的当前性能。持续监控和相对指标是关注性能时的基石。以下是我们奠定基石的方式。

#### 1、Meltwater的应用团队结构

在被要求调试特定地理区域的应用性能问题后，我们的团队很快意识到我们对应用指标的了解几乎为零。应用程序功能由独立的开发团队从头开始管理，他们处理从编码到操作的所有内容。融水产品可以被认为是一套无缝协同工作的应用程序。这些独立的功能应用程序拼接在一起，显示为单个统一的应用程序。此应用程序结构在整体性能和指标收集方面都提出了独特的挑战。

#### 2、用户期望什么样的体验？

当今互联网上的许多当前 Web 应用程序都构建为单页应用程序（SPA）。SPA通常使用诸如React，Angular，Vue等框架。这些类型的应用程序将代码捆绑在一起，并动态更改用户页面上的内容，而无需执行重新加载，即使在导航到不同的页面时也是如此。SPA 几乎“预先”下载所有代码。结果是第一次加载通常相当慢，但在 Web 应用程序中导航的速度非常快。SPA 是网络上的常见模式，也是互联网用户熟悉的体验。

#### 3、那么，我们的应用程序提供了什么体验？

由于我们团队结构的性质，每个功能本质上都是一个单独的网站。此结构意味着当用户从一个功能导航到另一个功能时，他们正在加载一个新应用程序，这称为多 SPA。每个功能可以构建在不同的框架上，功能A使用AngularJS，功能B使用React。

多 SPA 允许团队在他们使用的技术中进行选择，同时将统一的体验呈现为产品。期望通过快速导航获得单 SPA 风格体验的用户偶尔会发现这种体验令人不快，即使有快速的互联网连接也是如此。

#### 4、使问题更加复杂

作为开发人员，我们主要在开发应用程序的同一地理区域使用和测试我们的应用程序。我们拥有良好的互联网连接和高端电脑。当最终用户抱怨“缓慢”时，我们通常无法复制这种体验。作为有技术头脑的人，Web开发人员发现很难量化“慢”。听到投诉后，我们立即打开浏览器，导航到我们的生产应用程序，并喃喃自语，“它在我的机器上工作正常。

在日常工作中，我们通常不考虑的是世界其他地方如何体验我们的应用程序。互联网是一个错综复杂的纸牌屋，我们不能只是把我们的资产放在内容交付网络（CDN）上然后走开。许多因素仍然会影响最终用户的性能。其中一些是我们作为开发人员无法控制的，例如用户所在地区的可用互联网速度或用户所在国家/地区的内容限制。我们可以控制许多技术因素，在本系列的后面部分寻找这些因素。

#### 5、如何将“慢”转化为数据

很难评估和调试“慢”。这些类型的术语是主观的和固执己见的。用户是否有不切实际的期望？也许他们只是度过了糟糕的一天。我们需要量化绩效。

为了开始收集数据，我们转向一个名为Catchpoint的工具，该工具提供来自全球数百台服务器中的任何一台的综合监控。该工具不仅提供来自某些地理位置的测试，还提供特定ISP的测试。

使用selenium脚本，我们可以登录并导航到应用程序内的不同页面，为整个应用程序导航的每个“步骤”收集大量指标。完整的网络流量收集提供每个步骤的瀑布视图，以及每个网络请求的时间。测试结果还提供下载的字节数、首次绘制的时间、交互时间，甚至是页面加载时的屏幕截图胶片条。我们突然可以访问的数据量是压倒性的。关于在全球范围内加载我们的应用程序的真实指标。我们终于可以量化我们的应用程序了！

#### 6、缺少一些东西

在筛选了堆积如山的数据并组织了哪些有用，哪些没有用之后，利益相关者想知道我们发现了什么。我们面临着一个我们意想不到的挑战。我们如何获取这些性能数据并使其易于使用？解决方案令人惊讶;我们需要更多的指标！

#### 7、自定义指标 — MITTI 诞生

我们正在寻找一个指标来评估我们的应用程序加载速度。一个自然的候选者是互动时间（TTI）。此指标无法准确表示用户何时可以开始使用我们的应用。在浏览器加载所有必需的资源后，页面在技术上是“交互式的”，但是，我们的应用程序需要进行 API 调用来获取信息以显示给用户，并且应用程序内容将被禁用，直到数据准备就绪。就浏览器而言，页面可用于交互，但向用户显示禁用的 UI。我们需要一个指标来显示我们的代码获取所需数据并为用户启用页面所花费的时间。我们将这个新指标命名为媒体智能交互时间 （MITTI），“媒体智能”是我们应用程序内部的一个术语。

我们需要一个新的指标，我们知道它应该衡量什么，我们甚至知道我们想怎么称呼它，但是我们如何收集它呢？幸运的是，我们知道应用程序代码中为用户启用应用的位置。在所有功能团队应用包含的脚本中，我们添加了代码来记录这次，并向 selenium 脚本用于获取值的窗口对象添加了一个函数。现在在我们的 Catchpoint 脚本中，我们可以使用如下代码快速获取值：

```
runScript("var our_custom_metric = window.getOurCustomMetric();")
```
现在，我们在测试脚本中的变量中获得了所需的值。Catchpoint 允许我们存储此自定义指标及其收集的所有其他数据（自定义指标存储的实施将取决于您选择的监控工具）。

现在，我们可以创建易于使用的图表和报告，显示全球应用程序加载速度的目标值！

### 3.Tip:

#### DAO 和 Repository

- DAO是Data Access Object的缩写，是一种结构型设计模式，用于分离业务层（应用）和持久化层（数据库）。

 - DAO模式是一种分层的思想，这层就是用于处理和数据库交互（CRUD），而业务层不需要知道DAO层的实现细节。DAO模式可以理解为数据库操作的简单封装，仅此而已。

```java
public interface Dao<T> {

    Optional<T> get(long id);    

    List<T> getAll();    

    void save(T t);  

    void update(T t, String[] params);    

    void delete(T t);

}

public class UserDao implements Dao<User> {

    private List<User> users = new ArrayList<>();

    public UserDao() {
        users.add(new User("John", "john@domain.com"));
        users.add(new User("Susan", "susan@domain.com"));
    }

    @Override
    public Optional<User> get(long id) {
        return Optional.ofNullable(users.get((int) id));
    }

    @Override
    public List<User> getAll() {
        return users;
    }

    @Override
    public void save(User user) {
        users.add(user);
    }
    // ...

}
```

 - 业务层不关心数据来源，它只依赖DAO接口，DAO实现的改变不影响服务层使用，例如从Mysql换成Postgresql，只需更换数据源和DAO实现；
៲ 业务层只依赖DAO接口，解耦服务层和DAO实现，降低耦合度，符合“工作在接口，而不是实现”的OO原则；
៲ 由于DAO的实现（持久层）完全独立，方便进行单元测试；


- Repository在《企业应用架构模式》中翻译为资源库，下文沿用。
 - 定义1：Eric Evans的《领域驱动设计》 - 资源库是一种封装存储、查询和搜索行为的机制，它是一个模拟的对象集合。
 - 定义2：Martin Fowler《企业应用架构模式》- 资源库位于领域模型和数据映射层之间，使用像集合一样的接口访问领域对象。

定义有点抽象，实际上资源库类似DAO，但它抽象程度更高，位于DAO之上的更高一层，更接近于业务层。
资源库位于领域模型和数据映射层之间，就像一个位于内存的领域对象集合，提供一种管理领域对象的机制。
资源库工作流程：业务层使用（近乎）自然语言构建查询条件提交给资源库，资源库执行对象增删等操作（就像操作集合一样），最后资源库自动将操作转为SQL的CRUD并执行。
资源库可以使用DAO执行数据查询，将返回结果转为领域对象，或新建领域对象，资源库执行新增操作，它自动转为DAO新增方法实现数据持久化。
资源库是领域驱动设计的概念，尤其适合于存在大量复杂领域对象的场景。

```java
public interface UserRepository {

    User get(Long id);

    void add(User user);

    void update(User user);

    void remove(User user);

}

public class UserRepositoryImpl implements UserRepository {

    private UserDaoImpl userDaoImpl;

    @Override
    public User get(Long id) {
        User user = userDaoImpl.read(id);
        return user;
    }

    @Override
    public void add(User user) {
        userDaoImpl.create(user);
    }

    // ...
}
```

 - 注意对比示例代码的差别

- 对比
 - DAO抽象数据持久化，资源库抽象领域对象集合；
 - DAO是底层概念，更接近数据库，资源库是高层概念，更接近领域对象（业务逻辑）；
 - DAO简单、通用，可以简单理解为CRUD的封装，操作对象是SQL语句，资源库复杂、抽象，可以理解为对领域模型的封装，操作对象是领域对象，不再关心数据库；
 - DAO旨在隐藏数据库操作的复杂性，例如数据库连接和构造SQL语句，使CRUD更加简单，资源库旨在隐藏领域对象操作的复杂性，使领域业务逻辑更加清晰；
 - DAO不能使用资源库，但资源库可以使用DAO，可以简单认为：资源库 = DAO + 领域对象；

### 4.Share:

[npm删除依赖项_npm依赖项和devDependencies](https://blog.csdn.net/cuk0051/article/details/108342952)
