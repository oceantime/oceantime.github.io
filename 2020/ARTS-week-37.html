<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ARTS-week-37 | Oceantime&#39;s blog</title>
    <meta name="generator" content="VuePress 1.5.3">
    <link rel="icon" href="/logo.jpg">
    <meta name="description" content="Oceantime 个人网站">
    <link rel="preload" href="/assets/css/0.styles.abfd12c2.css" as="style"><link rel="preload" href="/assets/js/app.65b0f24a.js" as="script"><link rel="preload" href="/assets/js/2.d6ca9a42.js" as="script"><link rel="preload" href="/assets/js/50.8ef31d09.js" as="script"><link rel="prefetch" href="/assets/js/10.ad6941e4.js"><link rel="prefetch" href="/assets/js/100.8ade9f63.js"><link rel="prefetch" href="/assets/js/101.a15dfa49.js"><link rel="prefetch" href="/assets/js/102.761bd3ff.js"><link rel="prefetch" href="/assets/js/103.4e1cd420.js"><link rel="prefetch" href="/assets/js/104.6cfd7216.js"><link rel="prefetch" href="/assets/js/105.e2d93a01.js"><link rel="prefetch" href="/assets/js/106.6151bc8f.js"><link rel="prefetch" href="/assets/js/107.ad872ea3.js"><link rel="prefetch" href="/assets/js/108.bc756e31.js"><link rel="prefetch" href="/assets/js/109.fe77c5ed.js"><link rel="prefetch" href="/assets/js/11.f05321e1.js"><link rel="prefetch" href="/assets/js/110.39bd8ea8.js"><link rel="prefetch" href="/assets/js/111.bd5d0a8b.js"><link rel="prefetch" href="/assets/js/112.66f93d20.js"><link rel="prefetch" href="/assets/js/113.e3f1b94f.js"><link rel="prefetch" href="/assets/js/114.6ca21a56.js"><link rel="prefetch" href="/assets/js/115.2369b994.js"><link rel="prefetch" href="/assets/js/116.ef676fd0.js"><link rel="prefetch" href="/assets/js/117.7762c22c.js"><link rel="prefetch" href="/assets/js/118.dc732d76.js"><link rel="prefetch" href="/assets/js/119.2b7f1a4d.js"><link rel="prefetch" href="/assets/js/12.b607cc9e.js"><link rel="prefetch" href="/assets/js/120.1b132ede.js"><link rel="prefetch" href="/assets/js/121.ff9a3172.js"><link rel="prefetch" href="/assets/js/122.2f47d49f.js"><link rel="prefetch" href="/assets/js/13.67af4ad6.js"><link rel="prefetch" href="/assets/js/14.c7827c0f.js"><link rel="prefetch" href="/assets/js/15.eedb1566.js"><link rel="prefetch" href="/assets/js/16.fe37cbf7.js"><link rel="prefetch" href="/assets/js/17.a38f0ae2.js"><link rel="prefetch" href="/assets/js/18.4990ee61.js"><link rel="prefetch" href="/assets/js/19.f4dbb6de.js"><link rel="prefetch" href="/assets/js/20.9ffd67c9.js"><link rel="prefetch" href="/assets/js/21.ac6e1d53.js"><link rel="prefetch" href="/assets/js/22.76b0e02e.js"><link rel="prefetch" href="/assets/js/23.ff3410dc.js"><link rel="prefetch" href="/assets/js/24.f76a6fea.js"><link rel="prefetch" href="/assets/js/25.0534f43c.js"><link rel="prefetch" href="/assets/js/26.c3725782.js"><link rel="prefetch" href="/assets/js/27.deb9c9f3.js"><link rel="prefetch" href="/assets/js/28.6f99ddc2.js"><link rel="prefetch" href="/assets/js/29.02cfc711.js"><link rel="prefetch" href="/assets/js/3.9f6270c9.js"><link rel="prefetch" href="/assets/js/30.ccabc2c3.js"><link rel="prefetch" href="/assets/js/31.b08f8990.js"><link rel="prefetch" href="/assets/js/32.ee62ba38.js"><link rel="prefetch" href="/assets/js/33.f7629f38.js"><link rel="prefetch" href="/assets/js/34.2853c933.js"><link rel="prefetch" href="/assets/js/35.97e611fd.js"><link rel="prefetch" href="/assets/js/36.fa3c8ed4.js"><link rel="prefetch" href="/assets/js/37.8ae8d904.js"><link rel="prefetch" href="/assets/js/38.05c35d7b.js"><link rel="prefetch" href="/assets/js/39.e5258c9e.js"><link rel="prefetch" href="/assets/js/4.ecc02e05.js"><link rel="prefetch" href="/assets/js/40.d668fe84.js"><link rel="prefetch" href="/assets/js/41.c09eb1d5.js"><link rel="prefetch" href="/assets/js/42.b940c3f3.js"><link rel="prefetch" href="/assets/js/43.5f4e8385.js"><link rel="prefetch" href="/assets/js/44.7231a1e4.js"><link rel="prefetch" href="/assets/js/45.585825f0.js"><link rel="prefetch" href="/assets/js/46.14ddc0e4.js"><link rel="prefetch" href="/assets/js/47.52d53fb0.js"><link rel="prefetch" href="/assets/js/48.01214996.js"><link rel="prefetch" href="/assets/js/49.a8e7ddc6.js"><link rel="prefetch" href="/assets/js/5.755ee6e4.js"><link rel="prefetch" href="/assets/js/51.86c845e5.js"><link rel="prefetch" href="/assets/js/52.0d1a6570.js"><link rel="prefetch" href="/assets/js/53.0b2ca6b6.js"><link rel="prefetch" href="/assets/js/54.daa0b522.js"><link rel="prefetch" href="/assets/js/55.b7e6d8cc.js"><link rel="prefetch" href="/assets/js/56.67e22da8.js"><link rel="prefetch" href="/assets/js/57.1b8d87fd.js"><link rel="prefetch" href="/assets/js/58.4ef89df1.js"><link rel="prefetch" href="/assets/js/59.abdf0f5c.js"><link rel="prefetch" href="/assets/js/6.3df7280b.js"><link rel="prefetch" href="/assets/js/60.35f8805b.js"><link rel="prefetch" href="/assets/js/61.68fa7ebd.js"><link rel="prefetch" href="/assets/js/62.fd6b0085.js"><link rel="prefetch" href="/assets/js/63.af0dbde2.js"><link rel="prefetch" href="/assets/js/64.16a1ffec.js"><link rel="prefetch" href="/assets/js/65.af1a9908.js"><link rel="prefetch" href="/assets/js/66.0ab56108.js"><link rel="prefetch" href="/assets/js/67.7b28f376.js"><link rel="prefetch" href="/assets/js/68.be9ab4b2.js"><link rel="prefetch" href="/assets/js/69.c030abbd.js"><link rel="prefetch" href="/assets/js/7.3549904d.js"><link rel="prefetch" href="/assets/js/70.1469061c.js"><link rel="prefetch" href="/assets/js/71.4802b635.js"><link rel="prefetch" href="/assets/js/72.83cb541b.js"><link rel="prefetch" href="/assets/js/73.3ad064c7.js"><link rel="prefetch" href="/assets/js/74.00cd90be.js"><link rel="prefetch" href="/assets/js/75.cbf47e0f.js"><link rel="prefetch" href="/assets/js/76.44ccee9d.js"><link rel="prefetch" href="/assets/js/77.e9c38d7e.js"><link rel="prefetch" href="/assets/js/78.9122406c.js"><link rel="prefetch" href="/assets/js/79.5478a7f9.js"><link rel="prefetch" href="/assets/js/8.183e1cde.js"><link rel="prefetch" href="/assets/js/80.81f8b615.js"><link rel="prefetch" href="/assets/js/81.ceada5ea.js"><link rel="prefetch" href="/assets/js/82.6106ff2d.js"><link rel="prefetch" href="/assets/js/83.59665864.js"><link rel="prefetch" href="/assets/js/84.14e761a8.js"><link rel="prefetch" href="/assets/js/85.dd1f6fdb.js"><link rel="prefetch" href="/assets/js/86.c780faa6.js"><link rel="prefetch" href="/assets/js/87.b6a78c96.js"><link rel="prefetch" href="/assets/js/88.e6f83878.js"><link rel="prefetch" href="/assets/js/89.3b38af38.js"><link rel="prefetch" href="/assets/js/9.d9ab8dd1.js"><link rel="prefetch" href="/assets/js/90.64e54699.js"><link rel="prefetch" href="/assets/js/91.b0c97860.js"><link rel="prefetch" href="/assets/js/92.a49f1aa9.js"><link rel="prefetch" href="/assets/js/93.30383993.js"><link rel="prefetch" href="/assets/js/94.e5ff08c3.js"><link rel="prefetch" href="/assets/js/95.6ee9cb6c.js"><link rel="prefetch" href="/assets/js/96.829351f9.js"><link rel="prefetch" href="/assets/js/97.dcf9c2e9.js"><link rel="prefetch" href="/assets/js/98.58af886e.js"><link rel="prefetch" href="/assets/js/99.d137b7f6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.abfd12c2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Oceantime's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/accumulate/" class="nav-link">
  前端基础
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法题库
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/accumulate/" class="nav-link">
  前端基础
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法题库
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>ARTS-week-37</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/2020/ARTS-week-37.html#arts-2019-左耳听风社群活动-每周完成一个-arts" class="sidebar-link">ARTS-2019 左耳听风社群活动--每周完成一个 ARTS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/2020/ARTS-week-37.html#_1-algorithm" class="sidebar-link">1.Algorithm:</a></li><li class="sidebar-sub-header"><a href="/2020/ARTS-week-37.html#_2-review" class="sidebar-link">2.Review:</a></li><li class="sidebar-sub-header"><a href="/2020/ARTS-week-37.html#_3-tip" class="sidebar-link">3.Tip:</a></li><li class="sidebar-sub-header"><a href="/2020/ARTS-week-37.html#_4-share" class="sidebar-link">4.Share:</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="arts-2019-左耳听风社群活动-每周完成一个-arts"><a href="#arts-2019-左耳听风社群活动-每周完成一个-arts" class="header-anchor">#</a> ARTS-2019 左耳听风社群活动--每周完成一个 ARTS</h2> <p>1.Algorithm： 每周至少做一个 leetcode 的算法题
2.Review: 阅读并点评至少一篇英文技术文章
3.Tip: 学习至少一个技术技巧
4.Share: 分享一篇有观点和思考的技术文章</p> <h3 id="_1-algorithm"><a href="#_1-algorithm" class="header-anchor">#</a> 1.Algorithm:</h3> <p>Unique Paths III https://leetcode.com/submissions/detail/344011051/</p> <h3 id="_2-review"><a href="#_2-review" class="header-anchor">#</a> 2.Review:</h3> <p>https://dev.to/lydiahallie/javascript-visualized-hoisting-478h
JavaScript️可视化：声明提升</p> <h4 id="点评："><a href="#点评：" class="header-anchor">#</a> 点评：</h4> <p>有时候会碰到 undefined 或者 ReferenceErrors 错误，而声明提升有可能就是罪魁祸首。声明提升常常被解释为：把变量和函数放到文件的顶部，虽然表面上看起来是这样，但事实却不是如此。Lydia Hallie 从编译、执行两个阶段解释了其特性的工作原理。</p> <h5 id="编译阶段"><a href="#编译阶段" class="header-anchor">#</a> 编译阶段</h5> <p>当 JS 引擎开始解析我们的脚本，第一件事就是为我们代码中的变量 设置内存。这个阶段代码还 没有运行，只是在为后面的代码执行做准备，这个阶段就是 编译阶段。这一阶段的一部分工作就是 找到所有的声明，并用合适的作用域将它们关联起来。而在编译阶段中，函数声明和变量声明存储方式是不同的。</p> <ul><li><p>函数声明的存储方式
函数声明的存储，在内存中存储的是整个函数的引用。（注意 函数声明 和 函数表达式 的区别）</p></li> <li><p>let 和 const 声明的变量的存储方式
变量的存储不太一样。ES6 中引入了两个新的关键字：let 和 const，凡是用这两个关键字定义的变量，存储的值为 uninitialized。</p></li> <li><p>var 声明的变量的存储方式
用 var 声明的变量，存储的时候默认值为 undefined。</p></li></ul> <h5 id="执行阶段"><a href="#执行阶段" class="header-anchor">#</a> 执行阶段</h5> <ul><li><p>提前调用函数
在编译阶段由于 函数声明 存储的是整个函数的引用，所以即使在函数声明之前也可以调用函数。</p></li> <li><p>提前使用 var 定义的变量
如果提前使用 var 定义的个变量，就会打印出 var 关键字定义的默认值 undefined。而大多数情况下，这个行为是令人困惑的，因为并不期望它的值是 undefined。</p></li> <li><p>提前使用 const 和 let 定义的变量
为了解决 var 的问题，所以才会有了 const 和 let，当我们提前访问它们定义的变量的默认值 uninitialized 时，就会抛出 ReferenceError 。这个行为叫：临时死区（Temporal Dead Zone），即不能在这个变量初始化前访问它。</p></li> <li><p>继续执行赋值操作
当 JS 引擎继续往下解释代码时，解释到某一行有赋值语句时，即会将内存中的值覆盖为代码中定义的值。</p></li></ul> <p>总结：
1.函数和变量在 编译阶段 会将声明部分存储在内存中，这就是声明提升。
2.函数声明存储的是整个函数的引用，var 声明的变量存储的默认值是 undefined，let 和 const 声明的变量的默认值为 uninitialized。</p> <h3 id="_3-tip"><a href="#_3-tip" class="header-anchor">#</a> 3.Tip:</h3> <p>Flink On Yarn Cluster 部署</p> <p>1.环境准备</p> <ul><li><p>软件
jdk： jdk-8u111-linux-x64.tar.gz
zookeeper: zookeeper-3.4.10.tar.gz
hadoop: hadoop-2.8.3.tar.gz
flink:
flink-10.0-bin-scala_2.11.tar.gz
flink-shaded-hadoop-2-uber-2.8.3-10.0.jar</p></li> <li><p>主机
192.168.10.1 master
192.168.10.2 segment01
192.168.10.3 segment02</p></li></ul> <p>2.集群规划</p> <table><thead><tr><th style="text-align:center;">主机名</th> <th style="text-align:left;">master</th> <th style="text-align:left;">segment01</th> <th style="text-align:left;">segment02</th></tr></thead> <tbody><tr><td style="text-align:center;">用户名</td> <td style="text-align:left;">flink</td> <td style="text-align:left;">flink</td> <td style="text-align:left;">flink</td></tr> <tr><td style="text-align:center;">用户组</td> <td style="text-align:left;">flink</td> <td style="text-align:left;">flink</td> <td style="text-align:left;">flink</td></tr> <tr><td style="text-align:center;">-</td> <td style="text-align:left;"></td> <td style="text-align:left;"></td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:center;">hdfs</td> <td style="text-align:left;">namenode</td> <td style="text-align:left;">namenode</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:left;">zkfc</td> <td style="text-align:left;">zkfc</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:left;">journalnode</td> <td style="text-align:left;">journalnode</td> <td style="text-align:left;">journalnode</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:left;">datanode</td> <td style="text-align:left;">datanode</td> <td style="text-align:left;">datanode</td></tr> <tr><td style="text-align:center;">-</td> <td style="text-align:left;"></td> <td style="text-align:left;"></td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:center;">yarn</td> <td style="text-align:left;">resourcemanager</td> <td style="text-align:left;"></td> <td style="text-align:left;">resourcemanager</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:left;">nodemanager</td> <td style="text-align:left;">nodemanager</td> <td style="text-align:left;">nodemanager</td></tr> <tr><td style="text-align:center;">-</td> <td style="text-align:left;"></td> <td style="text-align:left;"></td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:center;">zookeeper</td> <td style="text-align:left;">quorumpeermain</td> <td style="text-align:left;">quorumpeermain</td> <td style="text-align:left;">quorumpeermain</td></tr> <tr><td style="text-align:center;">-</td> <td style="text-align:left;"></td> <td style="text-align:left;"></td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:center;">flik</td> <td style="text-align:left;">masters</td> <td style="text-align:left;">masters</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:left;">slaves</td> <td style="text-align:left;">slaves</td> <td style="text-align:left;">slaves</td></tr></tbody></table> <p>3.用户和组</p> <ol><li>用户:flink 组:flink</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># useradd flink</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># passwd flink</span>
Changing password <span class="token keyword">for</span> user flink.
New password: 
BAD PASSWORD: it does not contain enough DIFFERENT characters
BAD PASSWORD: is too simple
Retype new password: 
passwd: all authentication tokens updated successfully.
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># groupadd flink</span>
groupadd: group <span class="token string">'flink'</span> already exists
</code></pre></div><ol start="2"><li>配置 sudoer 权限</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/sudoers</span>

<span class="token comment">## Allow root ro run any commands anywhere</span>
root <span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>ALL<span class="token punctuation">)</span> ALL
flink <span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>ALL<span class="token punctuation">)</span> ALL
</code></pre></div><p>4.SSH 免密登录</p> <ol><li>在要配置互信的机器上，切换到互信用户，生成每台主机各自的公钥和私钥</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>flink@master ~<span class="token punctuation">]</span>$ ssh-keygen -t rsa -P <span class="token string">''</span>
<span class="token punctuation">[</span>flink@master ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> .ssh
<span class="token punctuation">[</span>flink@master ~<span class="token punctuation">]</span>$ <span class="token function">ls</span>
</code></pre></div><ol start="2"><li>将所有的公钥复制汇总到一台主机 (master) 的公钥文件中</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>flink@master ~<span class="token punctuation">]</span>$ <span class="token function">ssh</span> master <span class="token function">cat</span> ~/.ssh/id_rsa.pub <span class="token operator">&gt;&gt;</span> ~/.ssh/authorized_keys
<span class="token punctuation">[</span>flink@master ~<span class="token punctuation">]</span>$ <span class="token function">ssh</span> segment01 <span class="token function">cat</span> ~/.ssh/id_rsa.pub <span class="token operator">&gt;&gt;</span> ~/.ssh/authorized_keys
<span class="token punctuation">[</span>flink@master ~<span class="token punctuation">]</span>$ <span class="token function">ssh</span> segment02 <span class="token function">cat</span> ~/.ssh/id_rsa.pub <span class="token operator">&gt;&gt;</span> ~/.ssh/authorized_keys
<span class="token punctuation">[</span>flink@master ~<span class="token punctuation">]</span>$ <span class="token function">chmod</span> <span class="token number">600</span> ~/.ssh/authorized_keys
</code></pre></div><ol start="3"><li>将汇总的公钥分发到各个主机</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>flink@master ~<span class="token punctuation">]</span>$ <span class="token function">ssh</span> ~/.ssh/authorized_keys segment01:~/.ssh/
<span class="token punctuation">[</span>flink@master ~<span class="token punctuation">]</span>$ <span class="token function">ssh</span> ~/.ssh/authorized_keys segment02:~/.ssh/
</code></pre></div><ol start="4"><li>各个主机验证互相</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>flink@master ~<span class="token punctuation">]</span>$ <span class="token function">ssh</span> master <span class="token function">date</span>
<span class="token punctuation">[</span>flink@master ~<span class="token punctuation">]</span>$ <span class="token function">ssh</span> segment01 <span class="token function">date</span>
<span class="token punctuation">[</span>flink@master ~<span class="token punctuation">]</span>$ <span class="token function">ssh</span> segment02 <span class="token function">date</span>
</code></pre></div><p>5.集群远程分发,同步脚本</p> <p>1）在 flink 目录下创建 bin 目录，并在 bin 目录下创建文件 xsync, xcall.sh</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>flink@master ~<span class="token punctuation">]</span>$ <span class="token function">mkdir</span> bin
<span class="token punctuation">[</span>flink@master ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> bin/
<span class="token punctuation">[</span>flink@master bin<span class="token punctuation">]</span>$ <span class="token function">vim</span> xsync 

<span class="token comment">#!/bin/bash</span>
<span class="token comment">#1 获取输入参数个数，如果没有参数，直接退出</span>
<span class="token assign-left variable">pcount</span><span class="token operator">=</span><span class="token variable">$#</span>
<span class="token keyword">if</span><span class="token variable"><span class="token punctuation">((</span>pcount<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span> <span class="token keyword">then</span>
<span class="token builtin class-name">echo</span> no args<span class="token punctuation">;</span>
<span class="token builtin class-name">exit</span><span class="token punctuation">;</span>
<span class="token keyword">fi</span>

<span class="token comment">#2 获取文件名称</span>
<span class="token assign-left variable">p1</span><span class="token operator">=</span><span class="token variable">$1</span>
<span class="token assign-left variable">fname</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">basename</span> $p1<span class="token variable">`</span></span>
<span class="token builtin class-name">echo</span> <span class="token assign-left variable">fname</span><span class="token operator">=</span><span class="token variable">$fname</span>

<span class="token comment">#3 获取上级目录到绝对路径</span>
<span class="token assign-left variable">pdir</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">cd</span> -P <span class="token punctuation">$(</span>dirname $p1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token builtin class-name">pwd</span><span class="token variable">`</span></span>
<span class="token builtin class-name">echo</span> <span class="token assign-left variable">pdir</span><span class="token operator">=</span><span class="token variable">$pdir</span>

<span class="token comment">#4 获取当前用户名称</span>
<span class="token assign-left variable">user</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">whoami</span><span class="token variable">`</span></span>

<span class="token comment">#5  发送到集群其它主机</span>
    <span class="token builtin class-name">echo</span> ------------------- master --------------
	<span class="token function">rsync</span> -av <span class="token variable">$pdir</span>/<span class="token variable">$fname</span> <span class="token variable">$user</span>@master:<span class="token variable">$pdir</span>
	<span class="token builtin class-name">echo</span> ------------------- segment01 --------------
	<span class="token function">rsync</span> -av <span class="token variable">$pdir</span>/<span class="token variable">$fname</span> <span class="token variable">$user</span>@segment01:<span class="token variable">$pdir</span>
	<span class="token builtin class-name">echo</span> ------------------- segment02 --------------
	<span class="token function">rsync</span> -av <span class="token variable">$pdir</span>/<span class="token variable">$fname</span> <span class="token variable">$user</span>@segment02:<span class="token variable">$pdir</span>


<span class="token punctuation">[</span>flink@master bin<span class="token punctuation">]</span>$ <span class="token function">vim</span> xcall.sh

<span class="token comment">#! /bin/bash</span>

<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> master segment01 segment02
<span class="token keyword">do</span>
        <span class="token builtin class-name">echo</span> --------- <span class="token variable">$i</span> ----------
        <span class="token function">ssh</span> <span class="token variable">$i</span> <span class="token string">&quot;<span class="token variable">$*</span>&quot;</span>
<span class="token keyword">done</span>
</code></pre></div><p>2）修改脚本 xsync ,xcall.sh 具有执行权限</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>flink@master bin<span class="token punctuation">]</span>$ <span class="token function">chmod</span> <span class="token number">777</span> xsync
<span class="token punctuation">[</span>flink@master bin<span class="token punctuation">]</span>$ <span class="token function">chmod</span> <span class="token number">777</span> xcall.sh 
</code></pre></div><ol start="3"><li>将脚本放到 /usr/local/bin 目录下</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>flink@master bin<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">cp</span> xcall.sh /usr/local/bin/
<span class="token punctuation">[</span>flink@master bin<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">cp</span> xsync /usr/local/bin/
</code></pre></div><ol start="4"><li>将脚本同步到其它节点</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>flink@master ~<span class="token punctuation">]</span>$ <span class="token function">su</span> root
<span class="token punctuation">[</span>root@master flink<span class="token punctuation">]</span><span class="token comment"># cd /usr/local/</span>
<span class="token punctuation">[</span>root@master local<span class="token punctuation">]</span><span class="token comment"># xsync bin/</span>

<span class="token assign-left variable">fname</span><span class="token operator">=</span>bin
<span class="token assign-left variable">pdir</span><span class="token operator">=</span>/usr/local
------------------- master --------------
sending incremental <span class="token function">file</span> list

sent <span class="token number">73</span> bytes  received <span class="token number">13</span> bytes  <span class="token number">172.00</span> bytes/sec
total size is <span class="token number">765</span>  speedup is <span class="token number">8.90</span>
------------------- segment01 --------------
sending incremental <span class="token function">file</span> list
bin/
bin/xcall.sh
bin/xsync

sent <span class="token number">927</span> bytes  received <span class="token number">54</span> bytes  <span class="token number">1962.00</span> bytes/sec
total size is <span class="token number">765</span>  speedup is <span class="token number">0.78</span>
------------------- segment02 --------------
sending incremental <span class="token function">file</span> list
bin/
bin/xcall.sh
bin/xsync

sent <span class="token number">927</span> bytes  received <span class="token number">54</span> bytes  <span class="token number">1962.00</span> bytes/sec
total size is <span class="token number">765</span>  speedup is <span class="token number">0.78</span>
</code></pre></div><p>6.安装 JDK</p> <p>1）/opt目录下创建 module 和 software 文件夹，在三台机器上修改 /opt 用户:用户组</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># chown flink:flink /opt/</span>
<span class="token punctuation">[</span>flink@master opt<span class="token punctuation">]</span>$ <span class="token function">mkdir</span> module
<span class="token punctuation">[</span>flink@master opt<span class="token punctuation">]</span>$ <span class="token function">mkdir</span> software
</code></pre></div><ol start="2"><li>所需软件导入到 master 的 /opt/software 目录下</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>flink@master software<span class="token punctuation">]</span>$ <span class="token function">ls</span>
jdk-8u111-linux-x64.tar.gz
zookeeper-3.4.10.tar.gz
hadoop-2.8.3.tar.gz 
flink-10.0-bin-scala_2.11.tar.gz
flink-shaded-hadoop-2-uber-2.8.3-10.0.jar
</code></pre></div><p>3）解压 JDK 到 /opt/module 目录下</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>flink@master software<span class="token punctuation">]</span>$ <span class="token function">tar</span> -xzvf jdk-8u111-linux-x64.tar.gz -C /opt/module/
</code></pre></div><p>4）配置JDK环境变量，在profile文件末尾添加JDK路径，修改后立即生效</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master module<span class="token punctuation">]</span><span class="token comment"># vi /etc/profile</span>

<span class="token comment">#JAVA_HOME</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/opt/module/jdk1.8.0_111
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">${JAVA_HOME}</span>/bin:<span class="token variable">${<span class="token environment constant">PATH</span>}</span>

<span class="token punctuation">[</span>root@master module<span class="token punctuation">]</span><span class="token comment"># source /etc/profile</span>
</code></pre></div><ol start="5"><li>测试JDK是否安装成功</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master module<span class="token punctuation">]</span><span class="token comment"># java -version</span>
java version <span class="token string">&quot;1.8.0_111&quot;</span>
</code></pre></div><p>6）将 master 中的 JDK 和环境变量分发到 segment01、segment02 两台主机</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master module<span class="token punctuation">]</span><span class="token comment"># xsync /etc/profile</span>
<span class="token punctuation">[</span>flink@master opt<span class="token punctuation">]</span>$ xsync module/
<span class="token punctuation">[</span>flink@segment01 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">source</span> /etc/profile
<span class="token punctuation">[</span>flink@segment02 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">source</span> /etc/profile
</code></pre></div><ol start="7"><li>xcall.sh 脚本关于 jps 命令，因为 jps 并非是 shell 中的自有命令，分别在三台主机中, 添加软链接</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>flink@master bin<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">ln</span> -s /opt/module/jdk1.8.0_241/bin/jps /usr/local/bin/jps

<span class="token punctuation">[</span>flink@master ~<span class="token punctuation">]</span>$ xcall.sh jps
--------- master ----------
<span class="token number">4062</span> Jps
--------- segment01 ----------
<span class="token number">5092</span> Jps
--------- segment02 ----------
<span class="token number">4611</span> Jps
</code></pre></div><p>7.安装zookeeper</p> <ol><li>解压</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>flink@master software<span class="token punctuation">]</span>$ <span class="token function">tar</span> -xzvf zookeeper-3.4.10.tar.gz -C /opt/module/
</code></pre></div><ol start="2"><li>三个节点配置环境变量</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>flink@master module<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">vim</span> /etc/profile
<span class="token comment">#ZOOKEEPER_HOME</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ZOOKEEPER_HOME</span><span class="token operator">=</span>/opt/module/zookeeper-3.4.10
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$ZOOKEEPER_HOME</span>/bin

<span class="token punctuation">[</span>flink@master module<span class="token punctuation">]</span>$ <span class="token builtin class-name">source</span> /etc/profile
</code></pre></div><ol start="3"><li>修改zoo.cfg文件</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>flink@master conf<span class="token punctuation">]</span>$ <span class="token function">mv</span> zoo_sample.cfg zoo.cfg
<span class="token punctuation">[</span>flink@master conf<span class="token punctuation">]</span>$ <span class="token function">vim</span> zoo.cfg 
<span class="token comment"># The number of milliseconds of each tick</span>
<span class="token assign-left variable">tickTime</span><span class="token operator">=</span><span class="token number">2000</span>
<span class="token comment"># The number of ticks that the initial </span>
<span class="token comment"># synchronization phase can take</span>
<span class="token assign-left variable">initLimit</span><span class="token operator">=</span><span class="token number">10</span>
<span class="token comment"># The number of milliseconds of each tick</span>
<span class="token assign-left variable">tickTime</span><span class="token operator">=</span><span class="token number">2000</span>
<span class="token comment"># The number of ticks that the initial </span>
<span class="token comment"># synchronization phase can take</span>
<span class="token assign-left variable">initLimit</span><span class="token operator">=</span><span class="token number">10</span>
<span class="token comment"># The number of ticks that can pass between </span>
<span class="token comment"># sending a request and getting an acknowledgement</span>
<span class="token assign-left variable">syncLimit</span><span class="token operator">=</span><span class="token number">5</span>
<span class="token comment"># the directory where the snapshot is stored.</span>
<span class="token comment"># do not use /tmp for storage, /tmp here is just </span>
<span class="token comment"># example sakes.</span>
<span class="token assign-left variable">dataDir</span><span class="token operator">=</span>/home/flink/data/zookeeperdata
<span class="token comment"># the port at which the clients will connect</span>
<span class="token assign-left variable">clientPort</span><span class="token operator">=</span><span class="token number">2181</span>
<span class="token comment"># the maximum number of client connections.</span>
<span class="token comment"># increase this if you need to handle more clients</span>
<span class="token comment">#maxClientCnxns=60</span>
<span class="token comment">#</span>
<span class="token comment"># Be sure to read the maintenance section of the </span>
<span class="token comment"># administrator guide before turning on autopurge.</span>
<span class="token comment">#</span>
<span class="token comment"># http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance</span>
<span class="token comment">#</span>
<span class="token comment"># The number of snapshots to retain in dataDir</span>
<span class="token comment">#autopurge.snapRetainCount=3</span>
<span class="token comment"># Purge task interval in hours</span>
<span class="token comment"># Set to &quot;0&quot; to disable auto purge feature</span>
<span class="token comment">#autopurge.purgeInterval=1</span>
server.1<span class="token operator">=</span>master:2888:3888
server.2<span class="token operator">=</span>segment01:2888:3888
server.3<span class="token operator">=</span>segment02:2888:3888
</code></pre></div><ol start="4"><li>在三个节点上创建 myid 文件 /home/flink/data/zookeeperdata 目录下创建
master    -----1
segment01 -----2
segment02 -----3</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>flink@master zookeeperdata<span class="token punctuation">]</span>$ <span class="token builtin class-name">pwd</span>
/home/flink/data/zookeeperdata
<span class="token punctuation">[</span>flink@master zookeeperdata<span class="token punctuation">]</span>$ <span class="token function">vim</span> myid
<span class="token number">1</span>
</code></pre></div><ol start="5"><li>同步 zookeeper</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>flink@master module<span class="token punctuation">]</span>$ xsync zookeeper-3.4.10/
</code></pre></div><ol start="6"><li>启动</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>flink@master module<span class="token punctuation">]</span>$ zkServer.sh
</code></pre></div><ol start="7"><li>验证</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>flink@master module<span class="token punctuation">]</span>$ xcall.sh jps
--------- master ----------
<span class="token number">5221</span> Jps
<span class="token number">6301</span> QuorumPeerMain
--------- segment01 ----------
<span class="token number">5092</span> Jps
<span class="token number">6411</span> QuorumPeerMain
--------- segment02 ----------
<span class="token number">5611</span> Jps
<span class="token number">6903</span> QuorumPeerMain
</code></pre></div><p>8.部署 hadoop HA 集群</p> <ol><li>解压</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>flink@master software<span class="token punctuation">]</span>$ <span class="token function">tar</span> -xzvf hadoop-2.8.3.tar.gz -C /opt/module/
</code></pre></div><ol start="2"><li>配置环境变量</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>flink@master module<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">vim</span> /etc/profile
<span class="token comment">##HADOOP_HOME</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_HOME</span><span class="token operator">=</span>/opt/module/hadoop-2.8.3
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$HADOOP_HOME</span>/bin
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$HADOOP_HOME</span>/sbin

<span class="token punctuation">[</span>flink@master module<span class="token punctuation">]</span>$ <span class="token builtin class-name">source</span> /etc/profile
</code></pre></div><ol start="3"><li>修改配置文件
hadoop-env.sh
core-site.xml
hdfs-site.xml
mapred-site.xml
yarn-site.xml
slaves</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>flink@master module<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> hadoop-2.8.3/etc/hadoop/
<span class="token punctuation">[</span>flink@master hadoop<span class="token punctuation">]</span>$ <span class="token function">vim</span> hadoop-env.sh 
<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/opt/module/jdk1.8.0_111

<span class="token punctuation">[</span>flink@master hadoop<span class="token punctuation">]</span>$ <span class="token function">vim</span> core-site.xml 
<span class="token operator">&lt;</span>configuration<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>-- 指定 hdfs 的 访问入口 namenode访问入口 完全分布式 hdfs://master:9000 
          高可用中两个namenode 这里配置的是两个namenode nameservice 组名  yantian hdfs://yantian--<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>fs.defaultFS<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>hdfs://yantian/<span class="token operator">&lt;</span>/value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span>-- 指定 hadoop 数据存储目录 --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>hadoop.tmp.dir<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>/home/flink/data/hadoopdata/<span class="token operator">&lt;</span>/value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span>-- 指定 zookeeper 集群访问地址 --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>ha.zookeeper.quorum<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>master:2181,segment01:2181,segment02:218<span class="token operator"><span class="token file-descriptor important">1</span>&lt;</span>/value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/configuration<span class="token operator">&gt;</span>

<span class="token punctuation">[</span>flink@master hadoop<span class="token punctuation">]</span>$ <span class="token function">vim</span> hdfs-site.xml 
<span class="token operator">&lt;</span>configuration<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>-- 指定副本数 --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs.replication<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token operator"><span class="token file-descriptor important">2</span>&lt;</span>/value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span>--指定 hdfs 的 nameservice 为 yantian，需要和 core-site.xml 中保持一致--<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs.nameservices<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>yantian<span class="token operator">&lt;</span>/value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span>-- yantian 下面有两个 NameNode，分别是 nn1，nn2 --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs.ha.namenodes.yantian<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>nn1,nn<span class="token operator"><span class="token file-descriptor important">2</span>&lt;</span>/value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span>-- nn1 的 RPC 通信地址 --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs.namenode.rpc-address.yantian.nn<span class="token operator"><span class="token file-descriptor important">1</span>&lt;</span>/name<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>master:802<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>/value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span>-- nn1 的 http 通信地址 --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs.namenode.http-address.yantian.nn<span class="token operator"><span class="token file-descriptor important">1</span>&lt;</span>/name<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>master:5007<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>/value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span>-- nn2 的 RPC 通信地址 --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs.namenode.rpc-address.yantian.nn<span class="token operator"><span class="token file-descriptor important">2</span>&lt;</span>/name<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>segment01:802<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>/value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span>-- nn2 的 http 通信地址 --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs.namenode.http-address.yantian.nn<span class="token operator"><span class="token file-descriptor important">2</span>&lt;</span>/name<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>segment01:5007<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>/value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span>-- 指定 NameNode 的 edits 元数据在 JournalNode 上的存放位置 QJM --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs.namenode.shared.edits.dir<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>qjournal://master:8485<span class="token punctuation">;</span>segment01:8485<span class="token punctuation">;</span>segment02:8485/yantian<span class="token operator">&lt;</span>/value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span>-- 指定 JournalNode 在本地磁盘存放数据的位置 --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs.journalnode.edits.dir<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>/home/flink/data/hadoopdata/journaldata<span class="token operator">&lt;</span>/value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span>-- 开启 NameNode 失败自动切换 --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs.ha.automatic-failover.enabled<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>true<span class="token operator">&lt;</span>/value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span>-- 配置失败自动切换实现方式 --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>-- 此处配置在安装的时候切记检查不要换行--<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs.client.failover.proxy.provider.yantian<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider<span class="token operator">&lt;</span>/value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span>-- 配置隔离机制方法，多个机制用换行分割，即每个机制暂用一行--<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs.ha.fencing.methods<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>
 sshfence
 shell<span class="token punctuation">(</span>/bin/true<span class="token punctuation">)</span>
 <span class="token operator">&lt;</span>/value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span>-- 使用 sshfence 隔离机制时需要 <span class="token function">ssh</span> 免登陆 --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs.ha.fencing.ssh.private-key-files<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>/home/flink/.ssh/id_rsa<span class="token operator">&lt;</span>/value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span>-- 配置 sshfence 隔离机制超时时间 --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs.ha.fencing.ssh.connect-timeout<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">3000</span><span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>/value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/configuration<span class="token operator">&gt;</span>

<span class="token punctuation">[</span>flink@master hadoop<span class="token punctuation">]</span>$ <span class="token function">mv</span> mapred-site.xml.template mapred-site.xml
<span class="token punctuation">[</span>flink@master hadoop<span class="token punctuation">]</span>$ <span class="token function">vim</span> mapred-site.xml 
<span class="token operator">&lt;</span>configuration<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>-- 指定 mr 框架为 <span class="token function">yarn</span> 方式 --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>mapreduce.framework.name<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>yarn<span class="token operator">&lt;</span>/value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span>-- 设置 mapreduce 的历史服务器地址和端口号 --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>mapreduce.jobhistory.address<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>segment01:1002<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>/value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>-- mapreduce 历史服务器的 web 访问地址 --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>mapreduce.jobhistory.webapp.address<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>segment01:1988<span class="token operator"><span class="token file-descriptor important">8</span>&lt;</span>/value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/configuration<span class="token operator">&gt;</span>

<span class="token punctuation">[</span>flink@master hadoop<span class="token punctuation">]</span>$ <span class="token function">vim</span> yarn-site.xml 
<span class="token operator">&lt;</span>configuration<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span>-- Site specific YARN configuration properties --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>-- Site specific YARN configuration properties --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>-- 开启 RM 高可用 --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn.resourcemanager.ha.enabled<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>true<span class="token operator">&lt;</span>/value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>-- 指定 RM 的 cluster <span class="token function">id</span> --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn.resourcemanager.cluster-id<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>yarn_yantian<span class="token operator">&lt;</span>/value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>-- 指定 RM 的名字 --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn.resourcemanager.ha.rm-ids<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>rm1,rm<span class="token operator"><span class="token file-descriptor important">2</span>&lt;</span>/value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span>-- 分别指定 RM 的地址 --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn.resourcemanager.hostname.rm<span class="token operator"><span class="token file-descriptor important">1</span>&lt;</span>/name<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>master<span class="token operator">&lt;</span>/value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn.resourcemanager.hostname.rm<span class="token operator"><span class="token file-descriptor important">2</span>&lt;</span>/name<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>segment0<span class="token operator"><span class="token file-descriptor important">2</span>&lt;</span>/value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>-- 指定 zk 集群地址 --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn.resourcemanager.zk-address<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>master:2181,segment01:2181,segment02:218<span class="token operator"><span class="token file-descriptor important">1</span>&lt;</span>/value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span>-- 要运行 MapReduce 程序必须配置的附属服务 --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn.nodemanager.aux-services<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>mapreduce_shuffle<span class="token operator">&lt;</span>/value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span>-- 开启 YARN 集群的日志聚合功能 --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn.log-aggregation-enable<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>true<span class="token operator">&lt;</span>/value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span>-- YARN 集群的聚合日志最长保留时长 --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn.log-aggregation.retain-seconds<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">8640</span><span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>/value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span>-- 启用自动恢复 --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn.resourcemanager.recovery.enabled<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>true<span class="token operator">&lt;</span>/value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn.nodemanager.pmem-check-enabled<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>false<span class="token operator">&lt;</span>/value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn.nodemanager.vmem-check-enabled<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>false<span class="token operator">&lt;</span>/value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>-- 制定 resourcemanager 的状态信息存储在 zookeeper 集群上--<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn.resourcemanager.store.class<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>org.apache.hadoop.yarn.server.resourcemanager.recovery.ZKRMStateStore<span class="token operator">&lt;</span>/value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn.resourcemanager.am.max-attempts<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token operator"><span class="token file-descriptor important">4</span>&lt;</span>/value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>The maximum number of application master execution attempts.<span class="token operator">&lt;</span>/description<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>/configuration<span class="token operator">&gt;</span>

<span class="token punctuation">[</span>flink@master hadoop<span class="token punctuation">]</span>$ <span class="token function">vim</span> slaves 
master
segment01
segment02
</code></pre></div><ol start="4"><li>同步文件</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>flink@master module<span class="token punctuation">]</span>$ xsync hadoop-2.8.3/
<span class="token punctuation">[</span>flink@master module<span class="token punctuation">]</span>$ <span class="token builtin class-name">source</span> /etc/profile
<span class="token punctuation">[</span>flink@master module<span class="token punctuation">]</span>$ hadoop version
Hadoop <span class="token number">2.8</span>.3
</code></pre></div><ol start="5"><li>初始化步骤按照顺序执行</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token number">1</span>.三台节点启动 zk
<span class="token punctuation">[</span>flink@master module<span class="token punctuation">]</span>$ zkServer.sh start
<span class="token punctuation">[</span>flink@segment01 module<span class="token punctuation">]</span>$ zkServer.sh start
<span class="token punctuation">[</span>flink@segment02 module<span class="token punctuation">]</span>$ zkServer.sh start

<span class="token number">2</span>.启动 journalnode QJM, <span class="token number">3</span>台分别启动
<span class="token punctuation">[</span>flink@master module<span class="token punctuation">]</span>$ hadoop-daemon.sh start journalnode
<span class="token punctuation">[</span>flink@segment01 module<span class="token punctuation">]</span>$ hadoop-daemon.sh start journalnode
<span class="token punctuation">[</span>flink@segment02 module<span class="token punctuation">]</span>$ hadoop-daemon.sh start journalnode

<span class="token number">3</span>.格式化 namenode 选择一个 namenode 节点 <span class="token punctuation">(</span>master<span class="token punctuation">)</span> 节点
<span class="token punctuation">[</span>flink@master module<span class="token punctuation">]</span>$ hadoop namenode -format
成功: has been successfully formatted.

<span class="token number">4</span>.将 master 的元数据 远程发送到 segment01 另一个 namenode
<span class="token punctuation">[</span>flink@master module<span class="token punctuation">]</span>$ <span class="token function">scp</span> -r /home/flink/data/hadoopdata/dfs/ segment01:/home/flink/data/hadoopdata/

<span class="token number">5</span>.格式化 zkfc 和 zookeeper 通信,在 zookeeper 中创建存储 namenode 状态信息的 znode, 在一个namenode上执行即可
<span class="token punctuation">[</span>flink@master module<span class="token punctuation">]</span>$ hdfs zkfc -formatZK
Successfully created /hadoop-ha/yantian <span class="token keyword">in</span> ZK
</code></pre></div><ol start="6"><li>启动集群顺序</li></ol> <table><thead><tr><th style="text-align:center;">主机名</th> <th style="text-align:left;">master</th> <th style="text-align:left;">segment01</th> <th style="text-align:left;">segment02</th></tr></thead> <tbody><tr><td style="text-align:center;">关闭防火墙</td> <td style="text-align:left;">systemctl stop firewalld.service</td> <td style="text-align:left;">查看防火墙</td> <td style="text-align:left;">firewall-cmd --state</td></tr> <tr><td style="text-align:center;">启动 zookeeper</td> <td style="text-align:left;">zkServer.sh start</td> <td style="text-align:left;">zkServer.sh start</td> <td style="text-align:left;">zkServer.sh start</td></tr> <tr><td style="text-align:center;">启动 hdfs</td> <td style="text-align:left;">start-dfs.sh 任意节点</td> <td style="text-align:left;"></td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:center;">启动 yarn</td> <td style="text-align:left;">start-yarn.sh 任意节点</td> <td style="text-align:left;"></td> <td style="text-align:left;"></td></tr></tbody></table> <ol start="7"><li>验证</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>flink@master hadoopdata<span class="token punctuation">]</span>$ xcall.sh jps
--------- master ----------
<span class="token number">7840</span> Jps
<span class="token number">7346</span> ResourceManager
<span class="token number">7459</span> NodeManager
<span class="token number">6788</span> DataNode
<span class="token number">6666</span> NameNode
<span class="token number">7018</span> JournalNode
<span class="token number">7228</span> DFSZKFailoverController
<span class="token number">6301</span> QuorumPeerMain
--------- segment01 ----------
<span class="token number">6180</span> Jps
<span class="token number">5748</span> JournalNode
<span class="token number">6411</span> QuorumPeerMain
<span class="token number">5638</span> DataNode
<span class="token number">5978</span> NodeManager
<span class="token number">5884</span> DFSZKFailoverController
<span class="token number">5550</span> NameNode
--------- segment02 ----------
<span class="token number">5760</span> NodeManager
<span class="token number">6903</span> QuorumPeerMain
<span class="token number">5844</span> ResourceManager
<span class="token number">5654</span> JournalNode
<span class="token number">6024</span> Jps
<span class="token number">5544</span> DataNode
</code></pre></div><p>9.部署 Flink on yarn 集群</p> <ol><li>解压</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>flink@master software<span class="token punctuation">]</span>$ <span class="token function">tar</span> -xzvf flink-1.10.0-bin-scala_2.11.tgz -C /opt/module/
</code></pre></div><ol start="2"><li>添加 hadoop 的依赖 jar 包到 lib 目录下</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>flink@master software<span class="token punctuation">]</span>$ <span class="token function">cp</span> flink-shaded-hadoop-2-uber-2.8.3-10.0.jar /opt/module/flink-1.10.0/lib/
</code></pre></div><ol start="3"><li>配置环境变量</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>flink@master lib<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">vim</span> /etc/profile
<span class="token comment">#FLINK_HOME</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">FLINK_HOME</span><span class="token operator">=</span>/opt/module/flink-1.10.0
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$FLINK_HOME</span>/bin
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_CONF_DIR</span><span class="token operator">=</span>/opt/module/hadoop-2.8.3/etc/hadoop

<span class="token punctuation">[</span>flink@master lib<span class="token punctuation">]</span>$ <span class="token builtin class-name">source</span> /etc/profile
</code></pre></div><ol start="4"><li>配置文件</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>flink@master conf<span class="token punctuation">]</span>$ <span class="token function">vim</span> flink-conf.yaml 

<span class="token comment">################################################################################</span>
<span class="token comment">#  Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="token comment">#  or more contributor license agreements.  See the NOTICE file</span>
<span class="token comment">#  distributed with this work for additional information</span>
<span class="token comment">#  regarding copyright ownership.  The ASF licenses this file</span>
<span class="token comment">#  to you under the Apache License, Version 2.0 (the</span>
<span class="token comment">#  &quot;License&quot;); you may not use this file except in compliance</span>
<span class="token comment">#  with the License.  You may obtain a copy of the License at</span>
<span class="token comment">#</span>
<span class="token comment">#      http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="token comment">#</span>
<span class="token comment">#  Unless required by applicable law or agreed to in writing, software</span>
<span class="token comment">#  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="token comment">#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="token comment">#  See the License for the specific language governing permissions and</span>
<span class="token comment"># limitations under the License.</span>
<span class="token comment">################################################################################</span>


<span class="token comment">#==============================================================================</span>
<span class="token comment"># Common</span>
<span class="token comment">#==============================================================================</span>

<span class="token comment"># The external address of the host on which the JobManager runs and can be</span>
<span class="token comment"># by specifying the --host &lt;hostname&gt; parameter of the bin/jobmanager.sh executable.</span>
<span class="token comment"># In high availability mode, if you use the bin/start-cluster.sh script and setup</span>
<span class="token comment"># the conf/masters file, this will be taken care of automatically. Yarn/Mesos</span>

jobmanager.rpc.address: master

<span class="token comment"># The RPC port where the JobManager is reachable.</span>

jobmanager.rpc.port: <span class="token number">6123</span>


<span class="token comment"># The heap size for the JobManager JVM</span>

jobmanager.heap.size: 1024m


<span class="token comment"># The total process memory size for the TaskManager.</span>
<span class="token comment">#</span>

taskmanager.memory.process.size: 1568m

<span class="token comment"># It is not recommended to set both 'taskmanager.memory.process.size' and Flink memory.</span>
<span class="token comment">#</span>
<span class="token comment"># taskmanager.memory.flink.size: 1280m</span>

<span class="token comment"># The number of task slots that each TaskManager offers. Each slot runs one parallel pipeline.</span>

taskmanager.numberOfTaskSlots: <span class="token number">1</span>

<span class="token comment"># The parallelism used for programs that did not specify and other parallelism.</span>

parallelism.default: <span class="token number">1</span>

<span class="token comment"># The default file system scheme and authority.</span>
<span class="token comment"># </span>
<span class="token comment"># By default file paths without scheme are interpreted relative to the local</span>
<span class="token comment"># root file system 'file:///'. Use this to override the default and interpret</span>
<span class="token comment"># relative paths relative to a different file system,</span>
<span class="token comment"># for example 'hdfs://mynamenode:12345'</span>
<span class="token comment">#</span>
<span class="token comment"># fs.default-scheme</span>

<span class="token comment">#==============================================================================</span>
<span class="token comment"># High Availability</span>
<span class="token comment"># The high-availability mode. Possible options are 'NONE' or 'zookeeper'.</span>
<span class="token comment">#</span>
high-availability: zookeeper

<span class="token comment"># The path where metadata for master recovery is persisted. While ZooKeeper stores</span>
<span class="token comment"># the small ground truth for checkpoint and leader election, this location stores</span>
<span class="token comment"># the larger objects, like persisted dataflow graphs.</span>
<span class="token comment"># </span>
<span class="token comment"># Must be a durable file system that is accessible from all nodes</span>
<span class="token comment"># (like HDFS, S3, Ceph, nfs, ...) </span>
<span class="token comment">#</span>
high-availability.storageDir: hdfs://yantian/flink/recovery

<span class="token comment"># The list of ZooKeeper quorum peers that coordinate the high-availability</span>
<span class="token comment"># setup. This must be a list of the form:</span>
<span class="token comment"># &quot;host1:clientPort,host2:clientPort,...&quot; (default clientPort: 2181)</span>
<span class="token comment">#</span>
high-availability.zookeeper.quorum: master:2181,segment01:2181,segment02:2181


<span class="token comment"># It can be either &quot;creator&quot; (ZOO_CREATE_ALL_ACL) or &quot;open&quot; (ZOO_OPEN_ACL_UNSAFE)</span>
<span class="token comment"># The default value is &quot;open&quot; and it can be changed to &quot;creator&quot; if ZK security is enabled</span>
<span class="token comment">#</span>
<span class="token comment"># high-availability.zookeeper.client.acl: open</span>
high-availability.zookeeper.path.root: /flink
<span class="token comment">#==============================================================================</span>
<span class="token comment"># Fault tolerance and checkpointing</span>
<span class="token comment">#==============================================================================</span>

<span class="token comment"># The backend that will be used to store operator state checkpoints if</span>
<span class="token comment"># checkpointing is enabled.</span>
<span class="token comment"># &lt;class-name-of-factory&gt;.</span>
<span class="token comment">#</span>
<span class="token comment"># state.backend: filesystem</span>

<span class="token comment"># Directory for checkpoints filesystem, when using any of the default bundled</span>
<span class="token comment"># state backends.</span>
<span class="token comment">#</span>
state.checkpoints.dir:  hdfs://yantian/flink/checkpoints

<span class="token comment"># Default target directory for savepoints, optional.</span>
<span class="token comment">#</span>
state.savepoints.dir: hdfs://yantian/flink/savepoints

<span class="token comment"># Flag to enable/disable incremental checkpoints for backends that</span>
<span class="token comment"># support incremental checkpoints (like the RocksDB state backend). </span>
<span class="token comment">#</span>
<span class="token comment"># state.backend.incremental: false</span>

<span class="token comment"># The failover strategy, i.e., how the job computation recovers from task failures.</span>
<span class="token comment"># Only restart tasks that may have been affected by the task failure, which typically includes</span>

jobmanager.execution.failover-strategy: region

<span class="token comment">#==============================================================================</span>
<span class="token comment"># Rest &amp; web frontend</span>
<span class="token comment">#==============================================================================</span>

<span class="token comment"># The port to which the REST client connects to. If rest.bind-port has</span>
<span class="token comment"># not been specified, then the server will bind to this port as well.</span>
<span class="token comment">#</span>
<span class="token comment">#rest.port: 8081</span>

<span class="token comment"># The address to which the REST client will connect to</span>
<span class="token comment">#</span>
<span class="token comment">#rest.address: 0.0.0.0</span>

<span class="token comment"># Port range for the REST and web server to bind to.</span>
<span class="token comment">#</span>
<span class="token comment">#rest.bind-port: 8080-8090</span>

<span class="token comment"># The address that the REST &amp; web server binds to</span>
<span class="token comment">#</span>
<span class="token comment">#rest.bind-address: 0.0.0.0</span>

<span class="token comment"># Flag to specify whether job submission is enabled from the web-based</span>
<span class="token comment"># runtime monitor. Uncomment to disable.</span>

<span class="token comment">#web.submit.enable: false</span>

<span class="token comment">#==============================================================================</span>
<span class="token comment"># Advanced</span>
<span class="token comment">#==============================================================================</span>

<span class="token comment"># Override the directories for temporary files. If not specified, the</span>
<span class="token comment"># system-specific Java temporary directory (java.io.tmpdir property) is taken.</span>
<span class="token comment">#</span>
<span class="token comment"># For framework setups on Yarn or Mesos, Flink will automatically pick up the</span>
<span class="token comment"># containers' temp directories without any need for configuration.</span>
<span class="token comment">#</span>
<span class="token comment"># Add a delimited list for multiple directories, using the system directory</span>
<span class="token comment"># delimiter (colon ':' on unix) or a comma, e.g.:</span>
<span class="token comment">#     /data1/tmp:/data2/tmp:/data3/tmp</span>
<span class="token comment">#</span>
<span class="token comment"># Note: Each directory entry is read from and written to by a different I/O</span>
<span class="token comment"># thread. You can include the same directory multiple times in order to create</span>
<span class="token comment"># multiple I/O threads against that directory. This is for example relevant for</span>
<span class="token comment"># high-throughput RAIDs.</span>
<span class="token comment">#</span>
<span class="token comment"># io.tmp.dirs: /tmp</span>
<span class="token comment">#需要手动创建,否则启动不了集群</span>
io.tmp.dirs: /home/flink/data/flinkdata/tmp
env.log.dir: /home/flink/data/flinkdata/logs

<span class="token comment"># The classloading resolve order. Possible values are 'child-first' (Flink's default)</span>
<span class="token comment"># and 'parent-first' (Java's default).</span>
<span class="token comment">#</span>
<span class="token comment"># Child first classloading allows users to use different dependency/library</span>
<span class="token comment"># versions in their application than those in the classpath. Switching back</span>
<span class="token comment"># to 'parent-first' may help with debugging dependency issues.</span>
<span class="token comment">#</span>
<span class="token comment"># classloader.resolve-order: child-first</span>

<span class="token comment"># The amount of memory going to the network stack. These numbers usually need </span>
<span class="token comment"># no tuning. Adjusting them may be necessary in case of an &quot;Insufficient number</span>
<span class="token comment"># of network buffers&quot; error. The default min is 64MB, the default max is 1GB.</span>
<span class="token comment"># </span>
<span class="token comment"># taskmanager.memory.network.fraction: 0.1</span>
<span class="token comment"># taskmanager.memory.network.min: 64mb</span>
<span class="token comment"># taskmanager.memory.network.max: 1gb</span>

<span class="token comment">#==============================================================================</span>
<span class="token comment"># Flink Cluster Security Configuration</span>
<span class="token comment">#==============================================================================</span>

<span class="token comment"># Kerberos authentication for various components - Hadoop, ZooKeeper, and connectors -</span>
<span class="token comment"># may be enabled in four steps:</span>
<span class="token comment"># 1. configure the local krb5.conf file</span>
<span class="token comment"># 2. provide Kerberos credentials (either a keytab or a ticket cache w/ kinit)</span>
<span class="token comment"># 3. make the credentials available to various JAAS login contexts</span>
<span class="token comment"># 4. configure the connector to use JAAS/SASL</span>

<span class="token comment"># The below configure how Kerberos credentials are provided. A keytab will be used instead of</span>
<span class="token comment"># a ticket cache if the keytab path and principal are set.</span>

<span class="token comment"># security.kerberos.login.use-ticket-cache: true</span>
<span class="token comment"># security.kerberos.login.keytab: /path/to/kerberos/keytab</span>
<span class="token comment"># security.kerberos.login.principal: flink-user</span>

<span class="token comment"># The configuration below defines which JAAS login contexts</span>

<span class="token comment"># security.kerberos.login.contexts: Client,KafkaClient</span>

<span class="token comment">#==============================================================================</span>
<span class="token comment"># ZK Security Configuration</span>
<span class="token comment">#==============================================================================</span>

<span class="token comment"># Below configurations are applicable if ZK ensemble is configured for security</span>

<span class="token comment"># Override below configuration to provide custom ZK service name if configured</span>
<span class="token comment"># zookeeper.sasl.service-name: zookeeper</span>

<span class="token comment"># The configuration below must match one of the values set in &quot;security.kerberos.login.contexts&quot;</span>
<span class="token comment"># zookeeper.sasl.login-context-name: Client</span>

<span class="token comment">#==============================================================================</span>
<span class="token comment"># HistoryServer</span>
<span class="token comment">#==============================================================================</span>

<span class="token comment"># The HistoryServer is started and stopped via bin/historyserver.sh (start|stop)</span>

<span class="token comment"># Directory to upload completed jobs to. Add this directory to the list of</span>
<span class="token comment"># monitored directories of the HistoryServer as well (see below).</span>
jobmanager.archive.fs.dir: hdfs://yantian/flink/completed_jobs/

<span class="token comment"># The address under which the web-based HistoryServer listens.</span>
historyserver.web.address: <span class="token number">0.0</span>.0.0

<span class="token comment"># The port under which the web-based HistoryServer listens.</span>
historyserver.web.port: <span class="token number">8082</span>

<span class="token comment"># Comma separated list of directories to monitor for completed jobs.</span>
historyserver.archive.fs.dir: hdfs://yantian/flink/completed_jobs/

<span class="token comment"># Interval in milliseconds for refreshing the monitored directories.</span>
historyserver.archive.fs.refresh-interval: <span class="token number">10000</span>

<span class="token punctuation">[</span>flink@master conf<span class="token punctuation">]</span>$ <span class="token function">vim</span> masters 
master:8081
segment01:8081

<span class="token punctuation">[</span>flink@master conf<span class="token punctuation">]</span>$ <span class="token function">vim</span> slaves 
master
segment01
segment02

<span class="token punctuation">[</span>flink@master conf<span class="token punctuation">]</span>$ <span class="token function">vim</span> zoo.cfg 
<span class="token comment"># The number of milliseconds of each tick</span>
<span class="token assign-left variable">tickTime</span><span class="token operator">=</span><span class="token number">2000</span>

<span class="token comment"># The number of ticks that the initial  synchronization phase can take</span>
<span class="token assign-left variable">initLimit</span><span class="token operator">=</span><span class="token number">10</span>

<span class="token comment"># The number of ticks that can pass between  sending a request and getting an acknowledgement</span>
<span class="token assign-left variable">syncLimit</span><span class="token operator">=</span><span class="token number">5</span>

<span class="token comment"># The directory where the snapshot is stored.</span>
<span class="token comment">#flinkZK 大写的ZK</span>
<span class="token assign-left variable">dataDir</span><span class="token operator">=</span>/home/flink/data/flinkZK/dataDir
<span class="token assign-left variable">dataLogDir</span><span class="token operator">=</span>/home/flink/data/flinkZK/dataLogDir

<span class="token comment"># The port at which the clients will connect</span>
<span class="token assign-left variable">clientPort</span><span class="token operator">=</span><span class="token number">2181</span>

<span class="token comment"># ZooKeeper quorum peers</span>
server.1<span class="token operator">=</span>master:2888:3888
server.2<span class="token operator">=</span>segment01:2888:3888
server.3<span class="token operator">=</span>segment02:2888:3888
<span class="token comment"># server.2=host:peer-port:leader-port</span>
</code></pre></div><ol start="5"><li>启动集群</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>flink@master module<span class="token punctuation">]</span>$ start-cluster.sh
Starting HA cluster with <span class="token number">2</span> masters.
Starting standalonesession daemon on <span class="token function">host</span> master.
Starting standalonesession daemon on <span class="token function">host</span> segment01.
Starting taskexecutor daemon on <span class="token function">host</span> master.
Starting taskexecutor daemon on <span class="token function">host</span> segment01.
Starting taskexecutor daemon on <span class="token function">host</span> segment02.

<span class="token punctuation">[</span>flink@master ~<span class="token punctuation">]</span>$ xcall.sh jps
--------- master ----------
<span class="token number">6301</span> QuorumPeerMain
<span class="token number">116465</span> TaskManagerRunner
<span class="token number">114752</span> JournalNode
<span class="token number">115216</span> NodeManager
<span class="token number">114387</span> NameNode
<span class="token number">10947</span> Jps
<span class="token number">114516</span> DataNode
<span class="token number">116116</span> StandaloneSessionClusterEntrypoint
<span class="token number">115098</span> ResourceManager
<span class="token number">114973</span> DFSZKFailoverController
--------- segment01 ----------
<span class="token number">93155</span> TaskManagerRunner
<span class="token number">6411</span> QuorumPeerMain
<span class="token number">92804</span> StandaloneSessionClusterEntrypoint
<span class="token number">115892</span> Jps
<span class="token number">91847</span> DataNode
<span class="token number">91963</span> JournalNode
<span class="token number">91754</span> NameNode
<span class="token number">92255</span> NodeManager
<span class="token number">92110</span> DFSZKFailoverController
--------- segment02 ----------
<span class="token number">82352</span> JournalNode
<span class="token number">83202</span> TaskManagerRunner
<span class="token number">82772</span> ResourceManager
<span class="token number">82231</span> DataNode
<span class="token number">104822</span> Jps
<span class="token number">6903</span> QuorumPeerMain
<span class="token number">82494</span> NodeManager
</code></pre></div><ol start="6"><li>测试</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>flink@master flink-1.10.0<span class="token punctuation">]</span>$ ./bin/flink run -m yarn-cluster ./examples/batch/WordCount.jar
</code></pre></div><p>10.集群管理脚本</p> <ol><li>集群启动脚本</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>flink@master bin<span class="token punctuation">]</span>$ <span class="token function">vim</span> flinkStart.sh 
<span class="token comment">#!/bin/bash</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;-------------------------启动zookeeper----------------------------&quot;</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;Now,starting Zookeeper.&quot;</span>
<span class="token function">ssh</span> master <span class="token variable">$ZOOKEEPER_HOME</span>/bin/zkServer.sh start
<span class="token function">ssh</span> segment01 <span class="token variable">$ZOOKEEPER_HOME</span>/bin/zkServer.sh start
<span class="token function">ssh</span> segment02 <span class="token variable">$ZOOKEEPER_HOME</span>/bin/zkServer.sh start

<span class="token function">ssh</span> master <span class="token variable">$ZOOKEEPER_HOME</span>/bin/zkServer.sh status
<span class="token function">ssh</span> segment01 <span class="token variable">$ZOOKEEPER_HOME</span>/bin/zkServer.sh status
<span class="token function">ssh</span> segment02 <span class="token variable">$ZOOKEEPER_HOME</span>/bin/zkServer.sh status
<span class="token builtin class-name">echo</span> <span class="token string">&quot;Now,Zookeeper is started.&quot;</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;-------------------------启动hdfs----------------------------&quot;</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;Now,starting hdfs.&quot;</span>
<span class="token function">ssh</span> master <span class="token variable">$HADOOP_HOME</span>/sbin/start-dfs.sh
<span class="token builtin class-name">echo</span> <span class="token string">&quot;Now,hdfs started.&quot;</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;-------------------------启动yarn----------------------------&quot;</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;Now,starting yarn.&quot;</span>
<span class="token function">ssh</span> master <span class="token variable">$HADOOP_HOME</span>/sbin/start-yarn.sh
<span class="token function">ssh</span> segment02 <span class="token variable">$HADOOP_HOME</span>/sbin/yarn-daemon.sh start resourcemanager
<span class="token builtin class-name">echo</span> <span class="token string">&quot;Now,yarn started.&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;-------------------------启动flink----------------------------&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;Now,starting flink.&quot;</span>
<span class="token function">ssh</span> master <span class="token variable">$FLINK_HOME</span>/bin/start-cluster.sh
<span class="token builtin class-name">echo</span> <span class="token string">&quot;Now,flink started.&quot;</span>
</code></pre></div><ol start="2"><li>集群停止脚本</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>flink@master bin<span class="token punctuation">]</span>$ <span class="token function">vim</span> flinkStop.sh 
<span class="token comment">#!/bin/bash</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;-------------------------停止flink----------------------------&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;Now,shutting flink.&quot;</span>
<span class="token function">ssh</span> master <span class="token variable">$FLINK_HOME</span>/bin/stop-cluster.sh
<span class="token builtin class-name">echo</span> <span class="token string">&quot;Now,flink stopped.&quot;</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;-------------------------关闭hdfs----------------------------&quot;</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;Now,shutting hdfs.&quot;</span>
<span class="token function">ssh</span> master <span class="token variable">$HADOOP_HOME</span>/sbin/stop-dfs.sh
<span class="token builtin class-name">echo</span> <span class="token string">&quot;Now,hdfs stopped.&quot;</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;-------------------------关闭yarn----------------------------&quot;</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;Now,shutting yarn.&quot;</span>
<span class="token function">ssh</span> master <span class="token variable">$HADOOP_HOME</span>/sbin/stop-yarn.sh
<span class="token function">ssh</span> segment02 <span class="token variable">$HADOOP_HOME</span>/sbin/yarn-daemon.sh stop resourcemanager
<span class="token builtin class-name">echo</span> <span class="token string">&quot;Now,yarn stopped.&quot;</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;-------------------------关闭zookeeper----------------------------&quot;</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;Now,shutting Zookeeper.&quot;</span>
<span class="token function">ssh</span> master <span class="token variable">$ZOOKEEPER_HOME</span>/bin/zkServer.sh stop
<span class="token function">ssh</span> segment01 <span class="token variable">$ZOOKEEPER_HOME</span>/bin/zkServer.sh stop
<span class="token function">ssh</span> segment02 <span class="token variable">$ZOOKEEPER_HOME</span>/bin/zkServer.sh stop

<span class="token builtin class-name">echo</span> <span class="token string">&quot;Now,Zookeeper stopped.&quot;</span>
</code></pre></div><ol start="3"><li>脚本授权</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>flink@master bin<span class="token punctuation">]</span>$ <span class="token function">chmod</span> <span class="token number">777</span> flinkStart.sh 
<span class="token punctuation">[</span>flink@master bin<span class="token punctuation">]</span>$ <span class="token function">chmod</span> <span class="token number">777</span> flinkStop.sh 
</code></pre></div><h3 id="_4-share"><a href="#_4-share" class="header-anchor">#</a> 4.Share:</h3> <p>golang 随机 time.sleep 的 Duration 问题
http://xiaorui.cc/archives/3034
gulp 命令找不到 – 安装 gulp 后出错
https://blog.csdn.net/weixin_33935505/article/details/91666585</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.65b0f24a.js" defer></script><script src="/assets/js/2.d6ca9a42.js" defer></script><script src="/assets/js/50.8ef31d09.js" defer></script>
  </body>
</html>
